/* ==================================
   GrammarView、ReadingView、WritingView、ListeningView、SpeakingView
   移动端适配样式 - 支持各种屏幕尺寸
   ================================== */

/* 安卓系统通用优化 */
@supports (-webkit-touch-callout: none) {
    /* 检测安卓系统 */
    * {
        -webkit-tap-highlight-color: rgba(99, 102, 241, 0.2);
        -webkit-touch-callout: none;
    }

    /* 安卓字体渲染优化 */
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
    }

    /* 滚动优化 */
    .content-panel,
    .sidebar-panel {
        -webkit-overflow-scrolling: touch;
        overflow-scrolling: touch;
    }
}

/* 超小屏手机 (320px - 360px) */
@media (max-width: 360px) {
    .page-container {
        padding: 8px !important;
    }

    .topic-card,
    .history-card,
    .option-card {
        padding: 10px !important;
        min-height: 90px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.85rem !important;
        -webkit-line-clamp: 2 !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.75rem !important;
        -webkit-line-clamp: 1 !important;
    }

    .option-card {
        min-height: 80px !important;
    }

    .option-card .icon-box {
        font-size: 1.2rem !important;
    }

    .option-card .option-label {
        font-size: 0.7rem !important;
    }

    /* 题目导航 */
    .num-grid,
    .nav-grid {
        grid-template-columns: repeat(5, 1fr) !important;
        gap: 4px !important;
    }

    .num-box,
    .nav-item {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.7rem !important;
    }

    /* 选项 */
    .option-item,
    .answer-option {
        padding: 10px 12px !important;
    }

    .option-index,
    .option-idx {
        width: 28px !important;
        height: 28px !important;
        font-size: 0.8rem !important;
    }

    .option-text,
    .option-content {
        font-size: 0.85rem !important;
    }

    /* 按钮 */
    .action-btn,
    .start-btn {
        padding: 11px 16px !important;
        font-size: 0.85rem !important;
    }

    /* 统计 */
    .stat-value {
        font-size: 1.2rem !important;
    }

    .stat-label {
        font-size: 0.7rem !important;
    }
}

/* 安卓小屏 (320px - 375px) - Xiaomi Redmi, Samsung A系列 */
@media (max-width: 375px) {
    /* 安卓底部导航栏预留空间 */
    .page-container {
        padding-bottom: 16px !important;
    }

    /* 安卓虚拟按键区域 */
    @supports (padding-bottom: env(safe-area-inset-bottom)) {
        .page-container {
            padding-bottom: calc(16px + env(safe-area-inset-bottom)) !important;
        }
    }

    /* 卡片触摸反馈 */
    .topic-card,
    .history-card,
    .answer-option {
        transition: background-color 0.2s, transform 0.1s !important;
    }

    .topic-card:active,
    .history-card:active,
    .answer-option:active {
        background: var(--accent-fill) !important;
        transform: scale(0.98) !important;
    }
}

/* 安卓标准屏 (360px - 412px) - Samsung S21, OnePlus Nord */
@media (min-width: 360px) and (max-width: 412px) {
    .topic-card,
    .history-card {
        padding: 11px !important;
        min-height: 98px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.9rem !important;
        line-height: 1.4 !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.8rem !important;
    }

    /* 安卓字体优化 */
    .topic-title,
    .history-title,
    .option-text,
    .option-content {
        text-rendering: optimizeLegibility !important;
        -webkit-text-stroke: 0.01px transparent !important;
    }
}

/* 安卓中屏 (376px - 390px) - Samsung S22, Xiaomi 12 */
@media (min-width: 376px) and (max-width: 390px) {
    .topic-card,
    .history-card {
        padding: 12px !important;
        min-height: 102px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.92rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.82rem !important;
    }

    .option-card {
        min-height: 88px !important;
    }
}

/* 安卓大屏 (391px - 414px) - Samsung S23, OnePlus 11 */
@media (min-width: 391px) and (max-width: 414px) {
    .topic-card,
    .history-card {
        padding: 13px !important;
        min-height: 106px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.95rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.84rem !important;
    }

    .option-card {
        min-height: 90px !important;
    }
}

/* 安卓超大屏 (415px - 480px) - Samsung S23 Ultra, OnePlus 11 */
@media (min-width: 415px) and (max-width: 480px) {
    .topic-card,
    .history-card {
        padding: 14px !important;
        min-height: 110px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.98rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.86rem !important;
    }

    /* 大屏导航优化 */
    .num-grid,
    .nav-grid {
        grid-template-columns: repeat(8, 1fr) !important;
    }
}

/* 安卓折叠屏和超大屏 (481px - 768px) */
@media (min-width: 481px) and (max-width: 768px) {
    .topic-card,
    .history-card {
        padding: 15px !important;
        min-height: 115px !important;
    }

    .topic-title,
    .history-title {
        font-size: 1rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.88rem !important;
    }

    /* 折叠屏横屏模式 */
    @media (orientation: landscape) {
        .topic-card,
        .history-card {
            min-height: 85px !important;
            padding: 12px !important;
        }

        .topic-title,
        .history-title {
            font-size: 0.9rem !important;
            -webkit-line-clamp: 1 !important;
        }
    }
}

/* 小屏手机 (361px - 375px, iPhone SE) */
@media (min-width: 361px) and (max-width: 375px) {
    .topic-card,
    .history-card {
        padding: 11px !important;
        min-height: 95px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.88rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.78rem !important;
    }

    .option-card {
        min-height: 85px !important;
    }

    .num-grid,
    .nav-grid {
        grid-template-columns: repeat(6, 1fr) !important;
    }

    .num-box,
    .nav-item {
        width: 30px !important;
        height: 30px !important;
    }
}

/* 标准手机 (376px - 390px, iPhone 12/13/14) */
@media (min-width: 376px) and (max-width: 390px) {
    .topic-card,
    .history-card {
        padding: 12px !important;
        min-height: 100px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.9rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.8rem !important;
    }

    .option-card {
        min-height: 88px !important;
    }
}

/* 大屏手机 (391px - 414px, iPhone Pro Max) */
@media (min-width: 391px) and (max-width: 414px) {
    .topic-card,
    .history-card {
        padding: 13px !important;
        min-height: 105px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.92rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.82rem !important;
    }

    .option-card {
        min-height: 90px !important;
    }
}

/* 超大屏手机 (415px - 480px) */
@media (min-width: 415px) and (max-width: 480px) {
    .topic-card,
    .history-card {
        padding: 14px !important;
        min-height: 108px !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.95rem !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.83rem !important;
    }
}

/* 平板设备 (768px 及以下) */
@media (max-width: 768px) {

    /* 主布局调整 */
    .main-layout,
    .writing-layout,
    .test-layout {
        flex-direction: column !important;
        height: auto !important;
    }

    .sidebar-panel,
    .side-navigation {
        width: 100% !important;
        order: -1;
        /* 将侧边栏移到顶部 */
        margin-bottom: 20px !important;
    }

    .content-panel,
    .main-content {
        width: 100% !important;
    }

    /* 页面容器 */
    .page-container {
        padding: 12px !important;
        height: auto !important;
        margin-top: 10px !important;
    }

    /* 问题卡片 */
    .question-inner,
    .question-card {
        padding: 16px !important;
    }

    .question-text,
    .question-header h3 {
        font-size: 1.2rem !important;
    }

    .option-content,
    .option-text {
        font-size: 0.95rem !important;
    }

    /* 题目网格和历史记录网格在移动端适配为双列 */
    .topics-grid-container .n-grid,
    .history-section .n-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
        width: 100% !important;
    }

    /* 针对 Naive UI 渲染布局的深层覆盖 */
    .history-section :deep(.n-grid) {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        width: 100% !important;
    }

    /* 历史记录卡片精简化 */
    .history-card,
    .history-card-item {
        padding: 12px !important;
        border-radius: 12px !important;
        min-height: 100px !important;
        display: flex !important;
        flex-direction: column !important;
        background: var(--card-bg) !important;
    }

    .topic-title,
    .history-title {
        font-size: 0.9rem !important;
        line-height: 1.4 !important;
        margin: 6px 0 !important;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        word-break: break-word !important;
    }

    .topic-preview,
    .history-footer {
        font-size: 0.8rem !important;
        line-height: 1.3 !important;
        opacity: 0.8;
        display: -webkit-box !important;
        -webkit-line-clamp: 2 !important;
        line-clamp: 2 !important;
        -webkit-box-orient: vertical !important;
        overflow: hidden !important;
        word-break: break-word !important;
    }

    .history-card-header .n-tag,
    .history-footer .n-tag {
        font-size: 9px !important;
        height: 18px !important;
        padding: 0 4px !important;
    }

    /* 题目数字导航适配 - 增加列数使其变小 */
    .num-grid {
        grid-template-columns: repeat(8, 1fr) !important;
        gap: 6px !important;
    }

    .num-box,
    .nav-item {
        width: 32px !important;
        height: 32px !important;
        font-size: 0.75rem !important;
        border-radius: 6px !important;
    }

    .nav-group {
        margin-bottom: 12px !important;
    }

    .group-title {
        font-size: 0.65rem !important;
        margin-bottom: 8px !important;
    }

    /* 侧边栏卡片 */
    .sidebar-card,
    .nav-card {
        margin-bottom: 16px !important;
    }

    /* 内容文本 */
    .passage-text,
    .article-content,
    .topic-prompt {
        font-size: 0.95rem !important;
        line-height: 1.6 !important;
    }

    /* 音频播放器 & 录音机 */
    .audio-player,
    .audio-block,
    .recorder-card {
        padding: 12px !important;
        min-height: auto !important;
    }

    .visualizer-circle {
        width: 80px !important;
        height: 80px !important;
    }

    /* 写作编辑器 */
    .editor-card,
    .essay-editor {
        min-height: 300px !important;
    }

    .stats-grid,
    .options-grid {
        grid-template-columns: 1fr !important;
    }

    /* Setup 页面适配 - 让选项卡并排显示 */
    .setup-container {
        padding: 8px !important;
    }

    .setup-card :deep(.n-card-header__main) {
        font-size: 1.1rem !important;
    }

    .setting-section h3 {
        font-size: 0.95rem !important;
        margin-bottom: 12px !important;
    }

    .grid-options.source-grid,
    .grid-options.category-grid,
    .grid-options.exam-grid,
    .grid-options.mode-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        /* 2列并排 */
        gap: 12px !important;
    }

    .option-card {
        padding: 16px 10px !important;
        min-height: 100px !important;
    }

    .option-card .icon-box {
        font-size: 1.5rem !important;
        margin-bottom: 6px !important;
    }

    .setting-sub-section h4 {
        font-size: 0.85rem !important;
        margin-bottom: 8px !important;
    }

    .pill-options {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important;
        width: 100% !important;
    }

    .pill-option {
        min-width: 0 !important;
        /* 关键：允许缩小 */
        white-space: normal !important;
        /* 允许必要时换行 */
        padding: 8px 4px !important;
        font-size: 0.8rem !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        text-align: center !important;
    }

    .settings-box {
        padding: 16px 12px !important;
        overflow: hidden !important;
    }

    .start-btn {
        height: 48px !important;
        font-size: 1rem !important;
    }

    /* 听力/阅读测试页头部适配 */
    .test-header {
        padding: 12px 16px !important;
        gap: 12px !important;
        margin-bottom: 16px !important;
    }

    .passage-title h2 {
        font-size: 1.1rem !important;
        line-height: 1.4 !important;
    }

    .passage-title .n-tag {
        font-size: 10px !important;
        height: 20px !important;
        padding: 0 6px !important;
    }

    .timer-box {
        gap: 8px !important;
    }

    .timer-box :deep(.n-progress) {
        width: 32px !important;
    }

    /* 选项布局修复 (针对听力、阅读、语法、词汇测试等所有模块) */
    .option-idx,
    .option-index,
    .answer-option .option-index {
        flex-shrink: 0 !important;
        width: 32px !important;
        height: 32px !important;
        min-width: 32px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
    }

    .option-item,
    .answer-option {
        display: flex !important;
        flex-direction: row !important;
        align-items: flex-start !important;
        /* 对齐顶部，适合长文本 */
        gap: 12px !important;
        padding: 12px 16px !important;
    }

    .option-text,
    .option-content {
        flex: 1 !important;
        min-width: 0 !important;
        word-break: break-word !important;
        white-space: normal !important;
        margin-top: 4px !important;
        /* 修正对齐顶部后的垂直居中感 */
        line-height: 1.5 !important;
    }
}

/* 手机设备 (600px 及以下) */
@media (max-width: 600px) {

    /* 选项间距 */
    .options-list,
    .options-grid {
        gap: 8px !important;
    }

    .option-item {
        padding: 10px 12px !important;
    }

    /* 导航网格 - 手机端保持较多列 */
    .nav-grid,
    .num-grid {
        grid-template-columns: repeat(6, 1fr) !important;
        gap: 6px !important;
    }

    .navigator-panel {
        padding: 12px !important;
        gap: 6px !important;
    }

    .num-box,
    .nav-item {
        width: 28px !important;
        height: 28px !important;
    }

    /* 结果卡片 */
    .result-card,
    .score-card {
        padding: 16px !important;
    }

    .stat-value,
    .score-circle .val {
        font-size: 1.5rem !important;
    }

    /* 标题 */
    .header-content h1,
    .page-header h1 {
        font-size: 1.5rem !important;
    }

    /* 统计卡片改为单列 */
    .stats-grid,
    .mini-stats {
        grid-template-columns: 1fr !important;
    }

    /* 手机端进一步压缩设置 */
    .grid-options.source-grid,
    .grid-options.category-grid,
    .grid-options.exam-grid,
    .grid-options.mode-grid {
        gap: 8px !important;
        grid-template-columns: repeat(2, 1fr) !important;
    }

    /* 药丸选项布局 (话题类型、难度、限时等) */
    .pill-options {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 8px !important;
        width: 100% !important;
    }

    .option-card {
        padding: 12px 6px !important;
        min-height: 80px !important;
    }

    .option-card .icon-box {
        font-size: 1.25rem !important;
    }

    .option-card .option-label {
        font-size: 0.75rem !important;
    }

    .pill-options {
        grid-template-columns: repeat(3, 1fr) !important;
        width: 100% !important;
    }

    .pill-option {
        padding: 6px 2px !important;
        font-size: 0.75rem !important;
    }

    .setup-card :deep(.n-card-header) {
        padding: 12px 16px !important;
    }

    .setting-section {
        margin-bottom: 20px !important;
    }

    /* 手机端头部进一步压缩 */
    .test-header {
        padding: 8px 12px !important;
        gap: 8px !important;
    }

    .passage-title h2 {
        font-size: 0.95rem !important;
    }

    .timer-box .count {
        font-size: 0.8rem !important;
    }
}

/* 超小屏幕 (480px 及以下) */
@media (max-width: 480px) {
    .num-grid {
        grid-template-columns: repeat(5, 1fr) !important;
    }

    .navigator-panel {
        gap: 4px !important;
    }
}