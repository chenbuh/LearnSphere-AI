# ğŸ” LearnSphere AI å®‰å…¨é…ç½®æŒ‡å—

## ğŸ“‹ å·²å®æ–½çš„å®‰å…¨æªæ–½

### 1. **æ•æ„Ÿä¿¡æ¯åŠ å¯† (Jasypt)**

æ‰€æœ‰æ•°æ®åº“å¯†ç å’Œ API Key å·²ä½¿ç”¨ Jasypt åŠ å¯†å­˜å‚¨ã€‚

#### åŠ å¯†é…ç½®
- **ç®—æ³•**: `PBEWithMD5AndDES`
- **åŠ å¯†å¯†é’¥**: `LearnSphere2026SecretKey` (é»˜è®¤ï¼Œâš ï¸ **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹**)

#### å·²åŠ å¯†çš„ä¿¡æ¯
- âœ… MySQL æ•°æ®åº“å¯†ç 
- âœ… DashScope AI API Key

---

## ğŸš€ å¦‚ä½•å¯åŠ¨é¡¹ç›®

### æ–¹æ³• 1ï¼šä½¿ç”¨é»˜è®¤å¯†é’¥ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

```bash
java -jar learnsphere-ai-backend.jar
```

### æ–¹æ³• 2ï¼šé€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®å¯†é’¥ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**Windows (PowerShell)**:
```powershell
$env:JASYPT_PASSWORD="æ‚¨çš„å®‰å…¨å¯†é’¥"
java -jar learnsphere-ai-backend.jar
```

**Linux/Mac**:
```bash
export JASYPT_PASSWORD="æ‚¨çš„å®‰å…¨å¯†é’¥"
java -jar learnsphere-ai-backend.jar
```

### æ–¹æ³• 3ï¼šé€šè¿‡å¯åŠ¨å‚æ•°è®¾ç½®å¯†é’¥

```bash
java -Djasypt.encryptor.password=æ‚¨çš„å®‰å…¨å¯†é’¥ -jar learnsphere-ai-backend.jar
```

---

## ğŸ”§ å¦‚ä½•ç”Ÿæˆæ–°çš„åŠ å¯†å¯†æ–‡

### æ­¥éª¤ 1: ä¿®æ”¹åŠ å¯†å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…åšï¼ï¼‰

æ‰“å¼€ `JasyptEncryptUtil.java`ï¼Œä¿®æ”¹ `DEFAULT_PASSWORD` å¸¸é‡ï¼š

```java
private static final String DEFAULT_PASSWORD = "æ‚¨çš„ç”Ÿäº§ç¯å¢ƒå¯†é’¥";
```

### æ­¥éª¤ 2: ç¼–è¯‘é¡¹ç›®

```bash
mvn clean compile
```

### æ­¥éª¤ 3: è¿è¡ŒåŠ å¯†å·¥å…·

```bash
# åŠ å¯†æ•°æ®åº“å¯†ç 
mvn exec:java -Dexec.mainClass="com.learnsphere.utils.JasyptEncryptUtil" -Dexec.args="chen20040209"

# åŠ å¯† API Key
mvn exec:java -Dexec.mainClass="com.learnsphere.utils.JasyptEncryptUtil" -Dexec.args="your-api-key"
```

### æ­¥éª¤ 4: æ›´æ–°é…ç½®æ–‡ä»¶

å°†ç”Ÿæˆçš„å¯†æ–‡å¤åˆ¶åˆ° `application-secret.properties`:

```properties
spring.datasource.password=ENC(ç”Ÿæˆçš„å¯†æ–‡)
ai.api-key=ENC(ç”Ÿæˆçš„å¯†æ–‡)
```

---

## ğŸ›¡ï¸ é¢å¤–çš„å®‰å…¨å»ºè®®

### 1. **Git å¿½ç•¥æ•æ„Ÿæ–‡ä»¶**

ç¡®ä¿ `.gitignore` åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```gitignore
# æ•æ„Ÿé…ç½®æ–‡ä»¶
application-secret.properties
application-local.properties

# ç¯å¢ƒå˜é‡æ–‡ä»¶
.env
.env.local

# å¯†é’¥æ–‡ä»¶
*.key
*.pem
```

### 2. **å®šæœŸæ›´æ¢å¯†é’¥**

- ğŸ“… **å»ºè®®é¢‘ç‡**: æ¯ 3 ä¸ªæœˆ
- ğŸ”„ **æ›´æ¢æµç¨‹**:
  1. ç”Ÿæˆæ–°çš„åŠ å¯†å¯†é’¥
  2. é‡æ–°åŠ å¯†æ‰€æœ‰æ•æ„Ÿä¿¡æ¯
  3. æ›´æ–°é…ç½®æ–‡ä»¶å’Œå¯åŠ¨è„šæœ¬
  4. é€šçŸ¥è¿ç»´å›¢é˜Ÿ

### 3. **ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†å¯†é’¥**

ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ï¼š

- **Docker Secrets** (æ¨è Docker éƒ¨ç½²)
- **Kubernetes Secrets** (æ¨è K8s éƒ¨ç½²)
- **äº‘æœåŠ¡å•†å¯†é’¥ç®¡ç†** (å¦‚ AWS Secrets Manager)
- **HashiCorp Vault** (ä¼ä¸šçº§å¯†é’¥ç®¡ç†)

### 4. **é™åˆ¶æ–‡ä»¶æƒé™**

```bash
# Linux/Mac
chmod 600 application-secret.properties
chmod 600 .env

# Windows (PowerShell ç®¡ç†å‘˜æƒé™)
icacls application-secret.properties /inheritance:r /grant:r "$env:USERNAME:(R)"
```

### 5. **ä¼ è¾“åŠ å¯† (HTTPS)**

âš ï¸ **å½“å‰çŠ¶æ€**: ä¸ºäº†å¼€å‘å’Œéƒ¨ç½²æ–¹ä¾¿ï¼Œç›®å‰é¡¹ç›®å·²åˆ‡æ¢ä¸º **HTTP** åè®®ã€‚

ä½†åœ¨æ­£å¼ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ï¼Œå»ºè®®å¯ç”¨ HTTPS ä»¥ä¿è¯ä¼ è¾“å®‰å…¨ï¼š

```properties
server.ssl.enabled=true
server.ssl.key-store=classpath:keystore.p12
server.ssl.key-store-password=ENC(åŠ å¯†åçš„å¯†ç )
server.ssl.key-store-type=PKCS12
```

---

## ğŸš¨ å®‰å…¨æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒå‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] å·²ä¿®æ”¹é»˜è®¤çš„ Jasypt åŠ å¯†å¯†é’¥
- [ ] æ‰€æœ‰æ•æ„Ÿä¿¡æ¯å·²åŠ å¯†
- [ ] `application-secret.properties` å·²æ·»åŠ åˆ° `.gitignore`
- [ ] æ•°æ®åº“ç”¨æˆ·ä½¿ç”¨æœ€å°æƒé™åŸåˆ™
- [ ] API æ¥å£å·²å¯ç”¨é™æµå’Œé˜²çˆ¬æªæ–½
- [ ] å·²é…ç½® CORS ç™½åå•
- [x] å½“å‰ä½¿ç”¨ HTTP (å¼€å‘/æ¼”ç¤ºç¯å¢ƒ)
- [ ] ç”Ÿäº§ç¯å¢ƒå»ºè®®å¯ç”¨ HTTPS
- [ ] æ—¥å¿—ä¸­ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯
- [ ] å·²è®¾ç½®é˜²ç«å¢™è§„åˆ™

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [Jasypt Spring Boot å®˜æ–¹æ–‡æ¡£](https://github.com/ulisesbocchio/jasypt-spring-boot)
- [Spring Security æœ€ä½³å®è·µ](https://spring.io/guides/topicals/spring-security-architecture/)
- [OWASP å®‰å…¨æŒ‡å—](https://owasp.org/www-project-top-ten/)

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¯åŠ¨æ—¶æŠ¥ "Unable to decrypt" é”™è¯¯ï¼Ÿ

**A**: æ£€æŸ¥åŠ å¯†å¯†é’¥æ˜¯å¦æ­£ç¡®ï¼š
1. ç¡®è®¤ç¯å¢ƒå˜é‡ `JASYPT_PASSWORD` å·²è®¾ç½®
2. æˆ–åœ¨å¯åŠ¨å‚æ•°ä¸­æ·»åŠ  `-Djasypt.encryptor.password=å¯†é’¥`

### Q: å¦‚ä½•åœ¨ IntelliJ IDEA ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ï¼Ÿ

**A**: 
1. æ‰“å¼€ Run â†’ Edit Configurations
2. æ‰¾åˆ° Environment variables
3. æ·»åŠ  `JASYPT_PASSWORD=æ‚¨çš„å¯†é’¥`

### Q: Docker éƒ¨ç½²å¦‚ä½•ä¼ é€’å¯†é’¥ï¼Ÿ

**A**:
```bash
# æ–¹æ³• 1: å¯åŠ¨å‚æ•°
docker run -e JASYPT_PASSWORD=å¯†é’¥ learnsphere-ai

# æ–¹æ³• 2: Docker Secrets (æ¨è)
echo "å¯†é’¥" | docker secret create jasypt_password -
docker service create --secret jasypt_password learnsphere-ai
```

---

**æœ€åæ›´æ–°**: 2026-02-23
**ç»´æŠ¤è€…**: LearnSphere å®‰å…¨å›¢é˜Ÿ
