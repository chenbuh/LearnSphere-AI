# è¯æ±‡æŒæ¡åº¦ç³»ç»Ÿ - é›†æˆæ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åŸºäº DATA_ARCHITECTURE.md çš„å»ºè®®ï¼Œå·²å®ç°å®Œæ•´çš„**è¯æ±‡æŒæ¡åº¦è¿½è¸ªç³»ç»Ÿ**ã€‚

### âœ… æ ¸å¿ƒåŠŸèƒ½

1. **æ™ºèƒ½å¤ä¹ è®¡åˆ’** - åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿è‡ªåŠ¨å®‰æ’å¤ä¹ æ—¶é—´
2. **æŒæ¡ç­‰çº§** - 0-5çº§åŠ¨æ€è¯„ä¼°ï¼Œå®æ—¶åæ˜ å­¦ä¹ è¿›åº¦
3. **å­¦ä¹ ç»Ÿè®¡** - å¤šç»´åº¦ç»Ÿè®¡åˆ†æï¼ˆæŒæ¡æ•°/å­¦ä¹ ä¸­/å¾…å¤ä¹ ï¼‰
4. **æ”¶è—ç¬”è®°** - æ”¯æŒæ”¶è—å•è¯å’Œæ·»åŠ ä¸ªäººç¬”è®°
5. **æ•°æ®æŒä¹…åŒ–** - æ‰€æœ‰å­¦ä¹ è®°å½•äº‘ç«¯åŒæ­¥ï¼Œè·¨è®¾å¤‡è®¿é—®

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### vocabulary_mastery è¡¨

```sql
vocabulary_mastery {
  id                # ä¸»é”®
  user_id           # ç”¨æˆ·ID
  vocabulary_id     # è¯æ±‡ID
  
  mastery_level     # æŒæ¡ç­‰çº§ (0-5)
  review_count      # å¤ä¹ æ¬¡æ•°
  correct_count     # ç­”å¯¹æ¬¡æ•°
  wrong_count       # ç­”é”™æ¬¡æ•°
  
  last_review_time  # æœ€åå¤ä¹ æ—¶é—´
  next_review_time  # ä¸‹æ¬¡å¤ä¹ æ—¶é—´ â­
  
  is_favorite       # æ˜¯å¦æ”¶è—
  notes             # ç”¨æˆ·ç¬”è®°
}
```

### è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿å¤ä¹ é—´éš”

| å¤ä¹ æ¬¡æ•° | é—´éš”å¤©æ•° | è¯´æ˜ |
|---------|---------|------|
| ç¬¬1æ¬¡ | 1å¤© | åˆæ¬¡å­¦ä¹ å |
| ç¬¬2æ¬¡ | 2å¤© | å·©å›ºè®°å¿† |
| ç¬¬3æ¬¡ | 4å¤© | çŸ­æœŸè®°å¿† |
| ç¬¬4æ¬¡ | 7å¤© | 1å‘¨å¤ä¹  |
| ç¬¬5æ¬¡ | 15å¤© | 2å‘¨å¤ä¹  |
| ç¬¬6æ¬¡+ | 30å¤© | é•¿æœŸè®°å¿† |

ç­”é”™åï¼š**ç«‹å³é‡ç½®ä¸ºç¬¬2å¤©å¤ä¹ **

---

## ï¿½ï¿½ API æ¥å£

### 1. è®°å½•å­¦ä¹ ç»“æœ

```http
POST /api/vocabulary/mastery/record
Content-Type: application/json

{
  "vocabularyId": 123,
  "isCorrect": true
}
```

**åŠŸèƒ½**ï¼š
- æ›´æ–°å¤ä¹ æ¬¡æ•°ã€ç­”å¯¹/ç­”é”™æ¬¡æ•°
- åŠ¨æ€è°ƒæ•´æŒæ¡ç­‰çº§
- è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´

### 2. è·å–å¤ä¹ åˆ—è¡¨

```http
GET /api/vocabulary/mastery/review-list?limit=20
```

**è¿”å›**ï¼šéœ€è¦å¤ä¹ çš„å•è¯åˆ—è¡¨ï¼ˆæŒ‰åˆ°æœŸæ—¶é—´æ’åºï¼‰

```json
[
  {
    "id": 1,
    "word": "abandon",
    "phonetic": "/É™ËˆbÃ¦ndÉ™n/",
    "translation": "v. æ”¾å¼ƒ",
    "mastery_level": 2,
    "next_review_time": "2026-01-16 10:00:00"
  }
]
```

### 3. è·å–æŒæ¡ç»Ÿè®¡

```http
GET /api/vocabulary/mastery/stats
```

**è¿”å›**ï¼š
```json
{
  "total": 500,
  "mastered": 120,      // å®Œå…¨æŒæ¡ (level=5)
  "familiar": 180,      // ç†Ÿæ‚‰ (level=3-4)
  "learning": 150,      // å­¦ä¹ ä¸­ (level=1-2)
  "not_started": 50     // æœªå¼€å§‹ (level=0)
}
```

### 4. æ”¶è—/å–æ¶ˆæ”¶è—

```http
POST /api/vocabulary/mastery/favorite
{
  "vocabularyId": 123,
  "favorite": true
}
```

### 5. æ·»åŠ ç¬”è®°

```http
POST /api/vocabulary/mastery/notes
{
  "vocabularyId": 123,
  "notes": "è¿™ä¸ªè¯çš„è¯æ ¹æ˜¯..."
}
```

---

## ğŸ¨ å‰ç«¯é›†æˆ

### 1. åˆ›å»ºAPIæ–‡ä»¶

`frontend-vue/src/api/mastery.js`:

```javascript
import request from '@/utils/request'

export const masteryApi = {
  // è®°å½•å­¦ä¹ ç»“æœ
  recordReview(vocabularyId, isCorrect) {
    return request.post('/vocabulary/mastery/record', {
      vocabularyId,
      isCorrect
    })
  },

  // è·å–å¤ä¹ åˆ—è¡¨
  getReviewList(limit = 20) {
    return request.get('/vocabulary/mastery/review-list', {
      params: { limit }
    })
  },

  // è·å–ç»Ÿè®¡æ•°æ®
  getStats() {
    return request.get('/vocabulary/mastery/stats')
  },

  // æ”¶è—/å–æ¶ˆæ”¶è—
  toggleFavorite(vocabularyId, favorite) {
    return request.post('/vocabulary/mastery/favorite', {
      vocabularyId,
      favorite
    })
  },

  // æ·»åŠ ç¬”è®°
  addNotes(vocabularyId, notes) {
    return request.post('/vocabulary/mastery/notes', {
      vocabularyId,
      notes
    })
  },

  // è·å–å•è¯è¯¦æƒ…
  getMasteryDetail(vocabularyId) {
    return request.get(`/vocabulary/mastery/detail/${vocabularyId}`)
  }
}
```

### 2. åœ¨å­¦ä¹ é¡µé¢ä¸­ä½¿ç”¨

#### ç¤ºä¾‹1ï¼šè®°å½•å­¦ä¹ ç»“æœï¼ˆVocabularyView.vueï¼‰

```vue
<script setup>
import { masteryApi } from '@/api/mastery'

const handleAnswer = async (word, isCorrect) => {
  // è®°å½•åˆ°åç«¯
  await masteryApi.recordReview(word.id, isCorrect)
  
  // æ›´æ–°UI
  if (isCorrect) {
    message.success('ç­”å¯¹äº†ï¼')
  } else {
    message.error('å†å¤ä¹ ä¸€ä¸‹å§')
  }

  // ç»§ç»­ä¸‹ä¸€é¢˜
  nextWord()
}
</script>

<template>
  <div class="flashcard">
    <!-- æ˜¾ç¤ºå•è¯ -->
    <h2>{{ currentWord.word }}</h2>
    
    <!-- ç­”é¢˜æŒ‰é’® -->
    <n-space>
      <n-button @click="handleAnswer(currentWord, false)">
        ä¸è®¤è¯†
      </n-button>
      <n-button type="success" @click="handleAnswer(currentWord, true)">
        è®¤è¯†
      </n-button>
    </n-space>
  </div>
</template>
```

#### ç¤ºä¾‹2ï¼šæ˜¾ç¤ºå¤ä¹ åˆ—è¡¨

```vue
<script setup>
import { ref, onMounted } from 'vue'
import { masteryApi } from '@/api/mastery'

const reviewList = ref([])
const stats = ref({})

onMounted(async () => {
  // åŠ è½½å¤ä¹ åˆ—è¡¨
  const listRes = await masteryApi.getReviewList(20)
  reviewList.value = listRes.data

  // åŠ è½½ç»Ÿè®¡
  const statsRes = await masteryApi.getStats()
  stats.value = statsRes.data
})
</script>

<template>
  <div>
    <!-- ç»Ÿè®¡å¡ç‰‡ -->
    <n-card title="å­¦ä¹ è¿›åº¦">
      <n-grid cols="4" x-gap="12">
        <n-grid-item>
          <n-statistic label="å®Œå…¨æŒæ¡" :value="stats.mastered" />
        </n-grid-item>
        <n-grid-item>
          <n-statistic label="ç†Ÿæ‚‰" :value="stats.familiar" />
        </n-grid-item>
        <n-grid-item>
          <n-statistic label="å­¦ä¹ ä¸­" :value="stats.learning" />
        </n-grid-item>
        <n-grid-item>
          <n-statistic label="æœªå­¦ä¹ " :value="stats.not_started" />
        </n-grid-item>
      </n-grid>
    </n-card>

    <!-- å¤ä¹ åˆ—è¡¨ -->
    <n-card title="ä»Šæ—¥å¤ä¹ " class="mt-4">
      <n-list>
        <n-list-item v-for="word in reviewList" :key="word.id">
          <div>
            <strong>{{ word.word }}</strong>
            <span class="phonetic">{{ word.phonetic }}</span>
          </div>
          <div>{{ word.translation }}</div>
          <n-tag :type="getLevelType(word.mastery_level)">
            ç­‰çº§ {{ word.mastery_level }}
          </n-tag>
        </n-list-item>
      </n-list>
    </n-card>
  </div>
</template>
```

#### ç¤ºä¾‹3ï¼šæ”¶è—å’Œç¬”è®°

```vue
<script setup>
const toggleFavorite = async (wordId) => {
  const isFavorite = !currentWord.value.isFavorite
  await masteryApi.toggleFavorite(wordId, isFavorite)
  currentWord.value.isFavorite = isFavorite
}

const saveNotes = async (wordId, notes) => {
  await masteryApi.addNotes(wordId, notes)
  message.success('ç¬”è®°å·²ä¿å­˜')
}
</script>

<template>
  <n-card>
    <!-- æ”¶è—æŒ‰é’® -->
    <n-button 
      @click="toggleFavorite(word.id)"
      :type="word.isFavorite ? 'warning' : 'default'"
    >
      {{ word.isFavorite ? 'å·²æ”¶è—' : 'æ”¶è—' }}
    </n-button>

    <!-- ç¬”è®°è¾“å…¥ -->
    <n-input
      v-model:value="notes"
      type="textarea"
      placeholder="æ·»åŠ ç¬”è®°..."
      @blur="saveNotes(word.id, notes)"
    />
  </n-card>
</template>
```

---

## ğŸ“Š æŒæ¡ç­‰çº§è¯´æ˜

| ç­‰çº§ | åç§° | æ¡ä»¶ | é¢œè‰² |
|-----|------|------|------|
| 0 | æœªå­¦ä¹  | ä»æœªå­¦è¿‡ | Gray |
| 1-2 | å­¦ä¹ ä¸­ | å¤ä¹ <3æ¬¡ æˆ– æ­£ç¡®ç‡<70% | Orange |
| 3-4 | ç†Ÿæ‚‰ | å¤ä¹ â‰¥3æ¬¡ ä¸” æ­£ç¡®ç‡â‰¥70% | Blue |
| 5 | å®Œå…¨æŒæ¡ | å¤ä¹ â‰¥5æ¬¡ ä¸” æ­£ç¡®ç‡â‰¥90% | Green |

### ç­‰çº§è®¡ç®—é€»è¾‘

```javascript
// ç­”å¯¹ â†’ æå‡ç­‰çº§
if (æ­£ç¡®ç‡ >= 90% && å¤ä¹ æ¬¡æ•° >= 5) {
  level = 5  // å®Œå…¨æŒæ¡
} else if (æ­£ç¡®ç‡ >= 70% && å¤ä¹ æ¬¡æ•° >= 3) {
  level = 3-4  // ç†Ÿæ‚‰
} else {
  level = 1-2  // å­¦ä¹ ä¸­
}

// ç­”é”™ â†’ é™ä½ç­‰çº§
if (æ­£ç¡®ç‡ < 50%) {
  level -= 2
} else {
  level -= 1
}
```

---

## ğŸš€ ä½¿ç”¨æµç¨‹

### å®Œæ•´å­¦ä¹ æµç¨‹

```
1. ç”¨æˆ·è¿›å…¥å­¦ä¹ é¡µé¢
   â†“
2. è°ƒç”¨ getReviewList() è·å–ä»Šæ—¥å¾…å¤ä¹ å•è¯
   â†“
3. æ˜¾ç¤ºå•è¯å¡ç‰‡
   â†“
4. ç”¨æˆ·ç­”é¢˜ï¼ˆè®¤è¯†/ä¸è®¤è¯†ï¼‰
   â†“
5. è°ƒç”¨ recordReview(wordId, isCorrect)
   - åç«¯æ›´æ–°æŒæ¡ç­‰çº§
   - è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´
   - ä¿å­˜åˆ°æ•°æ®åº“
   â†“
6. å‰ç«¯æ˜¾ç¤ºåé¦ˆï¼ˆç­”å¯¹/ç­”é”™ï¼‰
   â†“
7. ç»§ç»­ä¸‹ä¸€ä¸ªå•è¯
   â†“
8. å®Œæˆåæ˜¾ç¤ºç»Ÿè®¡ï¼ˆgetStatsï¼‰
```

---

## ğŸ“¦ æ•°æ®è¿ç§»

### ä» LocalStorage è¿ç§»åˆ°äº‘ç«¯

å¦‚æœä¹‹å‰ä½¿ç”¨ LocalStorageå­˜å‚¨å­¦ä¹ è¿›åº¦ï¼Œéœ€è¦è¿ç§»ï¼š

```javascript
// è¿ç§»è„šæœ¬
async function migrateToCloud() {
  const localData = JSON.parse(localStorage.getItem('vocabulary_mastery') || '{}')
  
  for (const [wordId, mastery] of Object.entries(localData)) {
    await masteryApi.recordReview(wordId, mastery.isCorrect)
  }
  
  // æ¸…é™¤æœ¬åœ°æ•°æ®
  localStorage.removeItem('vocabulary_mastery')
  console.log('âœ… è¿ç§»å®Œæˆ')
}
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šæŒæ¡ç­‰çº§ä¸æ›´æ–°

**æ£€æŸ¥**ï¼š
1. åç«¯æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ï¼Ÿ
2. å‰ç«¯æ˜¯å¦æˆåŠŸè°ƒç”¨ APIï¼Ÿ
3. æ•°æ®åº“ `vocabulary_mastery` è¡¨æ˜¯å¦åˆ›å»ºï¼Ÿ

### é—®é¢˜2ï¼šå¤ä¹ åˆ—è¡¨ä¸ºç©º

**åŸå› **ï¼šæ–°ç”¨æˆ·æ²¡æœ‰å­¦ä¹ è®°å½•

**è§£å†³**ï¼š
1. å…ˆå­¦ä¹ å‡ ä¸ªå•è¯
2. æ‰‹åŠ¨æ’å…¥æµ‹è¯•æ•°æ®ï¼ˆè§SQLè„šæœ¬ï¼‰

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ‰§è¡ŒSQLè„šæœ¬

```bash
mysql -u root -p learnsphere_ai < backend/src/main/resources/sql/vocabulary_mastery_system.sql
```

### 2. é‡å¯åç«¯

åˆ·æ–°MyBatisé…ç½®ï¼Œè¯†åˆ«æ–°è¡¨

### 3. æµ‹è¯•API

```bash
# è®°å½•å­¦ä¹ 
curl -X POST http://localhost:8080/api/vocabulary/mastery/record \
  -H "Content-Type: application/json" \
  -H "satoken: YOUR_TOKEN" \
  -d '{"vocabularyId":1,"isCorrect":true}'

# è·å–ç»Ÿè®¡
curl http://localhost:8080/api/vocabulary/mastery/stats \
  -H "satoken: YOUR_TOKEN"
```

### 4. å‰ç«¯æµ‹è¯•

åœ¨æµè§ˆå™¨æ§åˆ¶å°ï¼š

```javascript
import { masteryApi } from '@/api/mastery'

// æµ‹è¯•è®°å½•
await masteryApi.recordReview(1, true)

// æŸ¥çœ‹ç»Ÿè®¡
const stats = await masteryApi.getStats()
console.log(stats.data)
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜åŒ–

- [ ] æ·»åŠ æ¯æ—¥å­¦ä¹ ç›®æ ‡ï¼ˆå¦‚ï¼šæ¯å¤©å¤ä¹ 20ä¸ªå•è¯ï¼‰
- [ ] ç”Ÿæˆå­¦ä¹ æŠ¥å‘Šï¼ˆå‘¨æŠ¥/æœˆæŠ¥ï¼‰
- [ ] å¯¼å‡ºå­¦ä¹ æ•°æ®ä¸ºPDF
- [ ] AIæ™ºèƒ½æ¨èè–„å¼±å•è¯
- [ ] ç¤¾äº¤åŠŸèƒ½ï¼ˆä¸å¥½å‹PKå¤ä¹ è¿›åº¦ï¼‰

---

éœ€è¦å¸®åŠ©ï¼ŸæŸ¥çœ‹å®Œæ•´æ–‡æ¡£ï¼š`docs/DATA_ARCHITECTURE.md`
