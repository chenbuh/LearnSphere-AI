# 学习任务与自动完成逻辑

## 1. 功能概述

系统自动追踪用户在各个学习模块（词汇、语法、听力、阅读）的进度，并实时更新“学习中心”和“AI助手”中的任务清单。**任务完成逻辑不再依赖用户手动勾选，而是通过实际的学习行为和提交数据触发。**

## 2. 技术实现

### 2.1 状态追踪 (State Tracking)

系统利用 Pinia Store 维护各模块的实时状态，确保任务清单的准确性。

-   **词汇任务**: 监听 `vocabularyStore.stats.todayCount`。当今日新学单词数达到设定目标（默认10个）时，自动标记为完成。
-   **听力任务**: 监听 `listeningStore.isSubmitted`。用户在 `ListeningView` 完成所有题目并点击“提交”后，Store 会调用 `completePractice()` 将标记置为 `true`。
-   **语法任务**: 监听 `grammarStore.isSubmitted`。用户在 `GrammarView` 提交练习后，通过 Watcher 或显式调用 `submitExercise()` 更新 Store。
-   **阅读任务**: 监听 `readingStore.isSubmitted`。用户在 `ReadingView` 完成阅读理解并提交后，更新 Store。

### 2.2 自动完成逻辑 (Auto-Completion)

1.  **前端计算**:
    -   `LearningHubView.vue` 和 `AITutor.vue` 使用 `computed` 属性动态计算 `dailyChallenge` 或 `learningGoals`。
    -   任务对象直接引用对应 Store 的响应式变量，实现“学完即变绿”的实时视觉反馈。
2.  **后端同步**:
    -   `taskTracker.js` 负责将本地完成进度同步到后端 `study_plan_task` 表。
    -   当模块提交时，前端会调用 `studyPlanApi.completeTask` 永久记录任务状态。

### 2.3 防误触发设计

-   **禁用手动勾选**: `DailyChallenge.vue` 组件中的任务清单已禁用手动点击切换功能（`n-checkbox` 设为 `disabled`），避免虚假进度。
-   **数据持久化**: 任务完成状态持久化于 `localStorage`（通过 Pinia 插件），用户刷新页面或重新进入系统时，已完成的任务仍保持完成状态。
-   **生命周期管理**: 各练习页面在“开始新练习”时（`startPractice`/`startExercise`）会重置 Store 中的 `isSubmitted` 状态，确保每日/每次任务的独立性。

## 3. 任务清单配置

目前系统预设的每日任务如下：

| 任务名称 | 完成标准 | 奖励 |
| :--- | :--- | :--- |
| 今日词汇学习 | 今日新学单词 >= 10 | 10 XP |
| 完成听力训练 | 提交一次听力练习 | 15 XP |
| 攻克语法专题 | 提交一次语法专题测试 | 20 XP |
| 深度阅读研习 | 提交文章阅读练习 | 20 XP |

## 4. 相关代码文件

-   组件: `src/components/DailyChallenge.vue`
-   视图: `src/views/LearningHubView.vue`, `src/components/AITutor.vue`
-   存储: `src/stores/vocabulary.js`, `src/stores/listening.js`, `src/stores/grammar.js`, `src/stores/reading.js`
-   工具: `src/utils/taskTracker.js`
