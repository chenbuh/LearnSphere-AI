# AI Tutor 界面与交互功能增强 - 实现说明 (2026)

## 📋 功能更新清单

### 1. AI 助教界面优化
- **✅ 可折叠的推荐提问区**: 用户现在可以手动展开或折叠 AI 助教下方的推荐问题区域，节省屏幕空间，提升专注度。
- **✅ 丝滑过渡动画**: 使用 `fade-slide` 动画效果，使推荐提问区的切换更加自然。
- **✅ 状态记忆**: 在当前会话中保持用户的折叠/展开偏好。

### 2. 模块敏感的智能提问
- **✅ 语法专项优化**: 在语法练习模块中，AI 助教会自动添加“这个语法点还有其他例句吗？”的推荐提问。
- **✅ 上下文感知控制**: 非语法模块（如听力、阅读、写作）不会显示该特定提问，确保 AI 导师的专业性与上下文契合度。
- **✅ 全模块集成**: 已在以下 9 个核心模块中完成上下文标志适配，**并特别修复了全真模拟考 (Mock Exam) 在答题过程中无法实时跟踪当前题目的问题**：
  - 语法训练 (Grammar)
  - 阅读理解 (Reading)
  - 听力训练 (Listening)
  - 写作实验室 (Writing)
  - 口语陪练 (Speaking)
  - 词汇测试 (Vocabulary Test)
  - 单词学习 (Vocabulary Browse/Learn)
  - 错题本 (Error Book)
  - 全真模拟考 (Mock Exam) - **支持答题实时跟踪与回顾模式手动切换**

### 3. AI 助教后台管理增强
- **✅ 专项提示词管理**: 管理员现在可以直接在“AI 助教管理”页面修改 AI 导师的核心提示词（如系统人格、回答规范等），无需跳转。
- **✅ 专项模型路由**: 支持为 AI 助教独立配置模型（如 qwen-max），实现与全站其他 AI 功能的模型解耦。
- ✅ **实时数据仪表盘**: 顶部统计卡片（总消息数、活跃会话、今日提问量、敏感拦截）已全部对接后端真实数据，不再使用 Mock 数据。
- ✅ **双轨配额管理**: 实现了“内容生成（题目/试卷）”与“AI 助教提问”的配额解耦。管理员可针对不同功能维度为用户设定独立的每日调用上限，防止刷 Token 的同时不影响正常的提问交流。
- ✅ **违规审计集成**: 直接在管理面板查看 AI 助教触发的敏感词拦截记录。
- **✅ 对话生命周期管理**: 可视化的数据统计与过期记录一键清理。

### 4. 成本与安全控制 (Cost & Security Control)
- **✅ 每日配额限制**: 现已将 AI 助教集成到 VIP 配额系统中。普通用户每日限额 5 次，VIP 用户根据等级享有更高额度（50-200次），有效防止 Token 被恶意消耗。
- **✅ 专项配额消耗**: 在 `system_config` 中新增 `quota_cost_ai_tutor` 配置，支持动态调整单次提问的消耗权重。
- **✅ 频率限制 (Rate Limiting)**: 接口层增加每分钟提问次数限制，防止自动化脚本刷接口。
- **✅ 敏感词过滤**: 所有提问均经过 `CheckSensitive` 审计，拦截违规内容。

### 5. 数据库基础设施
- **✅ 自动表结构初始化**: 现已将 `ai_tutor_conversation` (对话历史)、`user_weakness` (薄弱点) 和 `knowledge_graph` (知识图谱) 的创建逻辑集成到 `DatabaseInitializer` 中，确保新环境部署时数据库自动就绪。
- **✅ 初始知识图谱预置**: 自动导入涵盖时态、完成时、虚拟语气、定语从句、被动语态等核心语法点的初始知识数据。

---

## 🛠️ 技术实现细节

### 前端组件 (`AITutor.vue`)
- **状态管理**: 引入 `showQuickQuestions` (ref) 控制显示。
- **计算提问**: 根据 `props.context.module` 动态拼接 `quickQuestions`。
- **交互逻辑**: 点击标题行即可切换 `showQuickQuestions` 状态。

### 上下文适配 (`tutorContext`)
所有集成 AI 助教的页面均已更新其 `tutorContext` 计算属性，增加了 `module` 字段：
- `module: 'grammar'` (语法)
- `module: 'reading'` (阅读)
- `module: 'listening'` (听力)
- `module: 'writing'` (写作)
- `module: 'speaking'` (口语)
- `module: 'vocabulary'` (词汇)
- `module: 'exam'` (模拟考)

---

## 📈 预期效果

1. **更好的视觉平衡**: 折叠功能解决了当推荐问题过多时占用过多聊天界面的问题。
2. **更高的提问效率**: 语法专项例句提问是用户最高频的需求之一，现在可一键触发。
3. **更强的专业感**: AI 助教表现得更懂当前的课目内容。

---

**更新日期**: 2026-02-14
**版本**: v3.5.0
**实现者**: Antigravity AI @ LearnSphere Team
