# ğŸ” APIå¯†é’¥å’Œæ•æ„Ÿä¿¡æ¯å®‰å…¨æŒ‡å—

## âš ï¸ é‡è¦è­¦å‘Š

**æ‚¨çš„APIå¯†é’¥å’Œæ•°æ®åº“å¯†ç ä¹‹å‰è¢«ç¡¬ç¼–ç åœ¨Gitä»“åº“ä¸­ï¼è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„å®‰å…¨æ¼æ´ã€‚**

---

## ğŸ›¡ï¸ å·²å®æ–½çš„å®‰å…¨æªæ–½

### 1. é…ç½®æ–‡ä»¶é‡æ„

æˆ‘ä»¬å·²ç»å°†æ•æ„Ÿä¿¡æ¯ä»ç‰ˆæœ¬æ§åˆ¶çš„æ–‡ä»¶ä¸­ç§»é™¤ï¼š

- âœ… `application.properties` - APIå¯†é’¥å·²ç§»é™¤ï¼Œæ”¹ç”¨ç¯å¢ƒå˜é‡
- âœ… `application-dev.yml` - æ•°æ®åº“å¯†ç å·²ç§»é™¤
- âœ… `application-prod.yml` - å‡­è¯å ä½ç¬¦å·²ç§»é™¤
- âœ… åˆ›å»ºäº† `application-secret.properties` å­˜å‚¨çœŸå®å¯†é’¥ï¼ˆå·²åœ¨.gitignoreä¸­ï¼‰

### 2. .gitignore æ›´æ–°

å·²æ·»åŠ ä»¥ä¸‹è§„åˆ™é˜²æ­¢æ•æ„Ÿæ–‡ä»¶è¢«æäº¤ï¼š

```gitignore
# Spring Boot æ•æ„Ÿé…ç½®æ–‡ä»¶
backend/src/main/resources/application-secret.properties
backend/src/main/resources/application-local.properties
backend/src/main/resources/application-dev.properties
backend/src/main/resources/application-prod.properties
backend/src/main/resources/application.properties
```

### 3. ç¯å¢ƒå˜é‡æ”¯æŒ

ç°åœ¨æ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ï¼š

- `AI_API_KEY` - é˜¿é‡Œäº‘APIå¯†é’¥
- `DB_USERNAME` - æ•°æ®åº“ç”¨æˆ·å
- `DB_PASSWORD` - æ•°æ®åº“å¯†ç 

---

## ğŸš¨ **ç«‹å³éœ€è¦åšçš„äº‹æƒ…**

### æ­¥éª¤ 1: æ›´æ¢APIå¯†é’¥ï¼ˆæå…¶é‡è¦ï¼ï¼‰

**æ‚¨çš„æ—§APIå¯†é’¥ `sk-8b5df7e3d85442fd8e4ddb7c5204da48` å·²ç»æš´éœ²åœ¨Gitå†å²ä¸­ï¼Œå¿…é¡»ç«‹å³æ›´æ¢ï¼**

1. **ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°**
   - è®¿é—®ï¼šhttps://dashscope.console.aliyun.com/
   
2. **åˆ é™¤æ—§çš„APIå¯†é’¥**
   - æ‰¾åˆ°å¯†é’¥ç®¡ç†
   - åˆ é™¤ `sk-8b5df7e3d85442fd8e4ddb7c5204da48`
   
3. **åˆ›å»ºæ–°çš„APIå¯†é’¥**
   - ç”Ÿæˆæ–°çš„APIå¯†é’¥
   - å¤åˆ¶æ–°å¯†é’¥
   
4. **æ›´æ–°æœ¬åœ°é…ç½®**
   - ç¼–è¾‘ `backend/src/main/resources/application-secret.properties`
   - å°† `ai.api-key` æ›´æ–°ä¸ºæ–°å¯†é’¥

### æ­¥éª¤ 2: æ¸…ç†Gitå†å²ï¼ˆå¿…é¡»ï¼ï¼‰

**âš ï¸ è­¦å‘Šï¼šè¿™å°†é‡å†™Gitå†å²ï¼**

å¦‚æœæ‚¨çš„ä»£ç è¿˜æ²¡æœ‰æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼Œæˆ–è€…åªæœ‰æ‚¨ä¸€ä¸ªäººåœ¨ä½¿ç”¨ä»“åº“ï¼š

```powershell
# 1. å¤‡ä»½æ‚¨çš„é¡¹ç›®
xcopy /E /I "e:\Project\LearnSphere  AI" "e:\Project\LearnSphere  AI_backup"

# 2. ä»Gitå†å²ä¸­æ°¸ä¹…åˆ é™¤æ•æ„Ÿæ–‡ä»¶
cd "e:\Project\LearnSphere  AI"
git filter-branch --force --index-filter "git rm --cached --ignore-unmatch backend/src/main/resources/application.properties backend/src/main/resources/application-dev.yml backend/src/main/resources/application-prod.yml" --prune-empty --tag-name-filter cat -- --all

# 3. æ¸…ç†å¼•ç”¨å’Œåƒåœ¾å›æ”¶
git for-each-ref --format="delete %(refname)" refs/original | git update-ref --stdin
git reflog expire --expire=now --all
git gc --prune=now --aggressive

# 4. å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ä»“åº“ï¼ˆå¦‚æœå·²æ¨é€è¿‡ï¼‰
# âš ï¸ è­¦å‘Šï¼šè¿™ä¼šè¦†ç›–è¿œç¨‹ä»“åº“å†å²ï¼
git push origin --force --all
git push origin --force --tags
```

### æ­¥éª¤ 3: éªŒè¯å®‰å…¨æ€§

```powershell
# æ£€æŸ¥æ•æ„Ÿæ–‡ä»¶æ˜¯å¦åœ¨Gitä¸­
cd "e:\Project\LearnSphere  AI"
git ls-files | findstr "application.properties"
git ls-files | findstr "application-dev.yml"
git ls-files | findstr "application-prod.yml"

# å¦‚æœæœ‰è¾“å‡ºï¼Œè¯´æ˜æ–‡ä»¶è¿˜åœ¨Gitè·Ÿè¸ªä¸­ï¼Œéœ€è¦ç§»é™¤ï¼š
git rm --cached backend/src/main/resources/application.properties
git rm --cached backend/src/main/resources/application-dev.yml
git rm --cached backend/src/main/resources/application-prod.yml
git commit -m "Remove sensitive configuration files from version control"
```

### æ­¥éª¤ 4: æ£€æŸ¥è¿œç¨‹ä»“åº“

å¦‚æœä»£ç å·²æ¨é€åˆ°GitHub/GitLab/Giteeç­‰å¹³å°ï¼š

1. **æ£€æŸ¥æ˜¯å¦å…¬å¼€**
   - å¦‚æœä»“åº“æ˜¯å…¬å¼€çš„ï¼Œä»»ä½•äººéƒ½å¯èƒ½å·²ç»çœ‹åˆ°äº†æ‚¨çš„å¯†é’¥
   - å¼ºçƒˆå»ºè®®å°†ä»“åº“è®¾ä¸ºç§æœ‰

2. **æŸ¥çœ‹æäº¤å†å²**
   - åœ¨ç½‘é¡µä¸Šæµè§ˆæäº¤è®°å½•
   - ç¡®è®¤æ•æ„Ÿä¿¡æ¯æ˜¯å¦å·²è¢«ç§»é™¤

3. **è€ƒè™‘åˆ é™¤ä»“åº“å¹¶é‡æ–°åˆ›å»º**ï¼ˆæœ€å®‰å…¨çš„æ–¹æ³•ï¼‰
   - å¦‚æœä»“åº“æ˜¯æ–°çš„ï¼Œæ²¡æœ‰å¤ªå¤šåä½œè€…
   - åˆ é™¤æ—§ä»“åº“
   - åˆ›å»ºæ–°ä»“åº“å¹¶æ¨é€æ¸…ç†åçš„ä»£ç 

---

## ğŸ“‹ å¼€å‘ç¯å¢ƒé…ç½®

### æœ¬åœ°å¼€å‘

ç¼–è¾‘ `backend/src/main/resources/application-secret.properties`ï¼š

```properties
# Database Configuration
spring.datasource.username=root
spring.datasource.password=ä½ çš„æ•°æ®åº“å¯†ç 

# AI Configuration
ai.api-key=ä½ çš„æ–°APIå¯†é’¥
```

### ç”Ÿäº§éƒ¨ç½²

**æ°¸è¿œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é…ç½®æ–‡ä»¶å­˜å‚¨å¯†é’¥ï¼**

ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
# Linux/Mac
export AI_API_KEY="ä½ çš„æ–°APIå¯†é’¥"
export DB_USERNAME="learnsphere"
export DB_PASSWORD="ä½ çš„ç”Ÿäº§æ•°æ®åº“å¯†ç "

# Windows PowerShell
$env:AI_API_KEY="ä½ çš„æ–°APIå¯†é’¥"
$env:DB_USERNAME="learnsphere"
$env:DB_PASSWORD="ä½ çš„ç”Ÿäº§æ•°æ®åº“å¯†ç "

# Windows CMD
set AI_API_KEY=ä½ çš„æ–°APIå¯†é’¥
set DB_USERNAME=learnsphere
set DB_PASSWORD=ä½ çš„ç”Ÿäº§æ•°æ®åº“å¯†ç 
```

æˆ–è€…åœ¨å¯åŠ¨æ—¶ä¼ é€’ï¼š

```bash
java -jar -DAI_API_KEY="ä½ çš„æ–°APIå¯†é’¥" -DDB_PASSWORD="å¯†ç " app.jar
```

---

## âœ… å®‰å…¨æœ€ä½³å®è·µ

### æ°¸è¿œä¸è¦ï¼š

- âŒ åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
- âŒ å°†æ•æ„Ÿé…ç½®æ–‡ä»¶æäº¤åˆ°Git
- âŒ åœ¨å…¬å¼€ä»“åº“å­˜å‚¨å¯†é’¥
- âŒ é€šè¿‡é‚®ä»¶æˆ–èŠå¤©åˆ†äº«å¯†é’¥
- âŒ åœ¨æ—¥å¿—ä¸­æ‰“å°å¯†é’¥

### å§‹ç»ˆåšåˆ°ï¼š

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
- âœ… å®šæœŸè½®æ¢APIå¯†é’¥
- âœ… ä¸ºä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒçš„å¯†é’¥
- âœ… ç›‘æ§APIä½¿ç”¨æƒ…å†µï¼Œå‘ç°å¼‚å¸¸ç«‹å³å“åº”
- âœ… ä½¿ç”¨ .gitignore ä¿æŠ¤æ•æ„Ÿæ–‡ä»¶
- âœ… å®¡æŸ¥ä»£ç ï¼Œç¡®ä¿æ²¡æœ‰æ³„éœ²æœºå¯†

---

## ğŸ“ å¦‚æœå¯†é’¥å·²ç»æ³„éœ²

1. **ç«‹å³æ›´æ¢å¯†é’¥**ï¼ˆæœ€ä¼˜å…ˆï¼‰
2. æ£€æŸ¥APIä½¿ç”¨è®°å½•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å¼‚å¸¸è°ƒç”¨
3. æŸ¥çœ‹è´¦å•ï¼Œç¡®è®¤æ˜¯å¦æœ‰æœªæˆæƒçš„è´¹ç”¨
4. è”ç³»æœåŠ¡æä¾›å•†æŠ¥å‘Šæ³„éœ²
5. æ¸…ç†Gitå†å²
6. åŠ å¼ºå®‰å…¨æªæ–½

---

## ğŸ” å®šæœŸå®‰å…¨æ£€æŸ¥

æ¯æœˆæ‰§è¡Œï¼š

```powershell
# æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯åœ¨Gitä¸­
cd "e:\Project\LearnSphere  AI"
git grep -i "sk-" -- "*.properties" "*.yml" "*.yaml"
git grep -i "password" -- "*.properties" "*.yml" "*.yaml"

# æ£€æŸ¥.gitignoreæ˜¯å¦ç”Ÿæ•ˆ
git status --ignored
```

---

## ğŸ“š å‚è€ƒèµ„æº

- [GitHub - ä»ä»“åº“ä¸­åˆ é™¤æ•æ„Ÿæ•°æ®](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)
- [é˜¿é‡Œäº‘ - APIå¯†é’¥å®‰å…¨](https://help.aliyun.com/zh/dashscope/developer-reference/api-key-security)
- [OWASP - å¯†é’¥ç®¡ç†å¤‡å¿˜å½•](https://cheatsheetseries.owasp.org/cheatsheets/Key_Management_Cheat_Sheet.html)

---

**æœ€åæ›´æ–°**: 2026-01-17
**çŠ¶æ€**: âš ï¸ éœ€è¦ç«‹å³æ‰§è¡Œæ­¥éª¤1å’Œæ­¥éª¤2
