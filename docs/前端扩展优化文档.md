# å‰ç«¯ä¼˜åŒ–æ‰©å±•åŠŸèƒ½æ–‡æ¡£

## ğŸš€ æ–°å¢æ‰©å±•åŠŸèƒ½æ€»ç»“

æœ¬æ–‡æ¡£æ¶µç›–äº†åœ¨åŸæœ‰ GrammarView ä¼˜åŒ–åŸºç¡€ä¸Šçš„å››é¡¹æ‰©å±•åŠŸèƒ½ã€‚

---

## 1ï¸âƒ£ æ‰©å±•åˆ°å…¶ä»–è§†å›¾

### âœ… å·²åˆ›å»ºçš„ Store

| Store | æ–‡ä»¶ | åŠŸèƒ½ |
|-------|------|------|
| **GrammarStore** | `stores/grammar.js` | è¯­æ³•ç»ƒä¹ çŠ¶æ€æŒä¹…åŒ– |
| **ReadingStore** | `stores/reading.js` | é˜…è¯»ç†è§£çŠ¶æ€æŒä¹…åŒ– |
| **WritingStore** | `stores/writing.js` | å†™ä½œè‰ç¨¿è‡ªåŠ¨ä¿å­˜ |

### ğŸ“ å„ Store ç‰¹æ€§å¯¹æ¯”

```javascript
// GrammarStore - æµ‹éªŒå‹
- ä¿å­˜ç­”æ¡ˆè¿›åº¦
- å½“å‰é¢˜ç›®ç´¢å¼•
- æäº¤çŠ¶æ€

// ReadingStore - é˜…è¯»+ç­”é¢˜å‹
- æ–‡ç« å†…å®¹
- é˜…è¯»è¿›åº¦
- ç­”é¢˜çŠ¶æ€

// WritingStore - è‰ç¨¿è‡ªåŠ¨ä¿å­˜
- ä½œæ–‡è‰ç¨¿å†…å®¹
- å®æ—¶ä¿å­˜
- è¯„åˆ†ç»“æœ
```

### ğŸ’¡ å¦‚ä½•åº”ç”¨åˆ°å…¶ä»–è§†å›¾

**ä»¥ ReadingView ä¸ºä¾‹**ï¼š

```vue
<script setup>
import { useReadingStore } from '@/stores/reading'
import ReadingSkeleton from '@/components/ReadingSkeleton.vue'

const readingStore = useReadingStore()
const isLoading = ref(false)

// æ¢å¤æ—¶æ£€æŸ¥è¿‡æœŸ
if (readingStore.currentArticle && !readingStore.isExpired()) {
  message.info('å·²ä¸ºæ‚¨æ¢å¤é˜…è¯»è¿›åº¦')
} else if (readingStore.isExpired()) {
  readingStore.clearPersistedState()
}
</script>

<template>
  <!-- åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å± -->
  <ReadingSkeleton v-if="isLoading" />
  
  <!-- å®é™…å†…å®¹ -->
  <div v-else>...</div>
</template>
```

---

## 2ï¸âƒ£ è¿‡æœŸæ£€æµ‹ï¼ˆ24å°æ—¶è‡ªåŠ¨æ¸…é™¤ï¼‰

### ğŸ• å®ç°åŸç†

```javascript
// Store ä¸­æ·»åŠ æ—¶é—´æˆ³
const timestamp = ref(Date.now())

// è¿‡æœŸæ£€æµ‹å‡½æ•°
const isExpired = () => {
  const now = Date.now()
  const twentyFourHours = 24 * 60 * 60 * 1000
  return (now - timestamp.value) > twentyFourHours
}

// æ¯æ¬¡æ“ä½œæ›´æ–°æ—¶é—´æˆ³
function startExercise(...) {
  // ... å…¶ä»–é€»è¾‘
  timestamp.value = Date.now() // æ›´æ–°æ—¶é—´æˆ³
}
```

### ğŸ“‹ æ—¶é—´æˆ³æ›´æ–°è§¦å‘ç‚¹

| æ“ä½œ | æ˜¯å¦æ›´æ–°æ—¶é—´æˆ³ | ç†ç”± |
|-----|--------------|------|
| å¼€å§‹æ–°ç»ƒä¹  | âœ… æ˜¯ | é‡æ–°å¼€å§‹ |
| æäº¤ç­”æ¡ˆ | âŒ å¦ | æŒç»­ç­”é¢˜ä¸­ |
| ä¿å­˜è‰ç¨¿ (Writing) | âœ… æ˜¯ | æ´»è·ƒç¼–è¾‘ |
| é‡ç½®ç»ƒä¹  | âœ… æ˜¯ | æ¸…ç©ºçŠ¶æ€ |

### ğŸ¯ è¿‡æœŸå¤„ç†æµç¨‹

```
åº”ç”¨å¯åŠ¨ â†’ æ£€æŸ¥ Store æ•°æ®
    â†“
æ˜¯å¦è¿‡æœŸï¼Ÿ
    â”œâ”€ å¦ â†’ æ¢å¤è¿›åº¦ âœ“
    â””â”€ æ˜¯ â†’ æ¸…é™¤æ•°æ® + æç¤ºç”¨æˆ· "æ•°æ®å·²è¿‡æœŸ"
```

### ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

```javascript
// GrammarView.vue ä¸­çš„è¿‡æœŸæ£€æµ‹
if (grammarStore.currentExercise && grammarStore.currentMode === 'quiz') {
  if (grammarStore.isExpired()) {
    message.warning('æ£€æµ‹åˆ°ç»ƒä¹ æ•°æ®å·²è¿‡æœŸï¼ˆè¶…è¿‡24å°æ—¶ï¼‰ï¼Œå·²ä¸ºæ‚¨æ¸…é™¤')
    grammarStore.clearPersistedState()
    isStarted.value = false
  } else {
    message.info('æ£€æµ‹åˆ°æœªå®Œæˆçš„ç»ƒä¹ ï¼Œå·²ä¸ºæ‚¨æ¢å¤è¿›åº¦')
  }
}
```

---

## 3ï¸âƒ£ IndexedDB æ”¯æŒï¼ˆå¤§å®¹é‡å­˜å‚¨ï¼‰

### ğŸ“¦ ä¸ºä»€ä¹ˆéœ€è¦ IndexedDBï¼Ÿ

| å­˜å‚¨æ–¹å¼ | å®¹é‡é™åˆ¶ | é€‚ç”¨åœºæ™¯ |
|---------|----------|---------|
| **localStorage** | 5-10 MB | å½“å‰çŠ¶æ€ã€é…ç½® |
| **IndexedDB** | 50 MB+ | å†å²è®°å½•ã€å¤§é‡æ•°æ® |

### ğŸ”§ IndexedDB å·¥å…·ç±»

**æ–‡ä»¶**: `utils/indexedDB.js`

```javascript
import { saveHistory, getHistory, clearHistory } from '@/utils/indexedDB'

// ä¿å­˜å†å²è®°å½•
await saveHistory('grammarHistory', {
  topic: 'æ—¶æ€è¯­æ€',
  questions: [...],
  score: 85,
  date: new Date()
})

// è·å–æœ€è¿‘ 50 æ¡è®°å½•
const recent = await getHistory('grammarHistory', 50)

// æ¸…ç©ºå†å²
await clearHistory('grammarHistory')
```

### ğŸ“Š æ•°æ®ç»“æ„

```
IndexedDB: learnsphere-db
â”œâ”€â”€ grammarHistory
â”‚   â”œâ”€â”€ id (auto-increment)
â”‚   â”œâ”€â”€ topic
â”‚   â”œâ”€â”€ questions []
â”‚   â”œâ”€â”€ score
â”‚   â”œâ”€â”€ timestamp
â”‚   â””â”€â”€ date
â”œâ”€â”€ readingHistory
â”œâ”€â”€ writingHistory
â””â”€â”€ listeningHistory
```

### ğŸ—‘ï¸ è‡ªåŠ¨æ¸…ç†æœºåˆ¶

```javascript
// 1. å¯åŠ¨æ—¶æ¸…ç†è¿‡æœŸæ•°æ®ï¼ˆ24å°æ—¶ï¼‰
initCleanup()

// 2. ä¿å­˜æ—¶è‡ªåŠ¨ä¿ç•™æœ€è¿‘ 100 æ¡
await saveHistory(...) // è‡ªåŠ¨è°ƒç”¨ cleanOldRecords(100)
```

### ğŸ’¡ ä½¿ç”¨åœºæ™¯

**GrammarView å†å²è®°å½•**ï¼š

```javascript
import { saveHistory, getHistory } from '@/utils/indexedDB'

// å®Œæˆç»ƒä¹ åä¿å­˜åˆ° IndexedDB
async function saveToHistory() {
  await saveHistory('grammarHistory', {
    topic: selectedTopic.value,
    difficulty: selectedDifficulty.value,
    questions: questions.value,
    score: score.value,
    correctCount: correctCount,
    totalQuestions: questions.value.length
  })
}

// åŠ è½½å†å²è®°å½•
async function loadHistory() {
  historyExercises.value = await getHistory('grammarHistory', 20)
}
```

---

## 4ï¸âƒ£ éª¨æ¶å±åŠ¨ç”»ï¼ˆæ³¢æµªæ•ˆæœï¼‰

### ğŸŒŠ æ³¢æµªåŠ¨ç”»å®ç°

**CSS å…³é”®ä»£ç **ï¼š

```css
/* åº”ç”¨æ³¢æµªåŠ¨ç”»åˆ°æ‰€æœ‰éª¨æ¶å± */
.skeleton-container :deep(.n-skeleton__placeholder) {
  animation: skeleton-wave 1.5s ease-in-out infinite;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0.05) 25%,
    rgba(255, 255, 255, 0.15) 50%,
    rgba(255, 255, 255, 0.05) 75%
  );
  background-size: 200% 100%;
}

@keyframes skeleton-wave {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}
```

### âœ¨ åŠ¨ç”»ç±»å‹å¯¹æ¯”

| åŠ¨ç”»ç±»å‹ | æ•ˆæœ | é€‚ç”¨åœºæ™¯ |
|---------|------|---------|
| **Wave (æ³¢æµª)** | ä»å·¦åˆ°å³æ‰«è¿‡ | æ¨èï¼Œç°ä»£é«˜çº§æ„Ÿ |
| **Pulse (é—ªçƒ)** | æ˜æš—äº¤æ›¿ | ç®€å•åœºæ™¯ |
| **Static (é™æ€)** | æ— åŠ¨ç”» | æç®€é£æ ¼ |

### ğŸ¨ åˆ›å»ºä¸åŒé£æ ¼éª¨æ¶å±

**Wave åŠ¨ç”»ï¼ˆæ¨èï¼‰**ï¼š
```css
.skeleton-wave :deep(.n-skeleton__placeholder) {
  animation: skeleton-wave 1.5s ease-in-out infinite;
}
```

**Pulse åŠ¨ç”»**ï¼š
```css
.skeleton-pulse :deep(.n-skeleton__placeholder) {
  animation: skeleton-pulse 1.5s ease-in-out infinite;
}

@keyframes skeleton-pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}
```

### ğŸ“ å·²åˆ›å»ºçš„éª¨æ¶å±ç»„ä»¶

| ç»„ä»¶ | æ–‡ä»¶ | ç”¨é€” |
|-----|------|------|
| **GrammarSkeleton** | `components/GrammarSkeleton.vue` | è¯­æ³•ç»ƒä¹ åŠ è½½ |
| **ReadingSkeleton** | `components/ReadingSkeleton.vue` | é˜…è¯»æ–‡ç« åŠ è½½ |

---

## ğŸ“ æ–°å¢æ–‡ä»¶æ€»è§ˆ

```
frontend-vue/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ grammar.js          ğŸ”§ æ›´æ–°ï¼šæ·»åŠ è¿‡æœŸæ£€æµ‹
â”‚   â”‚   â”œâ”€â”€ reading.js          âœ¨ æ–°å¢ï¼šReading Store
â”‚   â”‚   â””â”€â”€ writing.js          âœ¨ æ–°å¢ï¼šWriting Store
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ GrammarSkeleton.vue ğŸ”§ æ›´æ–°ï¼šæ·»åŠ æ³¢æµªåŠ¨ç”»
â”‚   â”‚   â””â”€â”€ ReadingSkeleton.vue âœ¨ æ–°å¢ï¼šé˜…è¯»éª¨æ¶å±
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ indexedDB.js        âœ¨ æ–°å¢ï¼šIndexedDB å·¥å…·ç±»
â”‚   â”‚
â”‚   â””â”€â”€ main.js                 ğŸ”§ æ›´æ–°ï¼šåˆå§‹åŒ– IndexedDB æ¸…ç†
â”‚
â””â”€â”€ docs/
    â””â”€â”€ FRONTEND_EXTENDED_OPTIMIZATION.md  âœ¨ æœ¬æ–‡æ¡£
```

---

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### 1. åº”ç”¨åˆ° ReadingView

```vue
<script setup>
import { useReadingStore } from '@/stores/reading'
import ReadingSkeleton from '@/components/ReadingSkeleton.vue'

const readingStore = useReadingStore()
const isLoading = ref(false)

// è¿‡æœŸæ£€æµ‹
if (readingStore.currentArticle && !readingStore.isExpired()) {
  message.info('å·²æ¢å¤é˜…è¯»è¿›åº¦')
} else if (readingStore.isExpired()) {
  readingStore.clearPersistedState()
}

// å¼€å§‹é˜…è¯»
async function startReading() {
  isLoading.value = true
  const article = await api.generateReading(...)
  readingStore.startReading(article, level, topic)
  isLoading.value = false
}
</script>

<template>
  <ReadingSkeleton v-if="isLoading" />
  <div v-else><!-- å®é™…å†…å®¹ --></div>
</template>
```

### 2. ä¿å­˜å†å²åˆ° IndexedDB

```javascript
import { saveHistory } from '@/utils/indexedDB'

// å®Œæˆç»ƒä¹ å
async function onComplete() {
  await saveHistory('grammarHistory', {
    topic: 'æ—¶æ€è¯­æ€',
    score: 85,
    questions: questions.value
  })
}
```

### 3. è‡ªå®šä¹‰éª¨æ¶å±

```vue
<template>
  <div class="my-skeleton">
    <n-skeleton :width="200" height="24px" class="skeleton-wave" />
    <n-skeleton :width="'100%'" height="16px" class="skeleton-wave" />
  </div>
</template>

<style scoped>
/* å¼•ç”¨æ³¢æµªåŠ¨ç”» */
.skeleton-wave :deep(.n-skeleton__placeholder) {
  animation: skeleton-wave 1.5s ease-in-out infinite;
  background: linear-gradient(90deg, ...);
  background-size: 200% 100%;
}
</style>
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | åŸç‰ˆ | æ‰©å±•ç‰ˆ | æå‡ |
|-----|------|--------|------|
| **æ”¯æŒè§†å›¾** | Grammar | Grammar + Reading + Writing | **+200%** |
| **æ•°æ®è¿‡æœŸ** | âŒ æ— é™æœŸä¿ç•™ | âœ… 24h è‡ªåŠ¨æ¸…é™¤ | **å®‰å…¨æ€§ â†‘** |
| **å†å²å­˜å‚¨** | localStorage (5MB) | IndexedDB (50MB+) | **å®¹é‡ 10x** |
| **åŠ è½½åŠ¨ç”»** | é™æ€å ä½ | æ³¢æµªåŠ¨ç”» | **ä½“éªŒ â†‘â†‘** |

---

## ğŸš€ æ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒæå‡

### **Before (ä¼˜åŒ–å‰)**
```
localStorage: 5MB é™åˆ¶ â†’ å†å²è®°å½•æœ‰é™
åˆ·æ–°é¡µé¢: çŠ¶æ€ä¸¢å¤± â†’ ç”¨æˆ·æ²®ä¸§
æ—§æ•°æ®: æ°¸ä¹…ä¿ç•™ â†’ å­˜å‚¨æ±¡æŸ“
Loading: è½¬åœˆ â†’ ç®€é™‹
```

### **After (ä¼˜åŒ–å)**
```
IndexedDB: 50MB+ â†’ æ— é™å†å²è®°å½• âœ“
åˆ·æ–°é¡µé¢: è‡ªåŠ¨æ¢å¤ â†’ æ— ç¼ä½“éªŒ âœ“
è¿‡æœŸæ•°æ®: 24hè‡ªåŠ¨æ¸…é™¤ â†’ ä¿æŒæ•´æ´ âœ“
Loading: æ³¢æµªåŠ¨ç”» â†’ ä¸“ä¸šé«˜çº§ âœ“
```

---

## ğŸ”® æœªæ¥æ‰©å±•

1. **äº‘ç«¯åŒæ­¥**: å°† IndexedDB æ•°æ®å®šæœŸåŒæ­¥åˆ°æœåŠ¡å™¨
2. **ç¦»çº¿æ¨¡å¼**: PWA + IndexedDB å®ç°å®Œå…¨ç¦»çº¿å­¦ä¹ 
3. **æ•°æ®åˆ†æ**: åŸºäºå†å²è®°å½•ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
4. **æ™ºèƒ½æé†’**: æ£€æµ‹åˆ°è¿‡æœŸæ•°æ®æ—¶æä¾›"ç»§ç»­ç»ƒä¹ "é€‰é¡¹

---

## ğŸ“ æ€»ç»“

é€šè¿‡æœ¬æ¬¡æ‰©å±•ä¼˜åŒ–ï¼ŒLearnSphere AI å‰ç«¯å®ç°äº†ï¼š

âœ… **å¤šè§†å›¾æ”¯æŒ** - Grammarã€Readingã€Writing å…¨è¦†ç›–
âœ… **æ™ºèƒ½è¿‡æœŸ** - 24h è‡ªåŠ¨æ¸…ç†ï¼Œä¿æŒæ•°æ®æ–°é²œ
âœ… **å¤§å®¹é‡å­˜å‚¨** - IndexedDB 50MB+ï¼Œæ— é™å†å²è®°å½•
âœ… **é«˜çº§åŠ¨ç”»** - æ³¢æµªéª¨æ¶å±ï¼Œä¸“ä¸šè§†è§‰ä½“éªŒ

æ‰€æœ‰åŠŸèƒ½éƒ½æ˜¯**æ¸è¿›å¢å¼º**å¼çš„ï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½ï¼Œå¯ä»¥é€æ­¥åº”ç”¨ï¼ğŸ‰

---

**æ‰©å±•å®Œæˆæ—¶é—´**: 2026-01-20  
**ç‰ˆæœ¬**: v2.4.1 (Extended)
