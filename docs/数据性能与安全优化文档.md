# 数据性能与安全优化文档

## 概述
为了提升 LearnSphere AI 的性能并保护核心词汇资产不被爬虫轻易抓取，我们对词汇模块进行了深度优化。

## 1. 性能优化：动态 API 模式

### 1.1 背景
之前前端 `src/data` 目录下存储了大量的静态 JS 词汇文件（如 `coca_words.js`, `cet6_words.js` 等），总体积超过 6MB。这导致：
- **首屏加载慢**：用户需要下载数兆的 JS 文件才能开始使用。
- **内存占用高**：所有词汇在浏览器启动时即被加载到内存中。
- **难以维护**：数据更新需要重新打包前端代码。

### 1.2 优化措施
- **数据迁移**：将所有词汇数据迁移至后端数据库（MySQL）。
- **按需加载**：前端通过 `VocabularyView` 和 `VocabularyStore` 调用 API 分页获取数据。
- **精简前端包**：重构了 `VocabularyDatabase.js`，移除了所有大的静态导入，显著减小了生成的厂商包（vendor bundle）体积。

## 2. 安全优化：防爬虫保护

### 2.1 需求
用户希望保护词汇数据，防止被竞争对手或爬虫脚本批量抓取。

### 2.2 优化措施 (Content Security)
- **动态异或加密 (Daily Dynamic XOR)**：后端 `ContentSecurityUtil` 不再使用固定密钥，而是将静态 Salt 与当前日期叠加生成的动态密钥进行加密。这意味着：
  - 加密后的密文**每天都会自动变换**，即使爬虫抓取了历史数据，只要密钥更新，旧的解密脚本就会失效。
- **动态解码同步**：前端 `crypto.js` 采用相同的算法计算当天的动态密钥进行实时解密。
- **Referer 来源校验**：通过 `SecurityHeaderFilter` 限制只有来自本域（如 localhost 或正式域名）的请求才能访问词汇接口，阻止通过 `curl` 或 Postman 进行简单的暴力抓取。

### 3. 系统性能优化
- **响应压缩 (Gzip)**：后端开启了 HTTP Gzip 压缩，对于 JSON 词汇数据，传输体积可压缩 70% 以上，极大地提升了弱网环境下的加载速度。
- **索引优化**：在 `vocabulary` 表上增加了 `word`、`exam_type`、`frequency` 和 `difficulty` 的索引，确保高并发下的查询速度。
- **接口限流 (Rate Limiting)**：对词汇相关接口应用了基于 Redis 的高频访问限制（每分钟 30-100 次，根据接口敏感度不同），有效对抗自动化扫描工具。

## 4. 用户体验 (UX) 增强：交互微动效 (Micro-interactions)
为了打造高端（Premium）的产品体验，我们引入了多项细腻的交互动效：
- **卡片悬浮提升 (Hover Lift)**：词汇卡片在鼠标悬停时会有平滑的位移和缩放，并带有阴影深度变化。
- **光泽掠影 (Shine Effect)**：高价值卡片带有掠影动画，增强视觉质感。
- **按压缩放 (Active Shrink)**：所有交互按钮及音标图标在点击时提供微小的缩放反馈。
- **进入动画 (Entrance Animations)**：列表项采用交错式位移进入（Staggered Slide-up），学习界面采用缩放进入（Zoom-in）。
- **状态感知 (State Awareness)**：
  - 学习完成后的奖杯带有浮动动画（Trophy Float）。
  - 掌握/未掌握按钮带有特定的悬停发光（Glow）提醒。
  - 模态框背景自动虚化（Backdrop Blur），增强内容聚焦。

## 4. 后续建议
- **频率限制**：建议在网关层或 Sa-Token 拦截器中针对 `/api/vocabulary/**` 接口开启 IP 访问限制（Rate Limiting）。
- **用户鉴权**：目前已通过 Sa-Token 确保只有登录用户能访问高价值词汇详情。
