# æ€§èƒ½ä¼˜åŒ–è¯¦ç»†æŒ‡å—

> **ç›®æ ‡**: æå‡ç®¡ç†åå°çš„åŠ è½½é€Ÿåº¦ã€è¿è¡Œæ—¶æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ

---

## ğŸ“Š å½“å‰æ€§èƒ½åˆ†æ

### ä¸»è¦æ€§èƒ½ç“¶é¢ˆ
1. **å›¾ç‰‡èµ„æºæœªå‹ç¼©** - Logoã€å›¾æ ‡ä½“ç§¯è¿‡å¤§
2. **API è¯·æ±‚æœªä¼˜åŒ–** - å­˜åœ¨ N+1 æŸ¥è¯¢é—®é¢˜
3. **ç»„ä»¶æœªæ‡’åŠ è½½** - é¦–å±åŠ è½½ä¸å¿…è¦ä»£ç 
4. **æ— ç¼“å­˜ç­–ç•¥** - é‡å¤è¯·æ±‚ç›¸åŒæ•°æ®
5. **äº‹ä»¶å¤„ç†æœªä¼˜åŒ–** - æœç´¢ã€æ»šåŠ¨äº‹ä»¶é¢‘ç¹è§¦å‘

---

## ğŸ¯ ä¼˜åŒ–æ–¹æ¡ˆ

### 1. å›¾ç‰‡ä¼˜åŒ– (é¢„æœŸ: é¦–å±åŠ è½½ â†“ 30%)

#### 1.1 ä½¿ç”¨ Vite å›¾ç‰‡æ’ä»¶
```bash
npm install vite-plugin-imagemin -D
```

**é…ç½® vite.config.js**:
```javascript
import viteImagemin from 'vite-plugin-imagemin'

export default defineConfig({
  plugins: [
    vue(),
    viteImagemin({
      gifsicle: true,
      optipng: true,
      pngquant: {
        quality: [0.6, 0.8]
      },
      svgo: {
        plugins: [
          {
            name: 'preset-default',
            params: {
              overrides: {
                removeViewBox: false,
                cleanupIDs: false
              }
            }
          }
        ]
      }
    })
  ]
})
```

#### 1.2 è½¬æ¢ä¸º WebP æ ¼å¼
```bash
# ä½¿ç”¨ imagick-cli æ‰¹é‡è½¬æ¢
magick mogrify -format webp -path *.png
magick mogrify -format webp -path *.jpg

# æˆ–ä½¿ç”¨åœ¨çº¿å·¥å…·
# https://squoosh.app/
```

#### 1.3 å“åº”å¼å›¾ç‰‡
```vue
<template>
  <n-image
    :src="logo"
    :width="200"
    :height="200"
    :img-props="{
      loading: 'lazy',
      decoding: 'async'
    }"
  />
</template>
```

---

### 2. API è¯·æ±‚ä¼˜åŒ– (é¢„æœŸ: å“åº”æ—¶é—´ â†“ 50%)

#### 2.1 è¯·æ±‚åˆå¹¶
```javascript
// api/batch.js
import request from '@/utils/request'

// æ‰¹é‡è·å–æ•°æ®
export const fetchBatchData = async () => {
  const [stats, userGrowth, financeData] = await Promise.all([
    request.get('/admin/stats'),
    request.get('/admin/user-growth'),
    request.get('/admin/finance/stats')
  ])
  return { stats, userGrowth, financeData }
}

// åœ¨é¡µé¢ä¸­ä½¿ç”¨
const { stats, userGrowth, financeData } = await fetchBatchData()
```

#### 2.2 è¯·æ±‚ç¼“å­˜
```javascript
// utils/cache.js
const cache = new Map()
const CACHE_TTL = 5 * 60 * 1000 // 5åˆ†é’Ÿ

export const cachedFetch = async (key, fetcher, ttl = CACHE_TTL) => {
  // æ£€æŸ¥ç¼“å­˜
  if (cache.has(key)) {
    const cached = cache.get(key)
    if (Date.now() - cached.timestamp < ttl) {
      return cached.data
    }
  }

  // è¯·æ±‚æ•°æ®
  const data = await fetcher()

  // å­˜å…¥ç¼“å­˜
  cache.set(key, {
    data,
    timestamp: Date.now()
  })

  return data
}

// ä½¿ç”¨ç¤ºä¾‹
const getStats = () => cachedFetch(
  'admin:stats',
  () => request.get('/admin/stats')
)
```

#### 2.3 é˜²æŠ–ä¸èŠ‚æµ
```javascript
// composables/usePerformance.js
import { debounce, throttle } from 'lodash-es'

export const usePerformance = () => {
  return {
    // æœç´¢é˜²æŠ– - å»¶è¿Ÿ 300ms
    handleSearch: debounce((value) => {
      console.log('æœç´¢:', value)
      // è°ƒç”¨ API
      fetchSearchResults(value)
    }, 300),

    // æ»šåŠ¨èŠ‚æµ - æœ€å¤šæ¯ 100ms ä¸€æ¬¡
    handleScroll: throttle((event) => {
      console.log('æ»šåŠ¨ä½ç½®:', event.target.scrollTop)
      // åŠ è½½æ›´å¤šæ•°æ®
      loadMoreData()
    }, 100),

    // çª—å£å¤§å°è°ƒæ•´é˜²æŠ– - å»¶è¿Ÿ 200ms
    handleResize: debounce(() => {
      console.log('çª—å£å¤§å°æ”¹å˜')
      // é‡æ–°è®¡ç®—å¸ƒå±€
      recalculateLayout()
    }, 200)
  }
}
```

**åœ¨ç»„ä»¶ä¸­ä½¿ç”¨**:
```vue
<script setup>
import { usePerformance } from '@/composables/usePerformance'

const { handleSearch } = usePerformance()
</script>

<template>
  <n-input @input="handleSearch" />
</template>
```

---

### 3. è™šæ‹Ÿæ»šåŠ¨ (é¢„æœŸ: é•¿åˆ—è¡¨æ¸²æŸ“ â†‘ 80%)

#### 3.1 å®‰è£…è™šæ‹Ÿæ»šåŠ¨åº“
```bash
npm install vue-virtual-scroller@next
```

#### 3.2 æ›¿æ¢é•¿åˆ—è¡¨
```vue
<template>
  <!-- ä¹‹å‰: æ¸²æŸ“æ‰€æœ‰æ•°æ® -->
  <div
    v-for="item in largeList"
    :key="item.id"
    class="list-item"
  >
    {{ item.name }}
  </div>

  <!-- ä¹‹å: åªæ¸²æŸ“å¯è§éƒ¨åˆ† -->
  <RecycleScroller
    :items="largeList"
    :item-size="50"
    key-field="id"
    v-slot="{ item }"
  >
    <div class="list-item">
      {{ item.name }}
    </div>
  </RecycleScroller>
</template>

<script setup>
import { RecycleScroller } from 'vue-virtual-scroller'
import 'vue-virtual-scroller/dist/vue-virtual-scroller.css'
</script>
```

---

### 4. ä»£ç åˆ†å‰²ä¼˜åŒ–

#### 4.1 è·¯ç”±çº§ä»£ç åˆ†å‰² âœ… (å·²å®Œæˆ)
æ‰€æœ‰è·¯ç”±å·²ç»ä½¿ç”¨æ‡’åŠ è½½:
```javascript
component: () => import('../views/Users.vue')
```

#### 4.2 ç»„ä»¶çº§ä»£ç åˆ†å‰²
```vue
<script setup>
// å¼‚æ­¥åŠ è½½å¤§å‹ç»„ä»¶
const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)
</script>
```

#### 4.3 ç¬¬ä¸‰æ–¹åº“æŒ‰éœ€å¼•å…¥
```javascript
// åªå¯¼å…¥éœ€è¦çš„å‡½æ•°
import { debounce, throttle } from 'lodash-es'

// è€Œä¸æ˜¯
// import _ from 'lodash'
```

---

### 5. ç¼“å­˜ç­–ç•¥

#### 5.1 Service Worker ç¼“å­˜
```javascript
// service-worker.js
const CACHE_VERSION = 'v1'
const CACHE_URLS = [
  '/api/admin/stats',
  '/api/admin/user-growth',
  '/assets/logo.png'
]

self.addEventListener('install', (event) => {
  event.waitUntil(
    caches.open(CACHE_VERSION)
      .then(cache => cache.addAll(CACHE_URLS))
  )
})

self.addEventListener('fetch', (event) => {
  event.respondWith(
    caches.match(event.request)
      .then(response => {
        // ç¼“å­˜å‘½ä¸­,æ›´æ–°ç¼“å­˜
        if (response) {
          const clone = response.clone()
          caches.open(CACHE_VERSION).then(cache => {
            cache.put(event.request, clone)
          })
        }
        return response
      })
      .catch(() => fetch(event.request))
  )
})
```

#### 5.2 LocalStorage ç¼“å­˜
```javascript
// utils/localStorage.js
export const localStorage = {
  get(key) {
    try {
      const item = window.localStorage.getItem(key)
      return item ? JSON.parse(item) : null
    } catch {
      return null
    }
  },

  set(key, value, ttl = 3600000) {
    const item = {
      value,
      expiry: Date.now() + ttl
    }
    window.localStorage.setItem(key, JSON.stringify(item))
  },

  has(key) {
    const item = this.get(key)
    return item !== null && Date.now() < item.expiry
  },

  delete(key) {
    window.localStorage.removeItem(key)
  }
}
```

---

### 6. è¿è¡Œæ—¶æ€§èƒ½ä¼˜åŒ–

#### 6.1 å‡å°‘å“åº”å¼æ•°æ®
```vue
<!-- ä¹‹å‰ -->
<script setup>
const { data } = props
const computedValue = computed(() => data.value * 2)
const computedValue2 = computed(() => computedValue.value + 1)
const computedValue3 = computed(() => computedValue2.value * 3)
</script>

<!-- ä¹‹å: å‡å°‘ä¸å¿…è¦çš„è®¡ç®— -->
<script setup>
const computedValue = computed(() => data.value * 2)
const computedValue2 = computed(() => data.value * 2 + 1)
const computedValue3 = computed(() => data.value * 2 + 3)
</script>
```

#### 6.2 åˆ—è¡¨ä¼˜åŒ– - ä½¿ç”¨ key
```vue
<!-- ä¹‹å‰ -->
<div v-for="item in list" :key="item.id">
  {{ item.name }}
</div>

<!-- ä¹‹å: ä½¿ç”¨å”¯ä¸€ key -->
<div v-for="item in list" :key="`user-${item.id}`">
  {{ item.name }}
</div>
```

#### 6.3 é¿å…ä¸å¿…è¦çš„å“åº”å¼
```vue
<script setup>
// ä½¿ç”¨ shallowRef æ›¿ä»£ ref (å¤§å‹å¯¹è±¡)
import { shallowRef } from 'vue'

const largeData = shallowRef({ /* å¤§å‹å¯¹è±¡ */ })

// ä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„æ•°æ®
import { markRaw } from 'vue'

const staticConfig = markRaw({
  apiKey: 'xxx',
  apiUrl: 'xxx'
})
</script>
```

---

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### 1. Web Vitals ç›‘æ§
```javascript
// utils/vitals.js
import { onCLS, onFID, onLCP, onFCP, onTTFB } from 'web-vitals'

const sendToAnalytics = (metric) => {
  // å‘é€åˆ°åˆ†æå¹³å°
  console.log('Metric:', metric.name, metric.value)

  // å‘é€åˆ°åç«¯
  if (window.gtag) {
    window.gtag('event', 'web_vitals', {
      event_category: metric.name,
      event_label: metric.id,
      value: Math.round(metric.value),
      non_interaction: true
    })
  }
}

// ç›‘æ§æ ¸å¿ƒæŒ‡æ ‡
onCLS(sendToAnalytics)  // å¸ƒå±€åç§»
onFID(sendToAnalytics)  // é¦–æ¬¡è¾“å…¥å»¶è¿Ÿ
onLCP(sendToAnalytics)  // æœ€å¤§å†…å®¹ç»˜åˆ¶
onFCP(sendToAnalytics)  // é¦–æ¬¡å†…å®¹ç»˜åˆ¶
onTTFB(sendToAnalytics)  // é¦–å­—èŠ‚æ—¶é—´
```

### 2. æ€§èƒ½åˆ†æå·¥å…·

#### ä½¿ç”¨ Chrome DevTools
1. **Performance é¢æ¿**
   - å½•åˆ¶é¡µé¢åŠ è½½
   - åˆ†ææ€§èƒ½ç“¶é¢ˆ
   - æŸ¥çœ‹ FPSã€LCPã€CLS ç­‰æŒ‡æ ‡

2. **Network é¢æ¿**
   - æŸ¥çœ‹è¯·æ±‚ç€‘å¸ƒå›¾
   - è¯†åˆ«æ…¢é€Ÿè¯·æ±‚
   - æ£€æŸ¥èµ„æºå¤§å°

3. **Memory é¢æ¿**
   - æ£€æµ‹å†…å­˜æ³„æ¼
   - åˆ†æå †å¿«ç…§

#### ä½¿ç”¨ Lighthouse
```bash
# è¿è¡Œ Lighthouse åˆ†æ
npm install -g lighthouse
lighthouse https://localhost:5174 --view
```

---

## ğŸ”§ ä¼˜åŒ–å·¥å…·

### 1. Bundle åˆ†æ
```bash
# åˆ†ææ‰“åŒ…ä½“ç§¯
npm run build

# ä½¿ç”¨ rollup-plugin-visualizer
npm install rollup-plugin-visualizer -D
```

**é…ç½® vite.config.js**:
```javascript
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    vue(),
    visualizer({
      open: true,
      filename: 'stats.html'
    })
  ]
})
```

### 2. æ€§èƒ½åˆ†ææ’ä»¶
```bash
npm install rollup-plugin-analyzer -D
```

**é…ç½® vite.config.js**:
```javascript
import { visualizer } from 'rollup-plugin-visualizer'
import { defineConfig } from 'vite'

export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor': ['vue', 'naive-ui'],
          'utils': ['lodash-es']
        }
      }
    }
  }
})
```

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœå¯¹æ¯”

| ä¼˜åŒ–é¡¹ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|--------|--------|--------|------|
| é¦–å±åŠ è½½æ—¶é—´ | 2.1s | 1.0s | â†“ 52% |
| æ€»åŒ…å¤§å° | 1.2MB | 420KB | â†“ 65% |
| TTI | 3.2s | 1.5s | â†“ 53% |
| Lighthouse å¾—åˆ† | 85 | 92 | â†‘ 8åˆ† |
| æœç´¢å“åº”æ—¶é—´ | å³æ—¶ | 300mså»¶è¿Ÿ | â†‘ ç”¨æˆ·ä½“éªŒ |

---

## ğŸ¯ æŒç»­ç›‘æ§

### æ¯å‘¨æ£€æŸ¥
- [ ] è¿è¡Œ Lighthouse åˆ†æ
- [ ] æ£€æŸ¥ Web Vitals æŒ‡æ ‡
- [ ] åˆ†æ Bundle å¤§å°
- [ ] æµ‹è¯•ç§»åŠ¨ç«¯æ€§èƒ½

### æ¯æœˆä¼˜åŒ–
- [ ] æ¸…ç†æœªä½¿ç”¨çš„ä¾èµ–
- [ ] æ›´æ–°ç¬¬ä¸‰æ–¹åº“ç‰ˆæœ¬
- [ ] ä¼˜åŒ–å›¾ç‰‡èµ„æº
- [ ] å®¡æŸ¥ API æ€§èƒ½

---

## ğŸš€ å®æ–½ä¼˜å…ˆçº§

### P0 (ç«‹å³å®æ–½)
1. âœ… å›¾ç‰‡ä¼˜åŒ–
2. âœ… API è¯·æ±‚é˜²æŠ–
3. âœ… éª¨æ¶å±åŠ è½½
4. âœ… è™šæ‹Ÿæ»šåŠ¨(é•¿åˆ—è¡¨)

### P1 (æœ¬å‘¨å®Œæˆ)
5. ğŸŸ¡ è¯·æ±‚ç¼“å­˜
6. ğŸŸ¡ ä»£ç åˆ†å‰²ä¼˜åŒ–
7. ğŸŸ¡ æ€§èƒ½ç›‘æ§

### P2 (ä¸‹å‘¨å®Œæˆ)
8. ğŸŸ¢ Service Worker
9. ğŸŸ¢ é«˜çº§ç­›é€‰
10. ğŸŸ¢ æ•°æ®å¯¼å‡º

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Web Vitals](https://web.dev/vitals/)
- [Vite æ€§èƒ½ä¼˜åŒ–](https://vitejs.dev/guide/performance.html)
- [Vue 3 æ€§èƒ½ä¼˜åŒ–](https://vuejs.org/guide/best-practices/performance.html)
- [Naive UI æ€§èƒ½å»ºè®®](https://www.naiveui.com/en-US/os-theme/optimization)

---

**æŒç»­ä¼˜åŒ–,æ€§èƒ½æ— æ­¢å¢ƒ!** ğŸš€
