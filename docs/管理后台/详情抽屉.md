# 交互体验增强组件使用指南

本指南介绍如何使用新增的两个增强交互组件:
1. **DetailDrawer** - 侧边抽屉式详情查看
2. **CommandPalette** - 全局命令面板 (Ctrl+K)

---

## 1. DetailDrawer - 侧边抽屉组件

### 特性
- 从页面右侧平滑滑出
- 响应式宽度设计
- 支持多种数据类型展示
- 优雅的动画效果
- 支持 ESC 键关闭

### 基础用法

```vue
<script setup>
import { ref } from 'vue'
import DetailDrawer from '@/components/DetailDrawer.vue'

const showDrawer = ref(false)
const loading = ref(false)

// 快速信息卡片数据
const quickInfo = ref({
  totalUsers: { label: '总用户数', value: '12,345', valueClass: 'value-primary' },
  activeUsers: { label: '活跃用户', value: '8,901', valueClass: 'value-success' },
  vipUsers: { label: 'VIP用户', value: '1,234', valueClass: 'value-warning' }
})

// 详细信息分组
const detailSections = ref([
  {
    title: '基本信息',
    items: [
      { label: '用户ID', value: '12345' },
      { label: '用户名', value: 'john_doe' },
      { label: '邮箱', value: 'john@example.com' },
      { label: '状态', value: '正常', tag: true, tagType: 'success' }
    ]
  },
  {
    title: 'VIP信息',
    items: [
      { label: 'VIP等级', value: 'Level 3' },
      { label: '到期时间', value: '2026-12-31' },
      { label: '配额', value: '1000/5000' }
    ]
  }
])

// 时间线数据
const timeline = ref([
  {
    title: '用户登录',
    content: '用户从 IP 192.168.1.1 登录',
    time: '2026-02-22 10:30',
    type: 'success'
  },
  {
    title: 'VIP续费',
    content: '用户续费了 VIP 会员',
    time: '2026-02-21 15:20',
    type: 'info'
  }
])

const handleEdit = (data) => {
  console.log('编辑:', data)
}

const handleDelete = (data) => {
  console.log('删除:', data)
}

const handleRefresh = (data) => {
  console.log('刷新:', data)
}
</script>

<template>
  <detail-drawer
    v-model:show="showDrawer"
    title="用户详情"
    subtitle="ID: 12345"
    type="user"
    :data="quickInfo"
    :quick-info="quickInfo"
    :detail-sections="detailSections"
    :timeline="timeline"
    :loading="loading"
    :show-edit="true"
    :show-delete="true"
    :show-refresh="true"
    @edit="handleEdit"
    @delete="handleDelete"
    @refresh="handleRefresh"
  />
</template>
```

### Props 参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| show | Boolean | false | 控制抽屉显示/隐藏 |
| title | String | '详情' | 标题 |
| subtitle | String | '' | 副标题(显示为标签) |
| type | String | 'default' | 类型: user/log/sensitive/prompt/default |
| data | Object | {} | 数据对象 |
| width | Number\|String | 600 | 抽屉宽度 |
| showEdit | Boolean | false | 是否显示编辑按钮 |
| showDelete | Boolean | false | 是否显示删除按钮 |
| showRefresh | Boolean | false | 是否显示刷新按钮 |
| showFooter | Boolean | true | 是否显示底部操作栏 |
| quickInfo | Object | null | 快速信息卡片数据 |
| detailSections | Array | [] | 详细信息分组 |
| timeline | Array | [] | 时间线数据 |
| loading | Boolean | false | 加载状态 |

### Events 事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| update:show | 显示状态变化 | (value: boolean) |
| edit | 点击编辑按钮 | (data: Object) |
| delete | 点击删除按钮 | (data: Object) |
| refresh | 点击刷新按钮 | (data: Object) |

### Slots 插槽

| 插槽名 | 说明 | 作用域参数 |
|--------|------|------------|
| content | 自定义内容 | data, loading |

---

## 2. CommandPalette - 全局命令面板

### 特性
- **Ctrl+K** (Mac: Cmd+K) 快捷键唤起
- 模糊搜索算法
- 支持搜索页面、功能、用户ID
- 键盘导航支持
- 分组显示结果

### 在 App.vue 中集成

```vue
<script setup>
import { ref } from 'vue'
import CommandPalette from '@/components/CommandPalette.vue'

const showCommandPalette = ref(false)

// 自定义搜索 API (可选)
const searchApi = async (query) => {
  // 调用后端搜索接口
  const res = await fetch(`/api/search?q=${query}`)
  return res.json()
}

const handleCommandSelect = (item) => {
  console.log('选中:', item)
}
</script>

<template>
  <command-palette
    v-model:show="showCommandPalette"
    :api="searchApi"
    @select="handleCommandSelect"
  />
</template>
```

### 预设命令

命令面板包含以下预设命令:

#### 页面导航
- 数据概览
- 用户管理
- AI 治理
- 内容审核
- 操作日志
- Redis 管理

#### 快速操作
- A/B 实验 (⌘⇧E)
- 重载词库 (⌘⇧R)
- 发送通知 (⌘⇧N)
- 清空缓存 (⌘⇧C)

### 自定义命令

编辑 `CommandPalette.vue` 中的 `commands` 数组添加新命令:

```javascript
{
  id: 'my-custom-command',
  type: 'action', // 或 'navigation', 'help'
  title: '我的自定义命令',
  description: '命令描述',
  icon: MyIcon,
  route: '/my-page', // 对于导航类型
  action: 'my-action', // 对于操作类型
  shortcut: '⌘⇧M', // 可选快捷键提示
  keywords: ['搜索关键词', '别名'],
  hot: true // 是否标记为热门
}
```

### Props 参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| show | Boolean | false | 控制面板显示/隐藏 |
| api | Function | null | 搜索API函数 |

### Events 事件

| 事件名 | 说明 | 回调参数 |
|--------|------|----------|
| update:show | 显示状态变化 | (value: boolean) |
| select | 选择项目 | (item: Object) |

---

## 3. 实际应用示例

### 示例1: 用户列表中使用 DetailDrawer

```vue
<!-- Users.vue -->
<script setup>
import DetailDrawer from '@/components/DetailDrawer.vue'

const selectedUser = ref(null)
const showUserDrawer = ref(false)

const viewUserDetail = (user) => {
  selectedUser.value = user
  showUserDrawer.value = true
}

const quickInfo = computed(() => ({
  userId: { label: '用户ID', value: selectedUser.value?.id },
  username: { label: '用户名', value: selectedUser.value?.username },
  status: { label: '状态', value: selectedUser.value?.status, tag: true }
}))
</script>

<template>
  <n-data-table
    :columns="columns"
    :data="users"
    :row-props="row => ({
      onDblclick: () => viewUserDetail(row)
   })"
  />

  <detail-drawer
    v-model:show="showUserDrawer"
    title="用户详情"
    type="user"
    :data="selectedUser"
    :quick-info="quickInfo"
    :show-edit="true"
  />
</template>
```

### 示例2: AI 治理页面使用

```vue
<!-- AIGovernance.vue -->
<script setup>
const showLogDrawer = ref(false)
const selectedLog = ref(null)

const viewLogDetail = (log) => {
  selectedLog.value = log
  showLogDrawer.value = true
}
</script>

<template>
  <n-button @click="viewLogDetail(log)">
    查看详情
  </n-button>

  <detail-drawer
    v-model:show="showLogDrawer"
    title="AI 调用日志"
    type="log"
    :data="selectedLog"
    width="800"
  />
</template>
```

---

## 4. 样式定制

组件使用 Naive UI 的主题变量,可以通过覆盖 CSS 变量来自定义样式:

```css
.detail-drawer {
  --drawer-width: 600px;
  --drawer-bg: var(--n-color);
}

.command-palette-container {
  --palette-max-width: 600px;
  --palette-bg: var(--n-color);
}
```

---

## 5. 最佳实践

### DetailDrawer
- **宽度选择**: 用户详情用 600px,日志详情用 800px
- **信息分组**: 使用 detailSections 将信息逻辑分组
- **快速信息**: quickInfo 应显示最重要的3-6个指标
- **加载状态**: 数据加载时显示 loading 状态

### CommandPalette
- **快捷键**: 为常用功能添加快捷键提示
- **关键词**: 每个命令至少提供3个关键词别名
- **热门标记**: 将高频操作标记为 hot
- **API搜索**: 对于用户ID等精确搜索,使用 API 集成

---

## 6. 注意事项

1. **性能**: DetailDrawer 内容较多时考虑虚拟滚动
2. **响应式**: 在移动端抽屉会自动全宽
3. **快捷键冲突**: 确保全局快捷键不与浏览器快捷键冲突
4. **无障碍**: 两个组件都支持键盘操作和 ESC 关闭

---

## 更新日志

- **v1.0.0** (2026-02-22): 初始版本
  - DetailDrawer 组件
  - CommandPalette 组件
  - 完整文档和使用示例
