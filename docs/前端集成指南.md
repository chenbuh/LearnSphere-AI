# å‰ç«¯é›†æˆå®ŒæˆæŒ‡å—

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. API æ–‡ä»¶åˆ›å»º
- âœ… `frontend-vue/src/api/mastery.js` - æŒæ¡åº¦APIå®¢æˆ·ç«¯

### 2. é›†æˆç¤ºä¾‹
- âœ… `VocabularyView_Integration_Example.js` - è¯¦ç»†é›†æˆç¤ºä¾‹ä»£ç 

---

## ğŸš€ ç«‹å³é›†æˆï¼ˆ3æ­¥ï¼‰

### æ­¥éª¤1ï¼šåœ¨ VocabularyView.vue ä¸­æ·»åŠ äº‘ç«¯åŒæ­¥

æ‰“å¼€ `frontend-vue/src/views/VocabularyView.vue`ï¼Œæ‰¾åˆ° `handleResult` å‡½æ•°ï¼ˆå¤§çº¦ç¬¬207è¡Œï¼‰ï¼Œä¿®æ”¹ä¸ºï¼š

```javascript
const handleResult = async (correct) => {
  const word = currentLearnWord.value
  if (!word) return

  // è®°å½•ç»Ÿè®¡
  if (correct) sessionStats.value.correct++
  else sessionStats.value.wrong++

  // æœ¬åœ°å­˜å‚¨
  vocabStore.recordResult(word, correct)

  // ã€æ–°å¢ã€‘äº‘ç«¯åŒæ­¥
  try {
    await masteryApi.recordReview(word.id, correct)
  } catch (error) {
    console.error('[Mastery] Sync failed:', error)
  }

  // ç»§ç»­ä¸‹ä¸€é¢˜
  if (sessionIndex.value < sessionWords.value.length - 1) {
    sessionIndex.value++
    isFlipped.value = false
    setTimeout(() => {
      playAudio(currentLearnWord.value?.word)
    }, 300)
  } else {
    sessionComplete.value = true
  }
}
```

**å…³é”®ä¿®æ”¹**ï¼š
1. å‡½æ•°æ”¹ä¸º `async`
2. æ·»åŠ  `await masteryApi.recordReview(word.id, correct)`
3. ç”¨ `try-catch` åŒ…è£¹ï¼Œå¤±è´¥ä¸å½±å“å­¦ä¹ 

---

### æ­¥éª¤2ï¼šï¼ˆå¯é€‰ï¼‰æ˜¾ç¤ºäº‘ç«¯ç»Ÿè®¡

åœ¨ `VocabularyView.vue` é¡¶éƒ¨ state åŒºåŸŸæ·»åŠ ï¼š

```javascript
// åœ¨ script setup ä¸­æ·»åŠ 
const cloudStats = ref({
  mastered: 0,
  familiar: 0,
  learning: 0,
  not_started: 0
})

// åœ¨ onMounted ä¸­åŠ è½½
onMounted(async () => {
  loadBrowseData()
  
  // ã€æ–°å¢ã€‘åŠ è½½äº‘ç«¯ç»Ÿè®¡
  try {
    const res = await masteryApi.getStats()
    cloudStats.value = res.data
  } catch (error) {
    console.log('[Mastery] Stats not available')
  }
})
```

åœ¨æ¨¡æ¿çš„ç»Ÿè®¡å¡ç‰‡ä¸­æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰ï¼š

```vue
<n-grid-item>
  <n-card class="stat-card gold" :bordered="false">
    <div class="stat-content">
      <div class="stat-icon gold">
        <Trophy />
      </div>
      <div class="stat-info">
        <div class="stat-label">äº‘ç«¯å·²æŒæ¡</div>
        <div class="stat-value">
          <n-number-animation :from="0" :to="cloudStats.mastered" />
        </div>
      </div>
    </div>
  </n-card>
</n-grid-item>
```

---

### æ­¥éª¤3ï¼šæµ‹è¯•é›†æˆ

1. **å¯åŠ¨å‰ç«¯**
   ```bash
   cd frontend-vue
   npm run dev
   ```

2. **è¿›å…¥è¯æ±‡å­¦ä¹ é¡µé¢**
   - é€‰æ‹©"æ™ºèƒ½å­¦ä¹ "æ ‡ç­¾
   - å¼€å§‹ Session
   - ç­”é¢˜æ—¶æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°

3. **é¢„æœŸè¾“å‡º**
   ```
   [Mastery] âœ“ Synced: abandon
   [Mastery] âœ“ Synced: abstract
   ```

4. **éªŒè¯åç«¯**
   ```sql
   SELECT * FROM vocabulary_mastery WHERE user_id = 1;
   ```

---

## ğŸ“Š åŠŸèƒ½è¯´æ˜

### è‡ªåŠ¨åŒæ­¥æœºåˆ¶

```
ç”¨æˆ·ç­”é¢˜
  â†“
æœ¬åœ°è®°å½•ï¼ˆPinia Storeï¼‰
  â†“
äº‘ç«¯åŒæ­¥ï¼ˆmasteryApi.recordReviewï¼‰
  â†“
åç«¯ä¿å­˜åˆ°æ•°æ®åº“
  â†“
è®¡ç®—ä¸‹æ¬¡å¤ä¹ æ—¶é—´ï¼ˆè‰¾å®¾æµ©æ–¯æ›²çº¿ï¼‰
```

### ç¦»çº¿å®¹é”™

- âœ… ç½‘ç»œå¤±è´¥ä¸å½±å“å­¦ä¹ 
- âœ… æœ¬åœ°æ•°æ®ä¼˜å…ˆï¼Œäº‘ç«¯å¼‚æ­¥åŒæ­¥
- âœ… æ§åˆ¶å°æ˜¾ç¤ºåŒæ­¥çŠ¶æ€

---

## ğŸ¯ å¯é€‰ä¼˜åŒ–

### 1. æ‰¹é‡åŒæ­¥ï¼ˆæå‡æ€§èƒ½ï¼‰

å¦‚æœæ‹…å¿ƒæ¯æ¬¡ç­”é¢˜éƒ½è¯·æ±‚åç«¯å½±å“æ€§èƒ½ï¼Œå¯ä»¥æ”¹ä¸ºæ‰¹é‡åŒæ­¥ï¼š

```javascript
// åœ¨ session å®Œæˆåæ‰¹é‡åŒæ­¥
const submitSessionResults = async () => {
  const results = sessionWords.value.map((word, index) => ({
    vocabularyId: word.id,
    isCorrect: index < sessionStats.value.correct
  }))
  
  for (const result of results) {
    try {
      await masteryApi.recordReview(result.vocabularyId, result.isCorrect)
    } catch (error) {
      console.error('[Mastery] Batch sync failed:', result.vocabularyId)
    }
  }
}

// åœ¨ sessionComplete æ—¶è°ƒç”¨
watch(sessionComplete, (newVal) => {
  if (newVal) {
    submitSessionResults()
  }
})
```

### 2. æ˜¾ç¤ºå¤ä¹ æé†’

åœ¨é¦–é¡µæ·»åŠ "ä»Šæ—¥å¾…å¤ä¹ "æç¤ºï¼š

```javascript
const reviewCount = ref(0)

onMounted(async () => {
  const res = await masteryApi.getReviewList(100)
  reviewCount.value = res.data.length
  
  if (reviewCount.value > 0) {
    message.info(`ä»Šå¤©æœ‰ ${reviewCount.value} ä¸ªå•è¯éœ€è¦å¤ä¹ ï¼`)
  }
})
```

### 3. è¿›åº¦å¯è§†åŒ–

æ·»åŠ æŒæ¡åº¦è¿›åº¦æ¡ï¼š

```vue
<n-card title="å­¦ä¹ è¿›åº¦">
  <n-progress
    type="line"
    :percentage="(cloudStats.mastered / cloudStats.total) * 100"
    :show-indicator="false"
    color="#22c55e"
  />
  <p class="mt-2">
    å·²æŒæ¡ {{ cloudStats.mastered }} / {{ cloudStats.total }} ä¸ªå•è¯
  </p>
</n-card>
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯·æ±‚æ—¥å¿—

æµè§ˆå™¨æ§åˆ¶å° â†’ Network â†’ Filter "mastery"

### æŸ¥çœ‹æ•°æ®åº“

```sql
-- æŸ¥çœ‹ç”¨æˆ·æŒæ¡åº¦è®°å½•
SELECT 
  vm.*, 
  v.word, 
  v.translation 
FROM vocabulary_mastery vm
JOIN vocabulary v ON vm.vocabulary_id = v.id
WHERE vm.user_id = 1
ORDER BY vm.update_time DESC
LIMIT 10;

-- æŸ¥çœ‹ç»Ÿè®¡
SELECT 
  COUNT(*) as total,
  SUM(CASE WHEN mastery_level >= 5 THEN 1 ELSE 0 END) as mastered,
  SUM(CASE WHEN mastery_level >= 3 AND mastery_level < 5 THEN 1 ELSE 0 END) as familiar
FROM vocabulary_mastery
WHERE user_id = 1;
```

### APIæµ‹è¯•

```bash
# æµ‹è¯•è®°å½•
curl -X POST http://localhost:8080/api/vocabulary/mastery/record \
  -H "Content-Type: application/json" \
  -H "satoken: YOUR_TOKEN" \
  -d '{"vocabularyId":1,"isCorrect":true}'

# æµ‹è¯•ç»Ÿè®¡
curl http://localhost:8080/api/vocabulary/mastery/stats \
  -H "satoken: YOUR_TOKEN"
```

---

## âœ… éªŒè¯æ¸…å•

- [ ] API æ–‡ä»¶å·²åˆ›å»º (`mastery.js`)
- [ ] `handleResult` æ·»åŠ äº†äº‘ç«¯åŒæ­¥
- [ ] å¯åŠ¨å‰ç«¯ï¼Œè¿›å…¥è¯æ±‡å­¦ä¹ 
- [ ] ç­”é¢˜æ—¶æ§åˆ¶å°æ˜¾ç¤ºåŒæ­¥æ—¥å¿—
- [ ] æ•°æ®åº“ä¸­æœ‰æ–°è®°å½•
- [ ] ç»Ÿè®¡æ¥å£è¿”å›æ­£ç¡®æ•°æ®

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„è¯æ±‡å­¦ä¹ ç³»ç»Ÿå·²ç»å®ç°ï¼š
- âœ… äº‘ç«¯æ•°æ®åŒæ­¥
- âœ… æŒæ¡åº¦è¿½è¸ª
- âœ… æ™ºèƒ½å¤ä¹ è®¡åˆ’ï¼ˆè‰¾å®¾æµ©æ–¯æ›²çº¿ï¼‰
- âœ… è·¨è®¾å¤‡å­¦ä¹ è¿›åº¦åŒæ­¥

ä¸‹ä¸€æ­¥å¯ä»¥è€ƒè™‘ï¼š
1. åˆ›å»ºä¸“é—¨çš„"å¤ä¹ "é¡µé¢
2. ç”Ÿæˆå­¦ä¹ æŠ¥å‘Š
3. æ·»åŠ å­¦ä¹ æé†’åŠŸèƒ½
