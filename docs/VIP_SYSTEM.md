# VIP 系统与用户配额机制

## 概述
LearnSphere AI 的 VIP 系统依赖于服务端的权限拦截校验以及定时清理任务，以确保用户权益的精准管理。

## 核心机制

### 1. 权限拦截 (VipCheckAspect)
- 当用户访问带有 `@RequireVip` 注解的接口时，系统会实时判断当前用户的 `vipExpireTime` 是否大于当前时间。
- 对于功能相关的额度校验，同样会通过拦截器处理用户的每日 AI 调用配额和 AI 助教配额。

### 2. 自动过期拦截与处理
- 由于之前缺乏定时回收手段，导致部分已过期会员（`vipExpireTime < now()`）仍保留较高的 `dailyAiQuota` 和 `vipLevel` 返回给前端展示，造成“VIP 到期一直自动续费”的假象。
- 已引入 `VipCleanupTask` 定时任务。该任务会以周期性（每分钟）的方式扫描所有的用户数据表。一旦发现 `vipExpireTime` 早于当前系统时间，并且 `vipLevel > 0` 的用户，系统将自动把该用户的 `vipLevel` 重置为 `0`，并恢复基础 AI 配额为 `5`，助教配额为 `200` 等正常免费用户数值。

### 3. 数据更新
定时任务 `VipCleanupTask` 使用 MyBatis-Plus 在后台平滑刷新过期用户的数据库字段内容，无需人工干预即可保证数据的一致性。
