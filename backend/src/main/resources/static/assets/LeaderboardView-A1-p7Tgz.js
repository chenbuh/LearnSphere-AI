import{_ as P,u as Y,b as J,S as K,a as Q,c as N}from"./index-CZUTEx94.js";import{o as W,p as X,q as Z,F as R,f as M,i as O,T as ss,k as es,r as ts}from"./lucide-DtS2HtB5.js";import{r as v,j as $,S as as,ag as ls,p as h,z as c,q as l,s as a,u as t,ak as os,F as s,X as d,Y as A,H as x,I as u,a1 as y,_ as ns,J as k,a2 as j,U as is,ax as ds,ay as rs,W as T,Z as b,$ as q,K as E,a7 as cs,a8 as D,ab as us,as as vs,az as ms,ad as _s,ai as bs}from"./naive-ui-CN0IOFzZ.js";import"./echarts-5QPu3XI4.js";const fs={class:"leaderboard-hero relative overflow-hidden"},ps={class:"container relative py-20 text-center"},gs={class:"hero-badge mb-6 mx-auto flex items-center gap-3"},hs={class:"flex items-center gap-1.5"},xs={class:"flex items-center gap-1.5 opacity-80"},ys={class:"container pb-40"},ks={class:"stat-glass-card"},ws={key:0,class:"podium-section mb-20 animate-fade-in"},Ss={class:"podium-grid"},zs={key:0,class:"podium-spot rank-2-spot"},Ns={class:"podium-user"},Ts={class:"podium-info text-center mt-4"},Ds={class:"font-bold text-white text-lg"},Cs={class:"text-slate-400 text-sm"},Is={class:"podium-spot rank-1-spot"},Ls={class:"podium-user"},Us={class:"crown-svg mb-2"},Fs={class:"podium-info text-center mt-4"},Vs={class:"font-black text-white text-xl"},Bs={class:"text-yellow-500 font-bold"},Rs={key:1,class:"podium-spot rank-3-spot"},Ms={class:"podium-user"},$s={class:"podium-info text-center mt-4"},As={class:"font-bold text-white text-base"},js={class:"text-amber-700 text-sm"},qs={class:"personal-status-header mb-8"},Es={class:"info-layout"},Gs={class:"user-main"},Hs={class:"rank-indicator"},Ps={class:"value"},Ys={class:"user-detail"},Js={class:"name-box"},Ks={class:"nickname"},Qs={class:"user-actions"},Ws={class:"streak-badge"},Xs={class:"value"},Zs={class:"guest-msg"},Os={class:"flex items-center gap-4"},se={class:"msg-icon"},ee={class:"ranking-content-container"},te={class:"flex flex-col md:flex-row justify-between items-center mb-8 gap-6"},ae={class:"search-box w-full md:w-64"},le={key:0},oe={class:"rank-index"},ne={class:"flex items-center gap-4"},ie={class:"font-bold text-gray-100"},de={class:"text-xs text-gray-500"},re={class:"flex items-center gap-2"},ce={class:"text-white font-black text-lg"},ue={class:"text-indigo-400 font-bold"},ve={class:"hidden md:table-cell"},C=300,me={__name:"LeaderboardView",setup(_e){const I=Y(),L=J(),f=v(!0),i=v([]),p=v(""),U=v({totalUsers:0,activeToday:0,avgStreak:0}),m=v(null),g=v(null),_=v(0),F=async()=>{try{const{code:o,data:e}=await N.getPublicStats();o===200&&(U.value=e)}catch(o){console.error("Failed to fetch statistics",o)}},V=async()=>{if(L.token)try{const{code:o,data:e}=await N.getMyRank();o===200&&(m.value=e)}catch(o){console.error("Failed to fetch my rank",o)}},B=async(o=!0)=>{i.value.length===0&&(f.value=!0);try{const{code:e,data:n}=await N.getLeaderboard();if(e===200&&(i.value=n,o)){const r=new Date;g.value=r,_.value=C,localStorage.setItem("leaderboard_last_sync",r.getTime().toString())}}catch(e){console.error("Failed to fetch leaderboard",e)}finally{f.value=!1}},w=()=>{B(!0),F(),V()},S=$(()=>{const o=i.value||[];return p.value?o.filter(e=>e.nickname.toLowerCase().includes(p.value.toLowerCase())):o}),G=$(()=>{const o=Math.floor(_.value/60),e=_.value%60;return`${o}:${e.toString().padStart(2,"0")}`});let z=null;const H=()=>{const o=localStorage.getItem("leaderboard_last_sync"),e=new Date().getTime();if(o){const n=parseInt(o),r=Math.floor((e-n)/1e3);r<C?(_.value=C-r,g.value=new Date(n),B(!1),F(),V()):w()}else w()};return as(()=>{H(),z=setInterval(()=>{_.value>0?_.value--:w()},1e3)}),ls(()=>{z&&clearInterval(z)}),(o,e)=>(c(),h(t(bs),{class:"min-h-screen bg-dark"},{default:l(()=>[a(K),a(t(os),null,{default:l(()=>[s("div",fs,[e[5]||(e[5]=s("div",{class:"absolute inset-0 bg-gradient-to-b from-indigo-600/10 to-transparent"},null,-1)),s("div",ps,[s("div",gs,[s("div",hs,[a(t(W),{size:16,class:"text-yellow-400"}),s("span",null,"下次同步: "+d(G.value),1)]),a(t(A),{vertical:"",style:{"background-color":"rgba(255,255,255,0.1)"}}),s("div",xs,[a(t(X),{size:14}),s("span",null,"更新于 "+d(g.value?g.value.toLocaleTimeString():"---"),1)])]),e[3]||(e[3]=s("h1",{class:"text-6xl font-black mb-6 tracking-tight text-white glow-text"},[x(" 巅峰"),s("span",{class:"text-indigo-500"},"学习榜")],-1)),e[4]||(e[4]=s("p",{class:"text-xl text-gray-400 max-w-2xl mx-auto leading-relaxed"}," 自律是通往卓越的必经之路。记录每一位语海征途中的先行者，见证知识改变命运的力量。 ",-1))])]),s("div",ys,[a(t(ns),{"x-gap":"24","y-gap":"24",cols:"1 768:3",class:"mb-20 -mt-10 relative z-20"},{default:l(()=>[(c(),u(k,null,j({totalUsers:"累计学员",activeToday:"今日活跃",avgStreak:"平均打卡"},(n,r)=>a(t(is),{key:r},{default:l(()=>[s("div",ks,[a(t(ds),{label:n,value:U.value[r],class:"white-stats text-center"},rs({prefix:l(()=>[r==="totalUsers"?(c(),h(t(Z),{key:0,size:24,class:"text-indigo-400 mr-2"})):r==="activeToday"?(c(),h(t(R),{key:1,size:24,class:"text-orange-400 mr-2"})):(c(),h(t(M),{key:2,size:24,class:"text-emerald-400 mr-2"}))]),_:2},[r==="avgStreak"?{name:"suffix",fn:l(()=>[e[6]||(e[6]=s("span",{class:"text-base ml-1"},"天",-1))]),key:"0"}:void 0]),1032,["label","value"])])]),_:2},1024)),64))]),_:1}),!f.value&&i.value.length>=3?(c(),u("div",ws,[s("div",Ss,[i.value[1]?(c(),u("div",zs,[s("div",Ns,[a(t(T),{value:2,color:"#94a3b8",class:"rank-badge-top"},{default:l(()=>[a(t(b),{round:"",size:80,src:i.value[1].avatar,class:"border-4 border-slate-400 shadow-2xl"},null,8,["src"])]),_:1}),s("div",Ts,[s("div",Ds,d(i.value[1].nickname),1),s("div",Cs,"连胜 "+d(i.value[1].consecutiveDays)+" 天",1)])]),e[7]||(e[7]=s("div",{class:"podium-base base-2"},[s("div",{class:"base-number"},"2")],-1))])):y("",!0),s("div",Is,[s("div",Ls,[s("div",Us,[a(t(O),{size:32,class:"text-yellow-500"})]),a(t(T),{value:1,color:"#f59e0b",class:"rank-badge-top"},{default:l(()=>[a(t(b),{round:"",size:110,src:i.value[0].avatar,class:"border-4 border-yellow-500 shadow-[0_0_30px_rgba(245,158,11,0.3)]"},null,8,["src"])]),_:1}),s("div",Fs,[s("div",Vs,d(i.value[0].nickname),1),s("div",Bs,"领跑 "+d(i.value[0].consecutiveDays)+" 天",1)])]),e[8]||(e[8]=s("div",{class:"podium-base base-1"},[s("div",{class:"base-number"},"1")],-1))]),i.value[2]?(c(),u("div",Rs,[s("div",Ms,[a(t(T),{value:3,color:"#b45309",class:"rank-badge-top"},{default:l(()=>[a(t(b),{round:"",size:70,src:i.value[2].avatar,class:"border-4 border-amber-700 shadow-2xl"},null,8,["src"])]),_:1}),s("div",$s,[s("div",As,d(i.value[2].nickname),1),s("div",js,"连胜 "+d(i.value[2].consecutiveDays)+" 天",1)])]),e[9]||(e[9]=s("div",{class:"podium-base base-3"},[s("div",{class:"base-number"},"3")],-1))])):y("",!0)])])):y("",!0),s("div",qs,[a(t(q),{class:"personal-info-card",bordered:!1},{default:l(()=>[s("div",Es,[t(L).token&&m.value?(c(),u(k,{key:0},[s("div",Gs,[s("div",Hs,[e[10]||(e[10]=s("span",{class:"label"},"我的排名",-1)),s("span",Ps,"#"+d(m.value.rank),1)]),a(t(A),{vertical:""}),s("div",Ys,[a(t(b),{round:"",size:44,src:m.value.avatar,class:"border-2 border-indigo-500"},null,8,["src"]),s("div",Js,[s("div",Ks,d(m.value.nickname),1),e[11]||(e[11]=s("div",{class:"motto text-xs text-gray-400"},"持续进步，正在全力冲刺巅峰",-1))])])]),s("div",Qs,[s("div",Ws,[e[12]||(e[12]=s("span",{class:"label"},"连续打卡",-1)),s("span",Xs,d(m.value.consecutiveDays)+" 天",1)]),a(t(E),{type:"primary",size:"large",round:"",class:"action-btn",onClick:e[0]||(e[0]=n=>t(I).push("/dashboard"))},{default:l(()=>[...e[13]||(e[13]=[x(" 进入学习 ",-1)])]),_:1})])],64)):(c(),u(k,{key:1},[s("div",Zs,[s("div",Os,[s("div",se,[a(t(ss),{size:20,class:"text-indigo-400"})]),e[14]||(e[14]=s("div",null,[s("div",{class:"msg-title"},"开启你的巅峰学习之旅"),s("div",{class:"msg-desc"},"登录后即可在此查看你的实时排名与打卡成就")],-1))])]),a(t(E),{type:"primary",size:"large",round:"",class:"action-btn px-8",onClick:e[1]||(e[1]=n=>t(I).push("/login"))},{default:l(()=>[...e[15]||(e[15]=[x(" 立即加入 ",-1)])]),_:1})],64))])]),_:1})]),s("div",ee,[s("div",te,[a(t(cs),{type:"segment",class:"rank-filter-tabs w-full md:w-auto"},{default:l(()=>[a(t(D),{name:"overall",tab:"全站功勋榜"}),a(t(D),{name:"weekly",tab:"本周之星"}),a(t(D),{name:"monthly",tab:"月度黑马"})]),_:1}),s("div",ae,[a(t(us),{value:p.value,"onUpdate:value":e[2]||(e[2]=n=>p.value=n),placeholder:"搜索学员...",round:"",size:"large",class:"glass-input"},{prefix:l(()=>[a(t(es),{size:18,class:"text-gray-500"})]),_:1},8,["value"])])]),a(t(q),{class:"rank-card glass-card"},{default:l(()=>[a(t(vs),{show:f.value},{default:l(()=>[a(t(ms),{bordered:!1,"single-line":!1,class:"main-rank-table"},{default:l(()=>[e[17]||(e[17]=s("thead",null,[s("tr",null,[s("th",{width:"100"},"排名"),s("th",null,"学员详情"),s("th",null,"连续打卡"),s("th",{width:"140"},"累计学习"),s("th",{width:"180",class:"hidden md:table-cell"},"学术勋章"),s("th",{width:"80"})])],-1)),S.value.length>0?(c(),u("tbody",le,[(c(!0),u(k,null,j(i.value.length>=3?S.value.slice(3):S.value,(n,r)=>(c(),u("tr",{key:n.id,class:"rank-row"},[s("td",null,[s("div",oe,"#"+d(i.value.length>=3?r+4:r+1),1)]),s("td",null,[s("div",ne,[a(t(b),{round:"",size:48,src:n.avatar||"https://ui-avatars.com/api/?name="+n.nickname},null,8,["src"]),s("div",null,[s("div",ie,d(n.nickname),1),s("div",de,d(n.bio||"持之以恒，金石为开"),1)])])]),s("td",null,[s("div",re,[a(t(R),{size:16,class:"text-orange-500"}),s("span",ce,d(n.consecutiveDays),1)])]),s("td",null,[s("div",ue,d(n.totalDays)+" 天",1)]),s("td",ve,[a(t(_s),{size:"small",type:"success",ghost:"",round:""},{icon:l(()=>[a(t(M),{size:12})]),default:l(()=>[e[16]||(e[16]=x("稳步上升 ",-1))]),_:1})]),s("td",null,[a(t(ts),{size:18,class:"text-gray-700"})])]))),128))])):y("",!0)]),_:1})]),_:1},8,["show"])]),_:1})])]),a(Q)]),_:1})]),_:1}))}},he=P(me,[["__scopeId","data-v-5f5b5e83"]]);export{he as default};
