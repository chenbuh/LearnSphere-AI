import{a as J}from"./ai-CYMBpxnS.js";import{Y as N,_ as me,af as _e,r as f,Z as Y,V as q,o as ge,bm as he,v as ye,g as u,b as i,e,d as o,k as w,w as n,t as c,u as a,i as C,j as m,y as M,F as V,x as A,a3 as j,n as P,ax as K,ad as E,a2 as R,c as Q,bn as ke,ak as W,am as X,a8 as be,al as we,bo as Ce,h as Me,aj as ze}from"./index-DxUHCA-q.js";import{C as xe}from"./clock-BMOIfxbi.js";import{F as qe}from"./file-text-DmJNb7cX.js";import{R as ee}from"./rotate-ccw-C4DsUMxD.js";import{A as Ve}from"./arrow-left-DlNknngt.js";import{C as Ae}from"./circle-check-Ch9ZOaK_.js";import{H as Ne}from"./history-DU2rBN7r.js";const Se=N("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);const Be=N("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);const $e=N("drama",[["path",{d:"M10 11h.01",key:"d2at3l"}],["path",{d:"M14 6h.01",key:"k028ub"}],["path",{d:"M18 6h.01",key:"1v4wsw"}],["path",{d:"M6.5 13.1h.01",key:"1748ia"}],["path",{d:"M22 5c0 9-4 12-6 12s-6-3-6-12c0-2 2-3 6-3s6 1 6 3",key:"172yzv"}],["path",{d:"M17.4 9.9c-.8.8-2 .8-2.8 0",key:"1obv0w"}],["path",{d:"M10.1 7.1C9 7.2 7.7 7.7 6 8.6c-3.5 2-4.7 3.9-3.7 5.6 4.5 7.8 9.5 8.4 11.2 7.4.9-.5 1.9-2.1 1.9-4.7",key:"rqjl8i"}],["path",{d:"M9.1 16.5c.3-1.1 1.4-1.7 2.4-1.4",key:"1mr6wy"}]]);const Te=N("link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);const Le=N("map-pin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);const Pe=N("stamp",[["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-6 0c0 2 1 2 1 3.5V13",key:"i9gjdv"}],["path",{d:"M20 15.5a2.5 2.5 0 0 0-2.5-2.5h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1z",key:"1vzg3v"}],["path",{d:"M5 22h14",key:"ehvnwv"}]]),Qe={class:"page-container"},je={class:"main-layout"},Ge={class:"content-panel"},Ie={class:"header-content"},De={class:"subtitle"},Fe={key:0},He={key:0,class:"topics-grid-container"},Ee=["onClick"],Re={class:"card-top"},Ue={key:0,class:"check-icon"},Oe={class:"card-footer"},Ze={key:1,class:"history-section mt-12"},Je={class:"section-title"},Ye=["onClick"],Ke={class:"history-card-header"},We={class:"history-card-body"},Xe={class:"question-count"},es={key:0,class:"pagination-wrapper mt-6"},ss={key:2,class:"question-container"},ts={class:"progress-bar-wrapper"},ls={class:"question-inner"},as={class:"meta-info"},os={class:"topic-badge"},ns={class:"counter"},is={class:"question-text"},cs={class:"options-list"},rs=["onClick"],ds={class:"option-index"},us={class:"option-content"},vs={key:0,class:"explanation-content"},ps={class:"exp-icon"},fs={class:"exp-text"},ms={class:"exp-action-footer"},_s={key:3,class:"result-container"},gs={class:"result-icon-wrapper"},hs={class:"stat-box"},ys={class:"stat-value correct-rate"},ks={class:"stat-box"},bs={class:"stat-value"},ws={class:"dim"},Cs={class:"sidebar-panel"},Ms={class:"widget-header"},zs={class:"icon-wrap purple"},xs={class:"stats-body"},qs={class:"progress-section"},Vs={class:"config-group"},As={class:"mode-list"},Ns=["onClick"],Ss={key:0,class:"radio-dot"},Bs={class:"config-group"},$s={class:"diff-tabs"},Ts=["onClick"],Ls={class:"sidebar-title-row"},Ps={class:"task-info"},Qs={class:"info-box"},js={class:"val"},Gs={class:"question-nav"},Is={class:"nav-grid"},Ds=["onClick"],Fs={__name:"GrammarView",setup(Hs){const b=_e(),S=[{id:1,title:"时态语态",desc:"现在时、过去时、被动语态等",count:42,icon:xe,color:"#f472b6",bg:"rgba(244, 114, 182, 0.1)"},{id:2,title:"从句结构",desc:"定语从句、状语从句、名词性从句",count:36,icon:Te,color:"#818cf8",bg:"rgba(129, 140, 248, 0.1)"},{id:3,title:"介词用法",desc:"时间、地点、方位介词",count:32,icon:Le,color:"#34d399",bg:"rgba(52, 211, 153, 0.1)"},{id:4,title:"冠词用法",desc:"定冠词、不定冠词、零冠词",count:24,icon:qe,color:"#a78bfa",bg:"rgba(167, 139, 250, 0.1)"},{id:5,title:"情态动词",desc:"can, must, should 等用法",count:28,icon:$e,color:"#60a5fa",bg:"rgba(96, 165, 250, 0.1)"},{id:6,title:"条件句",desc:"真实条件句、虚拟条件句",count:30,icon:Pe,color:"#fb923c",bg:"rgba(251, 146, 60, 0.1)"},{id:7,title:"倒装句",desc:"完全倒装、部分倒装",count:18,icon:ee,color:"#22d3ee",bg:"rgba(34, 211, 238, 0.1)"},{id:8,title:"非谓语",desc:"不定式、动名词、分词",count:45,icon:Y,color:"#facc15",bg:"rgba(250, 204, 21, 0.1)"}],se=[{id:"quick",title:"快速练习",desc:"10道题快速测试",icon:Y,color:"#f97316"},{id:"comprehensive",title:"综合练习",desc:"20道题全面检测",icon:W,color:"#22c55e"},{id:"exam",title:"考试模拟",desc:"限时模拟考试",icon:Me,color:"#ef4444"}],te=[{id:"easy",title:"基础",desc:"适合初学者",stars:1,color:"#4ade80"},{id:"medium",title:"中级",desc:"有一定挑战",stars:2,color:"#facc15"},{id:"hard",title:"高级",desc:"挑战高难度",stars:3,color:"#f87171"}],z=f(S[0].id),G=f("comprehensive"),I=f("medium"),h=f(!1),D=f(!1),v=f(!1),d=f(0),_=f([]),B=f(0),y=f(!1),g=f([]),$=f([]),F=f(1),x=f(6),le=q(()=>h.value&&!v.value),U=l=>{if(le.value)return l.preventDefault(),l.returnValue="练习正在进行中，确定要离开吗？你的答题进度将会丢失。",l.returnValue};ge(()=>{window.addEventListener("beforeunload",U),oe()}),he(()=>{window.removeEventListener("beforeunload",U)});const ae=q(()=>{const l=(F.value-1)*x.value,s=l+x.value;return $.value.slice(l,s)}),oe=async()=>{try{const l=await J.getGrammarHistory();l.code===200&&($.value=l.data||[])}catch(l){console.error("Failed to fetch grammar history",l)}},ne=l=>{if(g.value=l.questions||[],g.value.length===0){b.warning("此练习没有题目");return}h.value=!0,v.value=!1,d.value=0,_.value=new Array(g.value.length).fill(null).map(()=>({selected:null,correct:null})),B.value=0,y.value=!1,b.success(`已加载: ${l.topic}`)},H=q({get:()=>_.value[d.value]?.selected??null,set:l=>{v.value||(_.value[d.value]?_.value[d.value].selected=l:_.value[d.value]={selected:l,correct:null})}});q(()=>_.value[d.value]?.selected!==void 0&&_.value[d.value]?.selected!==null);const k=q(()=>g.value.length),T=q(()=>g.value[d.value]||{}),ie=l=>z.value=l,ce=l=>G.value=l,re=l=>I.value=l,de=async()=>{D.value=!0;try{const l=S.find(r=>r.id===z.value)?.title,s=await J.generateGrammar({topic:l,difficulty:I.value});s.code===200&&s.data?(g.value=s.data.questions||[],g.value.length===0&&(b.warning("未生成题目，使用模拟数据"),g.value=[{id:1,text:"By the time he arrives, we ______ having dinner.",options:["will finish","will have finished","are finishing","have finished"],correct:1,explanation:"'By the time' 引导的时间状语从句通常与将来完成时连用，表示在将来某时之前已经完成的动作。"}]),h.value=!0,v.value=!1,d.value=0,_.value=new Array(g.value.length).fill(null).map(()=>({selected:null,correct:null})),B.value=0,y.value=!1,b.success("练习生成成功")):b.error("生成失败")}catch(l){console.error(l),b.error("网络请求失败")}finally{D.value=!1}},ue=l=>{v.value||(H.value=l)},O=l=>{l>=0&&l<k.value&&(d.value=l)},Z=async()=>{if(v.value)return;const l=_.value.filter(r=>r.selected===null).length;l>0&&b.warning(`还有 ${l} 道题未完成，请确认后提交`);let s=0;for(let r=0;r<g.value.length;r++){const t=g.value[r],p=_.value[r],L=p.selected===t.correct;p.correct=L,L&&s++;try{await ze.createRecord({contentId:t.id||r,contentType:"grammar",isCorrect:L?1:0,answer:String(p.selected),correctAnswer:String(t.correct),masteryLevel:L?3:1,originalContent:JSON.stringify(t)})}catch(fe){console.error("Failed to save record",fe)}}B.value=s,v.value=!0,y.value=!0,b.success("批改完成，分数："+Math.round(s/k.value*100)+"%")},ve=()=>{d.value<k.value-1?d.value++:v.value?y.value=!0:Z()},pe=()=>{h.value=!1,v.value=!1,y.value=!1,g.value=[]};return(l,s)=>{const r=ye("n-icon");return i(),u("div",Qe,[e("div",je,[e("div",Ge,[o(a(M),{class:"header-card",bordered:!1},{default:n(()=>[e("div",Ie,[e("div",null,[e("h1",null,c(h.value?y.value?"练习报告":"语法特训中":"语法专项特训"),1),e("p",De,c(h.value?"保持专注，攻克难点":"系统化梳理语法脉络"),1)]),h.value&&!y.value?(i(),u("div",Fe,[o(a(C),{secondary:"",onClick:s[0]||(s[0]=t=>h.value=!1)},{icon:n(()=>[o(r,{component:a(Ve)},null,8,["component"])]),default:n(()=>[s[5]||(s[5]=m(" 退出练习 ",-1))]),_:1})])):w("",!0)])]),_:1}),h.value?w("",!0):(i(),u("div",He,[o(a(R),{"x-gap":"20","y-gap":"20",cols:"1 800:2 1200:3",responsive:"screen"},{default:n(()=>[(i(),u(V,null,A(S,t=>o(a(j),{key:t.id},{default:n(()=>[e("div",{class:P(["topic-card",{active:z.value===t.id}]),onClick:p=>ie(t.id)},[e("div",Re,[e("div",{class:"icon-box",style:K({backgroundColor:t.bg,color:t.color})},[o(r,{component:t.icon,size:"24"},null,8,["component"])],4),z.value===t.id?(i(),u("div",Ue,[o(r,{component:a(Ae),color:"#ec4899"},null,8,["component"])])):w("",!0)]),e("h3",null,c(t.title),1),e("p",null,c(t.desc),1),e("div",Oe,[o(a(E),{size:"small",round:"",bordered:!1,type:"default"},{default:n(()=>[m(c(t.count)+" Questions ",1)]),_:2},1024)])],10,Ee)]),_:2},1024)),64))]),_:1})])),$.value.length>0?(i(),u("div",Ze,[e("div",Je,[o(r,{component:a(Ne)},null,8,["component"]),s[6]||(s[6]=m(" 最近生成练习 ",-1))]),o(a(R),{"x-gap":"20","y-gap":"20",cols:"1 600:2 1200:3"},{default:n(()=>[(i(!0),u(V,null,A(ae.value,t=>(i(),Q(a(j),{key:t.id},{default:n(()=>[e("div",{class:"history-card",onClick:p=>ne(t)},[e("div",Ke,[o(a(E),{size:"small",type:"warning",bordered:!1},{default:n(()=>[m(c(t.topic||"Grammar"),1)]),_:2},1024),o(a(E),{size:"tiny",bordered:!1},{default:n(()=>[m(c(t.difficulty||"medium"),1)]),_:2},1024)]),e("div",We,[e("span",Xe,c(t.questions?.length||0)+" 题",1)])],8,Ye)]),_:2},1024))),128))]),_:1}),$.value.length>x.value?(i(),u("div",es,[o(a(ke),{page:F.value,"onUpdate:page":s[1]||(s[1]=t=>F.value=t),"page-count":Math.ceil($.value.length/x.value),"page-size":x.value,"show-size-picker":"","page-sizes":[6,12,18],"onUpdate:pageSize":s[2]||(s[2]=t=>x.value=t)},null,8,["page","page-count","page-size"])])):w("",!0)])):y.value?(i(),u("div",_s,[o(a(M),{class:"result-card",bordered:!1},{default:n(()=>[e("div",gs,[o(r,{component:a(be),size:"100",color:"#eab308"},null,8,["component"])]),s[13]||(s[13]=e("h2",{class:"result-title"},"练习完成!",-1)),s[14]||(s[14]=e("p",{class:"result-subtitle"},"语法掌握度稳步提升中",-1)),o(a(R),{"x-gap":"24",cols:"2",class:"stats-grid"},{default:n(()=>[o(a(j),null,{default:n(()=>[e("div",hs,[e("div",ys,c(Math.round(B.value/k.value*100))+"%",1),s[9]||(s[9]=e("div",{class:"stat-label"},"正确率",-1))])]),_:1}),o(a(j),null,{default:n(()=>[e("div",ks,[e("div",bs,[m(c(B.value)+" ",1),e("span",ws,"/"+c(k.value),1)]),s[10]||(s[10]=e("div",{class:"stat-label"},"得分",-1))])]),_:1})]),_:1}),o(a(X),{justify:"center",size:"large"},{default:n(()=>[o(a(C),{size:"large",onClick:pe},{icon:n(()=>[o(r,{component:a(ee)},null,8,["component"])]),default:n(()=>[s[11]||(s[11]=m(" 返回首页 ",-1))]),_:1}),o(a(C),{type:"primary",color:"#db2777",size:"large",onClick:s[4]||(s[4]=t=>y.value=!1)},{default:n(()=>[...s[12]||(s[12]=[m(" 回顾详细解析 ",-1)])]),_:1})]),_:1})]),_:1})])):(i(),u("div",ss,[o(a(M),{class:"question-box",bordered:!1,size:"huge"},{default:n(()=>[e("div",ts,[e("div",{class:"progress-fill",style:K({width:(d.value+1)/k.value*100+"%"})},null,4)]),e("div",ls,[e("div",as,[e("span",os,c(S.find(t=>t.id===z.value)?.title),1),e("span",ns,"Question "+c(d.value+1)+" of "+c(k.value),1)]),e("h2",is,c(T.value.text),1),e("div",cs,[(i(!0),u(V,null,A(T.value.options,(t,p)=>(i(),u("div",{key:p,class:P(["option-item",{correct:v.value&&p===T.value.correct,wrong:v.value&&H.value===p&&p!==T.value.correct,disabled:v.value,selected:H.value===p}]),onClick:L=>ue(p)},[e("div",ds,c(["A","B","C","D"][p]),1),e("span",us,c(t),1)],10,rs))),128))])])]),_:1}),o(a(M),{class:"explanation-card",bordered:!1,size:"large"},{default:n(()=>[v.value?(i(),u("div",vs,[e("div",ps,[o(r,{component:a(W)},null,8,["component"])]),e("div",fs,[s[7]||(s[7]=e("h4",null,"语法解析",-1)),e("p",null,c(T.value.explanation),1)])])):w("",!0),e("div",ms,[o(a(X),{justify:"end"},{default:n(()=>[d.value>0?(i(),Q(a(C),{key:0,secondary:"",onClick:s[3]||(s[3]=t=>O(d.value-1))},{default:n(()=>[...s[8]||(s[8]=[m("上一题",-1)])]),_:1})):w("",!0),o(a(C),{type:"primary",color:"#db2777",size:"large",onClick:ve},{default:n(()=>[m(c(d.value===k.value-1?v.value?"查看结果":"检查并提交":"下一题"),1)]),_:1})]),_:1})])]),_:1})]))]),e("div",Cs,[o(a(M),{class:"sidebar-card user-stats",bordered:!1,size:"small"},{default:n(()=>[e("div",Ms,[e("div",zs,[o(r,{component:a(Se)},null,8,["component"])]),s[15]||(s[15]=e("div",null,[e("h3",null,"学习状态"),e("p",null,"今日已练习 15 分钟")],-1))]),e("div",xs,[e("div",qs,[s[16]||(s[16]=e("div",{class:"labels"},[e("span",null,"语法掌握度"),e("span",null,"Level 3")],-1)),o(a(we),{type:"line",percentage:65,height:6,color:"#d946ef","rail-color":"rgba(255,255,255,0.1)","show-indicator":!1})]),s[17]||(s[17]=e("div",{class:"mini-stats"},[e("div",{class:"mini-stat"},[e("div",{class:"num"},"128"),e("div",{class:"lbl"},"累计答题")]),e("div",{class:"mini-stat"},[e("div",{class:"num success"},"92%"),e("div",{class:"lbl"},"平均正确率")])],-1))])]),_:1}),h.value?(i(),Q(a(M),{key:1,class:"sidebar-card current-task",bordered:!1,size:"small"},{default:n(()=>[e("div",Ls,[e("h3",null,[o(r,{component:a(Be),class:"title-icon"},null,8,["component"]),s[22]||(s[22]=m(" 当前任务 ",-1))]),!v.value&&!y.value?(i(),Q(a(C),{key:0,size:"tiny",type:"primary",color:"#db2777",onClick:Z},{default:n(()=>[...s[23]||(s[23]=[m(" 提交批改 ",-1)])]),_:1})):w("",!0)]),e("div",Ps,[e("div",Qs,[s[24]||(s[24]=e("span",{class:"lbl"},"正在攻克知识点",-1)),e("span",js,c(S.find(t=>t.id===z.value)?.title),1)]),e("div",Gs,[s[25]||(s[25]=e("span",{class:"lbl"},"本组题目",-1)),e("div",Is,[(i(!0),u(V,null,A(k.value,t=>(i(),u("div",{key:t,class:P(["nav-item",{active:t-1===d.value,answered:_.value[t-1]?.selected!==null,"is-correct":v.value&&_.value[t-1]?.correct===!0,"is-wrong":v.value&&_.value[t-1]?.correct===!1}]),onClick:p=>O(t-1)},c(t),11,Ds))),128))])])])]),_:1})):(i(),Q(a(M),{key:0,class:"sidebar-card config-panel",bordered:!1,size:"small"},{default:n(()=>[e("h3",null,[o(r,{component:a(Ce),class:"title-icon"},null,8,["component"]),s[18]||(s[18]=m(" 练习配置 ",-1))]),e("div",Vs,[s[19]||(s[19]=e("label",null,"模式选择",-1)),e("div",As,[(i(),u(V,null,A(se,t=>e("div",{key:t.id,class:P(["mode-item",{active:G.value===t.id}]),onClick:p=>ce(t.id)},[o(r,{component:t.icon,color:t.color},null,8,["component","color"]),e("span",null,c(t.title),1),G.value===t.id?(i(),u("div",Ss)):w("",!0)],10,Ns)),64))])]),e("div",Bs,[s[20]||(s[20]=e("label",null,"难度设定",-1)),e("div",$s,[(i(),u(V,null,A(te,t=>e("div",{key:t.id,class:P(["diff-tab",{active:I.value===t.id}]),onClick:p=>re(t.id)},c(t.title),11,Ts)),64))])]),o(a(C),{block:"",type:"primary",color:"#db2777",size:"large",class:"start-btn",loading:D.value,onClick:de},{default:n(()=>[...s[21]||(s[21]=[m(" 开始练习 ",-1)])]),_:1},8,["loading"])]),_:1}))])])])}}},Ws=me(Fs,[["__scopeId","data-v-cea7e899"]]);export{Ws as default};
