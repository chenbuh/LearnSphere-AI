import{a as O}from"./ai-sA4E8Qum.js";import{_ as re,l as ue}from"./index-CZUTEx94.js";import{u as de}from"./useTypewriter-DACS7wx8.js";import{b as ve,T as pe,a5 as _e,j as ge,a6 as ye,a7 as fe,q as me,a8 as he,a9 as be,aa as ke,B as we,W as Ce,t as ze,a0 as Ne,$ as qe,p as xe,i as Te,m as Be,w as Ae}from"./lucide-DtS2HtB5.js";import{a6 as $e,r as f,j as U,w as Le,S as Se,aO as Pe,l as Re,I as d,z as c,a1 as w,F as e,s as a,q as l,u as o,_ as D,U as P,H as v,J as m,a2 as h,a3 as z,X as u,Y as R,K as k,$ as N,p as b,ad as F,au as Ie,ae as Ve,aA as He,V as Ue,an as De,ao as Fe,aB as Me}from"./naive-ui-CN0IOFzZ.js";import"./echarts-5QPu3XI4.js";const je={class:"page-container"},Ee={key:0,class:"page-header"},Qe={key:1,class:"setup-container"},Oe={class:"setting-section"},Ge={class:"grid-options source-grid"},Je=["onClick"],We={class:"option-icon"},Xe={class:"option-label"},Ke={class:"setting-section"},Ye={class:"grid-options category-grid"},Ze=["onClick"],es={class:"icon-wrapper"},ss={class:"info"},ts={class:"option-label"},os={class:"option-desc"},as={class:"side-settings"},ls={class:"setting-section"},ns={class:"pill-options"},is=["onClick"],cs={class:"setting-section"},rs={class:"pill-options"},us=["onClick"],ds={key:0,class:"history-section"},vs={class:"section-title"},ps={class:"history-title"},_s={class:"history-footer"},gs={class:"word-count"},ys={key:0,class:"pagination-wrapper mt-6"},fs={key:0,class:"reading-container"},ms={class:"back-button-container mb-6"},hs={class:"reading-layout-container"},bs={class:"sidebar"},ks={class:"sticky-nav"},ws={class:"question-grid"},Cs={class:"progress-card p-4 bg-gray-800/50 rounded-xl border border-white/5"},zs={class:"text-xs text-gray-400 mb-2 flex justify-between"},Ns={class:"main-content-area"},qs={class:"article-header"},xs={class:"meta"},Ts={key:0,class:"typing-cursor"},Bs={class:"question-content"},As={class:"q-text"},$s={class:"q-num"},Ls={class:"options-container"},Ss=["onClick"],Ps={class:"option-index"},Rs={class:"option-text"},Is={class:"actions-footer"},Vs={key:3,class:"result-container"},Hs={key:4,class:"review-container"},Us={class:"back-button-container"},Ds={class:"article-preview mb-6"},Fs={class:"text-white mb-2"},Ms={class:"preview-text p-4 bg-black/20 rounded-lg"},js={class:"mb-2 text-white"},Es={class:"review-detail"},Qs={class:"your-answer mb-1"},Os={class:"correct-answer mb-2"},Gs={class:"success-text"},Js={class:"explanation p-3 bg-zinc-800/50 rounded text-zinc-300"},Ws={__name:"ReadingView",setup(Xs){const T=$e(),{displayedText:G,isTyping:I,startTyping:M,setImmediate:J}=de("",15),g=f("setup"),V=f(!1),p=f(0),y=f({}),B=f(0),i=f(null),q=f([]),A=f(1),$=f(6),L=f(0),C=f({source:"economist",category:"tech",difficulty:"medium",length:"medium"}),W=[{label:"ç»æµå­¦äºº",value:"economist",icon:"ğŸ“ˆ"},{label:"çº½çº¦æ—¶æŠ¥",value:"nyt",icon:"ğŸ“°"},{label:"ç§‘å­¦ç¾å›½äºº",value:"scientific",icon:"ğŸ§¬"},{label:"å›½å®¶åœ°ç†",value:"natgeo",icon:"ğŸŒ"},{label:"ç»å…¸åè‘—",value:"classic",icon:"ğŸ“š"},{label:"ç°ä»£å°è¯´",value:"fiction",icon:"ğŸ–Šï¸"}],X=[{label:"ç§‘æŠ€å‰æ²¿",value:"tech",icon:_e,desc:"AI, Space, Bio"},{label:"å•†ä¸šè´¢ç»",value:"business",icon:ge,desc:"Market, Economy"},{label:"äººæ–‡å†å²",value:"culture",icon:ye,desc:"History, Art"},{label:"è‡ªç„¶ç¯å¢ƒ",value:"environment",icon:fe,desc:"Nature, Climate"},{label:"ç¤¾ä¼šç”Ÿæ´»",value:"society",icon:me,desc:"Culture, People"},{label:"è‰ºæœ¯æ–‡å­¦",value:"arts",icon:he,desc:"Design, Literature"},{label:"å¥åº·åŒ»ç–—",value:"health",icon:be,desc:"Medicine, Wellness"},{label:"åŸºç¡€ç§‘å­¦",value:"science",icon:ke,desc:"Physics, Chem"}],K=[{label:"å…¥é—¨",value:"easy"},{label:"è¿›é˜¶",value:"medium"},{label:"ç²¾é€š",value:"hard"}],Y=[{label:"çŸ­ç¯‡",value:"short"},{label:"ä¸­ç¯‡",value:"medium"},{label:"é•¿ç¯‡",value:"long"}],Z=U(()=>g.value==="reading"&&Object.keys(y.value).length>0),j=r=>{if(Z.value)return r.preventDefault(),r.returnValue="é˜…è¯»ç»ƒä¹ æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿä½ çš„ç­”é¢˜è¿›åº¦å°†ä¼šä¸¢å¤±ã€‚",r.returnValue},S=(r,t)=>{C.value[r]=t},ee=U(()=>q.value);Le([A,$],()=>{H()}),Se(()=>{H(),window.addEventListener("beforeunload",j)}),Pe(()=>{window.removeEventListener("beforeunload",j)});const H=async()=>{try{const r=await O.getReadingHistory(A.value,$.value);r.code===200&&(r.data.records?(q.value=r.data.records,L.value=r.data.total):(q.value=r.data||[],L.value=q.value.length))}catch(r){console.error("Failed to fetch history",r)}},se=r=>{i.value=r,y.value={},p.value=0,B.value=0,g.value="reading",M(r.content)},te=async()=>{V.value=!0;try{const r=await O.generateReading(C.value);r.code===200&&r.data?(i.value=r.data,(!i.value.questions||i.value.questions.length===0)&&T.warning("æœªç”Ÿæˆé¢˜ç›®ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®"),!i.value.content&&i.value.passage&&(i.value.content=i.value.passage),p.value=0,y.value={},g.value="reading",M(i.value.content),T.success("é˜…è¯»ææ–™ç”ŸæˆæˆåŠŸ"),H()):T.error("ç”Ÿæˆå¤±è´¥")}catch(r){console.error(r),T.error("ç½‘ç»œè¯·æ±‚å¤±è´¥")}finally{V.value=!1}},oe=r=>{y.value[p.value]=r},ae=()=>{p.value<i.value.questions.length-1&&p.value++},le=()=>{p.value>0&&p.value--},ne=async()=>{let r=0;const t=i.value.questions;for(let _=0;_<t.length;_++){const s=t[_],n=y.value[_],x=n===s.correct;x&&r++;try{await ue.createRecord({contentId:i.value.id||_,contentType:"reading",isCorrect:x?1:0,answer:n!==void 0?String(n):"-1",correctAnswer:String(s.correct),masteryLevel:x?3:1,originalContent:JSON.stringify({title:i.value.title,content:i.value.content,question:s})})}catch(ce){console.error("Failed to save record",ce)}}B.value=Math.round(r/t.length*100),g.value="result"},E=()=>{g.value="setup",y.value={},p.value=0,B.value=0,i.value=null},Q=U(()=>!i.value||i.value.questions.length===0?0:(p.value+1)/i.value.questions.length*100),ie=()=>{I.value&&i.value&&J(i.value.content)};return(r,t)=>{const _=Re("n-icon");return c(),d("div",je,[g.value==="setup"?(c(),d("div",Ee,[...t[5]||(t[5]=[e("h1",null,"é˜…è¯»ç†è§£è®­ç»ƒ",-1),e("p",null,"ç²¾é€‰å…¨çƒå¤–åˆŠä¸ç»å…¸åè‘—ï¼Œæ·±åº¦æå‡é˜…è¯»ç†è§£èƒ½åŠ›",-1)])])):w("",!0),g.value==="setup"?(c(),d("div",Qe,[a(o(N),{class:"setup-card",bordered:!1,size:"huge"},{default:l(()=>[a(o(D),{"x-gap":"40","y-gap":"40",cols:"1 800:3",responsive:"screen"},{default:l(()=>[a(o(P),{span:"2"},{default:l(()=>[e("div",Oe,[e("h3",null,[a(_,{component:o(ve),color:"#6366f1"},null,8,["component"]),t[6]||(t[6]=v(" é˜…è¯»æ¥æº",-1))]),e("div",Ge,[(c(),d(m,null,h(W,s=>e("div",{key:s.value,class:z(["option-card",{active:C.value.source===s.value}]),onClick:n=>S("source",s.value)},[e("span",We,u(s.icon),1),e("span",Xe,u(s.label),1)],10,Je)),64))])]),e("div",Ke,[e("h3",null,[a(_,{component:o(pe),color:"#a855f7"},null,8,["component"]),t[7]||(t[7]=v(" æ–‡ç« é¢˜æ",-1))]),e("div",Ye,[(c(),d(m,null,h(X,s=>e("div",{key:s.value,class:z(["option-card category-card",{active:C.value.category===s.value}]),onClick:n=>S("category",s.value)},[e("div",es,[a(_,{component:s.icon},null,8,["component"])]),e("div",ss,[e("div",ts,u(s.label),1),e("div",os,u(s.desc),1)])],10,Ze)),64))])])]),_:1}),a(o(P),null,{default:l(()=>[e("div",as,[e("div",ls,[e("h3",null,[a(_,{component:o(we),color:"#eab308"},null,8,["component"]),t[8]||(t[8]=v(" éš¾åº¦ç­‰çº§",-1))]),e("div",ns,[(c(),d(m,null,h(K,s=>e("div",{key:s.value,class:z(["pill-option",{active:C.value.difficulty===s.value}]),onClick:n=>S("difficulty",s.value)},u(s.label),11,is)),64))])]),e("div",cs,[e("h3",null,[a(_,{component:o(Ce),color:"#10b981"},null,8,["component"]),t[9]||(t[9]=v(" æ–‡ç« ç¯‡å¹…",-1))]),e("div",rs,[(c(),d(m,null,h(Y,s=>e("div",{key:s.value,class:z(["pill-option",{active:C.value.length===s.value}]),onClick:n=>S("length",s.value)},u(s.label),11,us)),64))])]),a(o(R)),a(o(k),{type:"primary",size:"large",block:"",round:"",class:"start-btn",loading:V.value,onClick:te},{icon:l(()=>[a(_,{component:o(ze)},null,8,["component"])]),default:l(()=>[t[10]||(t[10]=v(" ç”Ÿæˆé˜…è¯»ä»»åŠ¡ ",-1))]),_:1},8,["loading"])])]),_:1})]),_:1})]),_:1}),q.value.length>0?(c(),d("div",ds,[e("div",vs,[a(_,{component:o(Ne)},null,8,["component"]),t[11]||(t[11]=v(" æœ€è¿‘ç”Ÿæˆ ",-1))]),a(o(D),{"x-gap":"16","y-gap":"16",cols:"1 600:2 900:3"},{default:l(()=>[(c(!0),d(m,null,h(ee.value,s=>(c(),b(o(P),{key:s.id},{default:l(()=>[a(o(N),{class:"history-card",hoverable:"",onClick:n=>se(s)},{header:l(()=>[a(o(F),{size:"small",bordered:!1,type:"success",class:"mb-1"},{default:l(()=>[v(u(s.source),1)]),_:2},1024),e("div",ps,u(s.title),1)]),footer:l(()=>[e("div",_s,[a(o(F),{size:"tiny",bordered:!1},{default:l(()=>[v(u(s.difficulty),1)]),_:2},1024),e("span",gs,u(s.questions?.length||0)+" é¢˜",1)])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1}),L.value>0?(c(),d("div",ys,[a(o(Ie),{page:A.value,"onUpdate:page":t[0]||(t[0]=s=>A.value=s),"item-count":L.value,"page-size":$.value,"show-size-picker":"","page-sizes":[6,12,18],"onUpdate:pageSize":t[1]||(t[1]=s=>$.value=s)},null,8,["page","item-count","page-size"])])):w("",!0)])):w("",!0)])):g.value==="reading"?(c(),d(m,{key:2},[i.value?(c(),d("div",fs,[e("div",ms,[a(o(k),{secondary:"",onClick:E},{icon:l(()=>[a(_,{component:o(qe)},null,8,["component"])]),default:l(()=>[t[12]||(t[12]=v(" è¿”å›è®¾ç½® ",-1))]),_:1})]),e("div",hs,[e("div",bs,[e("div",ks,[a(o(N),{class:"nav-card mb-4",bordered:!1,title:"é¢˜ç›®å¯¼èˆª",size:"small"},{default:l(()=>[e("div",ws,[(c(!0),d(m,null,h(i.value.questions,(s,n)=>(c(),b(o(k),{key:n,circle:"",class:z(["nav-btn",{current:p.value===n,answered:y.value[n]!=null&&p.value!==n}]),type:p.value===n?"primary":y.value[n]!=null?"success":"default",secondary:p.value!==n,onClick:x=>p.value=n},{default:l(()=>[v(u(n+1),1)]),_:2},1032,["class","type","secondary","onClick"]))),128))])]),_:1}),e("div",Cs,[e("div",zs,[t[13]||(t[13]=e("span",null,"å®Œæˆè¿›åº¦",-1)),e("span",null,u(Math.round(Q.value))+"%",1)]),a(o(Ve),{type:"line",percentage:Q.value,"show-indicator":!1,color:"#10b981","rail-color":"#3f3f46",height:6},null,8,["percentage"])])])]),e("div",Ns,[a(o(N),{class:"question-card",bordered:!1,size:"large"},{default:l(()=>[e("div",qs,[a(o(F),{type:"success",size:"small"},{default:l(()=>[v(u(C.value.category.toUpperCase()),1)]),_:1}),e("h2",null,u(i.value.title),1),e("p",xs,[e("span",null,u(i.value.source),1),t[14]||(t[14]=e("span",{class:"separator"},"â€¢",-1)),e("span",null,[a(_,{component:o(xe),size:"14"},null,8,["component"]),v(" "+u(i.value.word_count||600)+" è¯",1)])])]),a(o(R)),e("div",{class:"article-content",onClick:t[2]||(t[2]=s=>o(I)?ie():null)},[(c(!0),d(m,null,h(o(G).split(`
`),(s,n)=>(c(),d("p",{key:n},u(s),1))),128)),o(I)?(c(),d("div",Ts)):w("",!0)]),a(o(R)),e("div",Bs,[e("h3",As,[e("span",$s,"Q"+u(p.value+1),1),v(" "+u(i.value.questions[p.value].text),1)]),e("div",Ls,[a(o(D),{"x-gap":"20","y-gap":"20",cols:"1"},{default:l(()=>[(c(!0),d(m,null,h(i.value.questions[p.value].options,(s,n)=>(c(),b(o(P),{key:n},{default:l(()=>[e("div",{class:z(["answer-option",{selected:y.value[p.value]===n}]),onClick:x=>oe(n)},[e("span",Ps,u(["A","B","C","D"][n]),1),e("span",Rs,u(s),1)],10,Ss)]),_:2},1024))),128))]),_:1})])]),e("div",Is,[p.value>0?(c(),b(o(k),{key:0,secondary:"",onClick:le,class:"mr-4"},{default:l(()=>[...t[15]||(t[15]=[v("ä¸Šä¸€é¢˜",-1)])]),_:1})):w("",!0),p.value<i.value.questions.length-1?(c(),b(o(k),{key:1,type:"primary",onClick:ae},{default:l(()=>[...t[16]||(t[16]=[v("ä¸‹ä¸€é¢˜",-1)])]),_:1})):(c(),b(o(k),{key:2,type:"success",onClick:ne},{default:l(()=>[...t[17]||(t[17]=[v("æäº¤ç­”æ¡ˆ",-1)])]),_:1}))])]),_:1})])])])):w("",!0)],64)):g.value==="result"?(c(),d("div",Vs,[a(o(N),{class:"score-card",bordered:!1},{default:l(()=>[a(o(He),{status:"success",title:"é˜…è¯»å®Œæˆ",description:"ä½ çš„ç†è§£æ­£ç¡®ç‡ï¼š"+B.value+"%"},{icon:l(()=>[a(_,{component:o(Te),size:"80",color:"#eab308"},null,8,["component"])]),footer:l(()=>[a(o(Ue),{justify:"center"},{default:l(()=>[a(o(k),{onClick:E},{default:l(()=>[...t[18]||(t[18]=[v("é˜…è¯»ä¸‹ä¸€ç¯‡",-1)])]),_:1}),a(o(k),{type:"primary",onClick:t[3]||(t[3]=s=>g.value="review")},{default:l(()=>[...t[19]||(t[19]=[v("æŸ¥çœ‹åŸæ–‡è§£æ",-1)])]),_:1})]),_:1})]),_:1},8,["description"])]),_:1})])):g.value==="review"?(c(),d("div",Hs,[e("div",Us,[a(o(k),{secondary:"",onClick:t[4]||(t[4]=s=>g.value="result")},{icon:l(()=>[a(_,{component:r.ArrowLeft},null,8,["component"])]),default:l(()=>[t[20]||(t[20]=v(" è¿”å›æŠ¥å‘Š ",-1))]),_:1})]),i.value?(c(),b(o(N),{key:0,class:"review-card",title:"è¯¦ç»†è§£æ",bordered:!1},{default:l(()=>[e("div",Ds,[e("h3",Fs,u(i.value.title),1),e("div",Ms,[(c(!0),d(m,null,h(i.value.content.split(`
`),(s,n)=>(c(),d("p",{key:n,class:"mb-2 text-zinc-400"},u(s),1))),128))])]),a(o(R)),a(o(De),null,{default:l(()=>[(c(!0),d(m,null,h(i.value.questions,(s,n)=>(c(),b(o(Fe),{key:n},{default:l(()=>[a(o(Me),{title:"Q"+(n+1)},{description:l(()=>[e("p",js,u(s.text),1)]),default:l(()=>[e("div",Es,[e("div",Qs,[t[21]||(t[21]=v(" ä½ çš„é€‰æ‹©: ",-1)),e("span",{class:z(y.value[n]===s.correct?"success-text":"error-text")},u(s.options[y.value[n]]||"æœªä½œç­”"),3),y.value[n]===s.correct?(c(),b(_,{key:0,component:o(Be),color:"#10b981"},null,8,["component"])):(c(),b(_,{key:1,component:o(Ae),color:"#ef4444"},null,8,["component"]))]),e("div",Os,[t[22]||(t[22]=v("æ­£ç¡®ç­”æ¡ˆ: ",-1)),e("span",Gs,u(s.options[s.correct]),1)]),e("div",Js,[t[23]||(t[23]=e("strong",null,"è§£æï¼š",-1)),v(" "+u(s.explanation||"æš‚æ— è¯¦ç»†è§£æã€‚"),1)])])]),_:2},1032,["title"])]),_:2},1024))),128))]),_:1})]),_:1})):w("",!0)])):w("",!0)])}}},ot=re(Ws,[["__scopeId","data-v-12a2e460"]]);export{ot as default};
