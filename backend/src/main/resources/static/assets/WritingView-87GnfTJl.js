import{a as W}from"./ai-sA4E8Qum.js";import{_ as ne,l as ie}from"./index-CZUTEx94.js";import{u as re}from"./useTypewriter-DACS7wx8.js";import{G as ce,ab as ue,ac as de,T as pe,c as ve,p as me,t as ge,a0 as fe,$ as ye,i as _e,ad as he,b as be,m as ke}from"./lucide-DtS2HtB5.js";import{a6 as we,r as p,w as q,j as U,S as Te,aO as Ce,ag as xe,l as Le,I as c,z as i,a1 as k,F as t,s as l,q as n,u as s,_ as j,U as A,H as u,J as w,a2 as T,a3 as E,X as r,Y as ze,K as C,$ as z,p as I,ad as F,au as Ie,ab as Ne,aA as Se,V as Pe,an as $e,ao as Be,aB as Ue}from"./naive-ui-CN0IOFzZ.js";import"./echarts-5QPu3XI4.js";const Ve={class:"page-container"},We={key:0,class:"page-header"},Ae={key:1,class:"setup-container"},Ee={class:"setting-section"},Fe={class:"grid-options exam-grid"},He=["onClick"],Me={class:"option-icon"},De={class:"option-label"},Re={class:"setting-section"},Ge={class:"grid-options mode-grid"},Oe=["onClick"],qe={class:"icon-wrapper"},je={class:"info"},Je={class:"option-label"},Ke={class:"option-desc"},Xe={class:"side-settings"},Ye={class:"setting-section"},Qe={class:"pill-options"},Ze=["onClick"],et={key:0,class:"history-section mt-12"},tt={class:"section-title"},st=["onClick"],at={class:"history-card-header"},ot={class:"topic-title"},lt={class:"topic-preview"},nt={key:0,class:"pagination-wrapper mt-6"},it={key:2,class:"writing-container"},rt={class:"back-button-container"},ct={class:"writing-layout"},ut={class:"topic-header"},dt={class:"word-req"},pt={key:0,class:"typing-cursor"},vt={class:"topic-tips"},mt={class:"editor-footer"},gt={class:"stats"},ft={key:0},yt={class:"actions"},_t={key:3,class:"result-container"},ht={__name:"WritingView",setup(bt){const y=we(),v=p("setup"),N=p(!1),m=p(""),g=p(null),_=p(null),S=p([]),P=p(1),$=p(6),x=p(0);q([P,$],()=>{M()});const f=p({examType:"cet4",mode:"essay",timeLimit:30}),J=[{value:"cet4",label:"CET-4",icon:"4"},{value:"cet6",label:"CET-6",icon:"6"},{value:"ielts",label:"IELTS",icon:"I"},{value:"toefl",label:"TOEFL",icon:"T"}],K=[{value:"essay",label:"ËÆÆËÆ∫Êñá",desc:"Discuss both views & give opinion",icon:de},{value:"chart",label:"ÂõæË°®‰ΩúÊñá",desc:"Describe trends in charts/graphs",icon:pe},{value:"letter",label:"Â∫îÁî®Êñá/‰π¶‰ø°",desc:"Formal/Informal letters",icon:ve}],X=[{value:0,label:"‰∏çÈôêÊó∂"},{value:30,label:"30ÂàÜÈíü"},{value:45,label:"45ÂàÜÈíü"},{value:60,label:"60ÂàÜÈíü"}],h=p(0);let B=null;const Y=U(()=>v.value==="writing"&&m.value.length>0),H=o=>{if(Y.value)return o.preventDefault(),o.returnValue="ÂÜô‰ΩúÊ≠£Âú®ËøõË°å‰∏≠ÔºåÁ°ÆÂÆöË¶ÅÁ¶ªÂºÄÂêóÔºü‰Ω†ÁöÑÊñáÁ´†ÂÜÖÂÆπÂ∞Ü‰ºö‰∏¢Â§±„ÄÇ",o.returnValue};Te(()=>{window.addEventListener("beforeunload",H),M()}),Ce(()=>{window.removeEventListener("beforeunload",H)}),q(v,o=>{o==="writing"&&f.value.timeLimit>0?(h.value=f.value.timeLimit*60,Q()):L()});const Q=()=>{L(),B=setInterval(()=>{h.value>0?h.value--:(L(),y.warning("Êó∂Èó¥Âà∞ÔºÅ"))},1e3)},L=()=>{B&&(clearInterval(B),B=null)};xe(()=>{L()});const Z=U(()=>{if(h.value<=0)return"00:00";const o=Math.floor(h.value/60),e=h.value%60;return`${String(o).padStart(2,"0")}:${String(e).padStart(2,"0")}`}),V=(o,e)=>{f.value[o]=e},ee=U(()=>S.value),M=async()=>{try{const o=await W.getWritingHistory(P.value,$.value);o.code===200&&(o.data.records?(S.value=o.data.records,x.value=o.data.total):(S.value=o.data||[],x.value=S.value.length))}catch(o){console.error("Failed to fetch writing history",o)}},{displayedText:te,isTyping:D,startTyping:R,setImmediate:se}=re("",20),ae=o=>{g.value=o,m.value="",v.value="writing",y.success(`Â∑≤Âä†ËΩΩ: ${o.title}`),R(o.prompt)},oe=async()=>{N.value=!0;try{const o=await W.generateWriting({examType:f.value.examType,mode:f.value.mode});o.code===200&&o.data?(g.value=o.data,m.value="",v.value="writing",R(o.data.prompt),y.success("È¢òÁõÆÁîüÊàêÊàêÂäü")):y.error("ÁîüÊàêÂ§±Ë¥•")}catch(o){console.error(o),y.error("ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•")}finally{N.value=!1}},le=async()=>{N.value=!0;try{const o=await W.evaluateWriting({topic:g.value.title,content:m.value});if(o.code===200&&o.data){_.value=o.data,v.value="result",y.success("ÊâπÊîπÂÆåÊàê");try{await ie.createRecord({contentId:g.value.id||0,contentType:"writing",isCorrect:_.value.score>=60?1:0,answer:m.value,correctAnswer:"N/A",score:_.value.score,masteryLevel:Math.floor(_.value.score/20),originalContent:JSON.stringify({topic:g.value,feedback:_.value.feedback})})}catch(e){console.error("Failed to save writing record",e)}}else y.error("ÊâπÊîπÂ§±Ë¥•")}catch(o){console.error(o),y.error("ËØ∑Ê±ÇÂ§±Ë¥•")}finally{N.value=!1}},G=()=>{v.value="setup",m.value="",g.value=null,_.value=null,h.value=0,L()},O=U(()=>m.value?m.value.split(/\s+/).filter(o=>o).length:0);return(o,e)=>{const d=Le("n-icon");return i(),c("div",Ve,[v.value==="setup"?(i(),c("div",We,[...e[4]||(e[4]=[t("h1",null,"ÂÜô‰ΩúÊô∫ËÉΩÊâπÊîπ",-1),t("p",null,"Ê®°ÊãüÁúüÂÆûËÄÉËØïÂú∫ÊôØÔºåAI ÂÆûÊó∂ËØäÊñ≠ËØ≠Ê≥ï‰∏éÈÄªËæëÊºèÊ¥û",-1)])])):k("",!0),v.value==="setup"?(i(),c("div",Ae,[l(s(z),{class:"setup-card",bordered:!1,size:"huge"},{default:n(()=>[l(s(j),{"x-gap":"40","y-gap":"40",cols:"1 800:3",responsive:"screen"},{default:n(()=>[l(s(A),{span:"2"},{default:n(()=>[t("div",Ee,[t("h3",null,[l(d,{component:s(ce),color:"#6366f1"},null,8,["component"]),e[5]||(e[5]=u(" ËÄÉËØïÁ±ªÂûã",-1))]),t("div",Fe,[(i(),c(w,null,T(J,a=>t("div",{key:a.value,class:E(["option-card",{active:f.value.examType===a.value}]),onClick:b=>V("examType",a.value)},[t("span",Me,r(a.icon),1),t("span",De,r(a.label),1)],10,He)),64))])]),t("div",Re,[t("h3",null,[l(d,{component:s(ue),color:"#a855f7"},null,8,["component"]),e[6]||(e[6]=u(" ÂÜô‰ΩúÈ¢òÂûã",-1))]),t("div",Ge,[(i(),c(w,null,T(K,a=>t("div",{key:a.value,class:E(["option-card mode-card",{active:f.value.mode===a.value}]),onClick:b=>V("mode",a.value)},[t("div",qe,[l(d,{component:a.icon},null,8,["component"])]),t("div",je,[t("div",Je,r(a.label),1),t("div",Ke,r(a.desc),1)])],10,Oe)),64))])])]),_:1}),l(s(A),null,{default:n(()=>[t("div",Xe,[t("div",Ye,[t("h3",null,[l(d,{component:s(me),color:"#eab308"},null,8,["component"]),e[7]||(e[7]=u(" ÈôêÊó∂ËÆ≠ÁªÉ",-1))]),t("div",Qe,[(i(),c(w,null,T(X,a=>t("div",{key:a.value,class:E(["pill-option",{active:f.value.timeLimit===a.value}]),onClick:b=>V("timeLimit",a.value)},r(a.label),11,Ze)),64))])]),e[9]||(e[9]=t("div",{class:"tips-box"},[t("h4",null,"üí° ËÆ≠ÁªÉË¥¥Â£´"),t("p",null,"Âª∫ËÆÆÂú®ÁîµËÑëÁ´ØËøõË°åÂÜô‰ΩúËÆ≠ÁªÉÔºå‰ª•Ê®°ÊãüÁúüÂÆûËÄÉÂú∫ËæìÂÖ•‰ΩìÈ™å„ÄÇAI Â∞Ü‰ªéËØçÊ±á„ÄÅËØ≠Ê≥ï„ÄÅÈÄªËæë‰∏â‰∏™Áª¥Â∫¶Êèê‰æõËØÑÂàÜ„ÄÇ")],-1)),l(s(ze)),l(s(C),{type:"primary",size:"large",block:"",round:"",class:"start-btn",onClick:oe},{icon:n(()=>[l(d,{component:s(ge)},null,8,["component"])]),default:n(()=>[e[8]||(e[8]=u(" ÁîüÊàêÈ¢òÁõÆ ",-1))]),_:1})])]),_:1})]),_:1})]),_:1}),x.value>0?(i(),c("div",et,[t("div",tt,[l(d,{component:s(fe)},null,8,["component"]),e[10]||(e[10]=u(" ÊúÄËøëÁîüÊàêÈ¢òÁõÆ ",-1))]),l(s(j),{"x-gap":"20","y-gap":"20",cols:"1 600:2 1200:3"},{default:n(()=>[(i(!0),c(w,null,T(ee.value,a=>(i(),I(s(A),{key:a.id},{default:n(()=>[t("div",{class:"history-card",onClick:b=>ae(a)},[t("div",at,[l(s(F),{size:"small",type:"warning",bordered:!1},{default:n(()=>[u(r(a.examType?.toUpperCase()),1)]),_:2},1024),l(s(F),{size:"tiny",bordered:!1},{default:n(()=>[u(r(a.mode),1)]),_:2},1024)]),t("h4",ot,r(a.title),1),t("div",lt,r(a.prompt?.substring(0,60))+"...",1)],8,st)]),_:2},1024))),128))]),_:1}),x.value>0?(i(),c("div",nt,[l(s(Ie),{page:P.value,"onUpdate:page":e[0]||(e[0]=a=>P.value=a),"item-count":x.value,"page-size":$.value,"show-size-picker":"","page-sizes":[6,12,18],"onUpdate:pageSize":e[1]||(e[1]=a=>$.value=a)},null,8,["page","item-count","page-size"])])):k("",!0)])):k("",!0)])):v.value==="writing"?(i(),c("div",it,[t("div",rt,[l(s(C),{secondary:"",onClick:G},{icon:n(()=>[l(d,{component:s(ye)},null,8,["component"])]),default:n(()=>[e[11]||(e[11]=u(" ËøîÂõûËÆæÁΩÆ ",-1))]),_:1})]),t("div",ct,[l(s(z),{class:"topic-card",bordered:!1},{default:n(()=>[t("div",ut,[l(s(F),{type:"warning"},{default:n(()=>[...e[12]||(e[12]=[u("Task 2",-1)])]),_:1}),t("span",dt,"Min Words: "+r(g.value.minWords),1)]),t("h2",null,r(g.value.title),1),t("div",{class:"topic-prompt",onClick:e[2]||(e[2]=a=>s(D)?s(se)(g.value.prompt):null)},[u(r(s(te))+" ",1),s(D)?(i(),c("span",pt,"|")):k("",!0)]),t("div",vt,[e[13]||(e[13]=t("strong",null,"Hints:",-1)),t("ul",null,[(i(!0),c(w,null,T(g.value.tips,(a,b)=>(i(),c("li",{key:b},r(a),1))),128))])])]),_:1}),l(s(z),{class:"editor-card",bordered:!1,"content-style":"display: flex; flex-direction: column; height: 100%;"},{default:n(()=>[l(s(Ne),{value:m.value,"onUpdate:value":e[3]||(e[3]=a=>m.value=a),type:"textarea",placeholder:"Start writing here...",class:"essay-editor",bordered:!1},null,8,["value"]),t("div",mt,[t("div",gt,[t("span",null,"Words: "+r(O.value),1),f.value.timeLimit>0?(i(),c("span",ft,"Time Left: "+r(Z.value),1)):k("",!0)]),t("div",yt,[l(s(C),{secondary:"",size:"large"},{default:n(()=>[...e[14]||(e[14]=[u("Â≠òËçâÁ®ø",-1)])]),_:1}),l(s(C),{type:"primary",size:"large",onClick:le,disabled:O.value<10},{default:n(()=>[...e[15]||(e[15]=[u(" Êèê‰∫§ÊâπÊîπ ",-1)])]),_:1},8,["disabled"])])])]),_:1})])])):v.value==="result"?(i(),c("div",_t,[l(s(z),{class:"score-card",bordered:!1},{default:n(()=>[l(s(Se),{status:"success",title:"ÊâπÊîπÂÆåÊàê",description:"AI È¢Ñ‰º∞ÂàÜÊï∞Ôºö"+_.value.score},{icon:n(()=>[l(d,{component:s(_e),size:"80",color:"#eab308"},null,8,["component"])]),footer:n(()=>[l(s(Pe),{justify:"center"},{default:n(()=>[l(s(C),{onClick:G},{default:n(()=>[...e[16]||(e[16]=[u("ÂÜçÂÜô‰∏ÄÁØá",-1)])]),_:1}),l(s(C),{type:"primary"},{default:n(()=>[...e[17]||(e[17]=[u("ÂØºÂá∫Êä•Âëä",-1)])]),_:1})]),_:1})]),_:1},8,["description"])]),_:1}),l(s(z),{title:"ËØ¶ÁªÜÂèçÈ¶à",class:"feedback-card",bordered:!1},{default:n(()=>[l(s($e),null,{default:n(()=>[(i(!0),c(w,null,T(_.value.feedback,(a,b)=>(i(),I(s(Be),{key:b},{default:n(()=>[l(s(Ue),null,{avatar:n(()=>[a.type==="grammar"?(i(),I(d,{key:0,component:s(he),color:"#ef4444",size:"24"},null,8,["component"])):a.type==="vocab"?(i(),I(d,{key:1,component:s(be),color:"#3b82f6",size:"24"},null,8,["component"])):(i(),I(d,{key:2,component:s(ke),color:"#10b981",size:"24"},null,8,["component"]))]),header:n(()=>[u(r(a.type.toUpperCase()),1)]),description:n(()=>[u(r(a.text),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])):k("",!0)])}}},zt=ne(ht,[["__scopeId","data-v-7537af4e"]]);export{zt as default};
