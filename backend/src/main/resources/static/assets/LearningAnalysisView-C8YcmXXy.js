import{_ as M,l as C}from"./index-CZUTEx94.js";import{i as Z,L as j}from"./echarts-5QPu3XI4.js";import{a5 as b,B as q,f as H,T as J,Z as K,h as O,l as z}from"./lucide-DtS2HtB5.js";import{a6 as X,r as p,S as $,I as c,z as d,F as e,s as t,q as a,H as g,u as s,L as r,K as B,a1 as V,_ as E,U as v,$ as u,X as i,J as F,a2 as G,a4 as R,ae as Q,ad as W,aC as Y,as as ee,n as se}from"./naive-ui-CN0IOFzZ.js";const te={class:"page-container"},ae={class:"page-header"},oe={class:"header-content"},le={key:0,class:"analysis-content"},ne={class:"overview-section"},re={class:"stat-content"},ie={class:"stat-icon-box purple"},ce={class:"stat-text"},de={class:"value"},ue={class:"stat-content"},pe={class:"stat-icon-box green"},ve={class:"stat-text"},_e={class:"value green"},fe={class:"stat-content"},ye={class:"stat-icon-box orange"},ge={class:"stat-text"},me={class:"value orange"},he={class:"stat-content"},be={class:"stat-icon-box blue"},xe={class:"stat-text"},we={class:"value"},ke={key:0,class:"ai-analysis-section"},Ae={class:"ai-header"},Ce={class:"ai-content"},Le={class:"analysis-layout"},Se={class:"ability-list"},Ne={class:"item-header"},Ie={class:"name"},Te={class:"item-footer"},ze={class:"right-col-stack"},Be={key:0,class:"weakness-list"},Ve={class:"wp-header"},Ee={class:"wp-title"},Fe={class:"wp-advice"},Ge={key:1,class:"weakness-empty"},Re={key:1,class:"empty-state"},Pe={__name:"LearningAnalysisView",setup(Ue){const L=X(),m=p(!0),h=p(!1),_=p(null),x=p(null);let f=null;const y=p({overall:0,growth:0,gap:0,predict:0}),S=p([]),w=p([]),P=async()=>{m.value=!0;try{const o=await C.getLastAnalysis();o.code===200&&o.data?I(o.data):_.value=null}catch(o){console.error("Failed to fetch last report:",o)}finally{m.value=!1,T()}},N=async()=>{h.value=!0;try{const o=await C.generateAnalysis();o.code===200&&(I(o.data),L.success("AI 深度分析报告已重新生成"),T())}catch{L.error("分析生成失败，请稍后重试")}finally{h.value=!1}},I=o=>{_.value=o,y.value={overall:o.overall,growth:o.growth,gap:o.gap,predict:o.predict},S.value=o.abilities||[],w.value=o.weakPoints||[]},T=async()=>{try{const o=await C.getTrends(7);o.code===200&&se(()=>{U(o.data)})}catch(o){console.error("Trend data fail:",o)}},U=o=>{if(!x.value)return;f&&f.dispose(),f=Z(x.value,"dark");const l=o.trendStats||[],n=l.map(A=>A.date.split("-").slice(1).join("/")),k=l.map(A=>(A.accuracy*100).toFixed(1)),D={backgroundColor:"transparent",tooltip:{trigger:"axis",backgroundColor:"#27272a",borderColor:"#3f3f46",textStyle:{color:"#fff"}},grid:{top:"15%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:n,axisLine:{lineStyle:{color:"#3f3f46"}},axisLabel:{color:"#a1a1aa"}},yAxis:{type:"value",max:100,splitLine:{lineStyle:{color:"rgba(255,255,255,0.05)"}},axisLabel:{color:"#a1a1aa",formatter:"{value}%"}},series:[{name:"学习准确率",type:"line",smooth:!0,data:k,lineStyle:{width:3,color:"#818cf8"},itemStyle:{color:"#818cf8"},areaStyle:{color:new j(0,0,0,1,[{offset:0,color:"rgba(129, 140, 248, 0.3)"},{offset:1,color:"rgba(129, 140, 248, 0)"}])},symbol:"circle",symbolSize:8}]};f.setOption(D)};return $(()=>{P(),window.addEventListener("resize",()=>f?.resize())}),(o,l)=>(d(),c("div",te,[e("div",ae,[e("div",oe,[l[1]||(l[1]=e("div",null,[e("h1",null,"学习分析"),e("p",null,"基于 AI 的全方位能力评估报告")],-1)),t(s(B),{type:"primary",secondary:"",round:"",loading:h.value,onClick:N},{icon:a(()=>[t(s(r),null,{default:a(()=>[t(s(b))]),_:1})]),default:a(()=>[l[0]||(l[0]=g(" 重新进行 AI 深度分析 ",-1))]),_:1},8,["loading"])])]),t(s(ee),{show:m.value},{default:a(()=>[_.value?(d(),c("div",le,[e("div",ne,[t(s(E),{"x-gap":"20","y-gap":"20",cols:"1 600:2 1000:4",responsive:"screen"},{default:a(()=>[t(s(v),null,{default:a(()=>[t(s(u),{class:"stat-card",bordered:!1},{default:a(()=>[e("div",re,[e("div",ie,[t(s(r),{component:s(q)},null,8,["component"])]),e("div",ce,[l[2]||(l[2]=e("div",{class:"label"},"综合能力值",-1)),e("div",de,i(y.value.overall),1)])])]),_:1})]),_:1}),t(s(v),null,{default:a(()=>[t(s(u),{class:"stat-card",bordered:!1},{default:a(()=>[e("div",ue,[e("div",pe,[t(s(r),{component:s(H)},null,8,["component"])]),e("div",ve,[l[3]||(l[3]=e("div",{class:"label"},"较上周提升",-1)),e("div",_e,"+"+i(y.value.growth)+"%",1)])])]),_:1})]),_:1}),t(s(v),null,{default:a(()=>[t(s(u),{class:"stat-card",bordered:!1},{default:a(()=>[e("div",fe,[e("div",ye,[t(s(r),{component:s(J)},null,8,["component"])]),e("div",ge,[l[4]||(l[4]=e("div",{class:"label"},"距目标差距",-1)),e("div",me,i(y.value.gap)+"%",1)])])]),_:1})]),_:1}),t(s(v),null,{default:a(()=>[t(s(u),{class:"stat-card",bordered:!1},{default:a(()=>[e("div",he,[e("div",be,[t(s(r),{component:s(K)},null,8,["component"])]),e("div",xe,[l[5]||(l[5]=e("div",{class:"label"},"预测分值 (CET)",-1)),e("div",we,i(y.value.predict),1)])])]),_:1})]),_:1})]),_:1})]),_.value.aiAnalysis?(d(),c("div",ke,[t(s(u),{class:"ai-analysis-card",bordered:!1},{header:a(()=>[e("div",Ae,[t(s(r),{component:s(b),size:"20",color:"#fbbf24"},null,8,["component"]),l[6]||(l[6]=e("span",null,"AI 导师综合点评",-1))])]),default:a(()=>[e("div",Ce,i(_.value.aiAnalysis),1)]),_:1})])):V("",!0),e("div",Le,[t(s(E),{"x-gap":"24","y-gap":"24",cols:"1 900:3",responsive:"screen"},{default:a(()=>[t(s(v),{span:"1"},{default:a(()=>[t(s(u),{title:"能力分布",class:"ability-card",bordered:!1},{"header-extra":a(()=>[t(s(r),{component:s(O),color:"#a1a1aa"},null,8,["component"])]),default:a(()=>[e("div",Se,[(d(!0),c(F,null,G(S.value,n=>(d(),c("div",{key:n.name,class:"ability-item"},[e("div",Ne,[e("span",Ie,i(n.name),1),e("span",{class:"score",style:R({color:n.color})},i(n.current)+"%",5)]),t(s(Q),{type:"line",percentage:n.current,color:n.color,"rail-color":"rgba(255,255,255,0.1)",height:6,"show-indicator":!1},null,8,["percentage","color"]),e("div",{class:"target-line",style:R({left:n.target+"%"})},null,4),e("div",Te," 目标: "+i(n.target)+"% ",1)]))),128))])]),_:1})]),_:1}),t(s(v),{span:"2"},{default:a(()=>[e("div",ze,[t(s(u),{title:"薄弱项诊断 & 建议",class:"advice-card",bordered:!1},{"header-extra":a(()=>[t(s(r),{component:s(z),color:"#ef4444"},null,8,["component"])]),default:a(()=>[w.value.length>0?(d(),c("div",Be,[(d(!0),c(F,null,G(w.value,(n,k)=>(d(),c("div",{key:k,class:"weakness-item"},[e("div",Ve,[e("div",Ee,[t(s(r),{component:s(z),color:n.color,class:"mr-2",style:{"margin-right":"8px"}},null,8,["component","color"]),g(" "+i(n.title),1)]),t(s(W),{color:{color:"rgba(239, 68, 68, 0.1)",textColor:"#ef4444"},size:"small",bordered:!1},{default:a(()=>[g(" 得分: "+i(n.score),1)]),_:2},1024)]),e("div",Fe,[l[7]||(l[7]=e("span",{class:"label"},"AI 建议:",-1)),g(" "+i(n.advice),1)])]))),128))])):(d(),c("div",Ge,[t(s(r),{component:s(b),size:"40",color:"#fbbf24",style:{"margin-bottom":"12px"}},null,8,["component"]),l[8]||(l[8]=e("div",{class:"empty-title"},"太棒了！暂无明显薄弱项",-1)),l[9]||(l[9]=e("div",{class:"empty-desc"},"您的各项能力发展均衡，请继续保持当前的良好状态！",-1))]))]),_:1}),t(s(u),{title:"学习准确率趋势",class:"trend-card",bordered:!1},{default:a(()=>[e("div",{ref_key:"trendChartRef",ref:x,class:"trend-chart"},null,512)]),_:1})])]),_:1})]),_:1})])])):m.value?V("",!0):(d(),c("div",Re,[t(s(Y),{description:"尚未生成分析报告，点击上方按钮开启 AI 深度分析"},{extra:a(()=>[t(s(B),{type:"primary",loading:h.value,onClick:N},{icon:a(()=>[t(s(r),null,{default:a(()=>[t(s(b))]),_:1})]),default:a(()=>[l[10]||(l[10]=g(" 立即生成分析报告 ",-1))]),_:1},8,["loading"])]),_:1})]))]),_:1},8,["show"])]))}},qe=M(Pe,[["__scopeId","data-v-07d23cc1"]]);export{qe as default};
