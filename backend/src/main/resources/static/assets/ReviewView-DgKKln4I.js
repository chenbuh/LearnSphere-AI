import{ao as _,_ as E,$ as F,af as G,r as p,o as P,V as j,g as h,b as w,e as l,d as a,w as t,j as f,u as e,i as m,a3 as z,y as b,p as U,ap as W,a2 as X,ac as H,c as J,k as K,aq as O,t as i,ad as S,al as Q,n as Y,ar as I,am as T}from"./index-DxUHCA-q.js";import{C as N,a as Z}from"./circle-check-big-qasVjenE.js";import{C as ee}from"./circle-x-CwYtcpQZ.js";import{N as R}from"./Statistic-t8PWF_Fh.js";const L={recordReview(n,u){return _.post("/vocabulary/mastery/record",{vocabularyId:n,isCorrect:u})},getReviewList(n=20){return _.get("/vocabulary/mastery/review-list",{params:{limit:n}})},getStats(){return _.get("/vocabulary/mastery/stats")},toggleFavorite(n,u){return _.post("/vocabulary/mastery/favorite",{vocabularyId:n,favorite:u})},addNotes(n,u){return _.post("/vocabulary/mastery/notes",{vocabularyId:n,notes:u})},getMasteryDetail(n){return _.get(`/vocabulary/mastery/detail/${n}`)}},ae={class:"review-page"},se={class:"page-header"},te={key:1,class:"review-session"},le={class:"progress-header"},re={class:"card-face front"},oe={class:"word-text"},ie={class:"phonetic"},ne={class:"card-face back"},ue={class:"meaning"},ce={class:"meta"},de={key:0,class:"answer-buttons"},ve={key:1,class:"hint-text"},pe={key:2,class:"complete-view"},fe={class:"trophy-icon"},ge={class:"stat-box"},ye={class:"val green"},_e={class:"stat-box"},we={class:"val red"},me={__name:"ReviewView",setup(n){const u=F(),V=G(),x=p(!1),c=p([]),g=p(0),y=p(!1),r=p({correct:0,wrong:0}),C=p(!1),d=p({total:0,mastered:0,familiar:0,learning:0,not_started:0});P(async()=>{await $(),await B()});const $=async()=>{x.value=!0;try{const o=await L.getReviewList(20);c.value=o.data,c.value.length===0&&V.info("今天没有需要复习的单词！")}catch(o){console.error("[Review] Load failed:",o),V.error("加载复习列表失败")}finally{x.value=!1}},B=async()=>{try{const o=await L.getStats();d.value=o.data}catch(o){console.error("[Stats] Load failed:",o)}},v=j(()=>c.value.length===0?null:c.value[g.value]),q=()=>{y.value=!y.value},M=async o=>{if(v.value){o?r.value.correct++:r.value.wrong++;try{await L.recordReview(v.value.vocabulary_id,o)}catch(s){console.error("[Review] Submit failed:",s)}g.value<c.value.length-1?(g.value++,y.value=!1):C.value=!0}},A=async()=>{g.value=0,r.value={correct:0,wrong:0},C.value=!1,y.value=!1,await $(),await B()},D=j(()=>d.value.total===0?0:Math.round(d.value.mastered/d.value.total*100));return(o,s)=>(w(),h("div",ae,[l("header",se,[s[6]||(s[6]=l("div",null,[l("h1",null,"智能复习"),l("p",null,"基于艾宾浩斯遗忘曲线的科学复习计划")],-1)),a(e(m),{secondary:"",onClick:s[0]||(s[0]=k=>e(u).push("/vocabulary"))},{default:t(()=>[...s[5]||(s[5]=[f(" 返回学习 ",-1)])]),_:1})]),a(e(X),{"x-gap":"16","y-gap":"16",cols:"1 600:2 900:4",responsive:"screen",class:"stats-grid"},{default:t(()=>[a(e(z),null,{default:t(()=>[a(e(b),{class:"stat-card green"},{default:t(()=>[a(e(R),{label:"完全掌握",value:d.value.mastered},{prefix:t(()=>[a(e(N),{size:20})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(z),null,{default:t(()=>[a(e(b),{class:"stat-card blue"},{default:t(()=>[a(e(R),{label:"熟悉中",value:d.value.familiar},{prefix:t(()=>[a(e(U),{size:20})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(z),null,{default:t(()=>[a(e(b),{class:"stat-card orange"},{default:t(()=>[a(e(R),{label:"学习中",value:d.value.learning},{prefix:t(()=>[a(e(W),{size:20})]),_:1},8,["value"])]),_:1})]),_:1}),a(e(z),null,{default:t(()=>[a(e(b),{class:"stat-card purple"},{default:t(()=>[a(e(R),{label:"掌握率",value:D.value,suffix:"%"},{prefix:t(()=>[a(e(Z),{size:20})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),a(e(b),{class:"main-card",bordered:!1},{default:t(()=>[a(e(H),{show:x.value},{default:t(()=>[c.value.length===0&&!x.value?(w(),J(e(O),{key:0,description:"今天没有需要复习的单词，继续保持！",size:"large"},{icon:t(()=>[a(e(N),{size:64,color:"#22c55e"})]),extra:t(()=>[a(e(m),{type:"primary",onClick:s[1]||(s[1]=k=>e(u).push("/vocabulary"))},{default:t(()=>[...s[7]||(s[7]=[f(" 去学习新单词 ",-1)])]),_:1})]),_:1})):!C.value&&c.value.length>0?(w(),h("div",te,[l("div",le,[l("span",null,"进度: "+i(g.value+1)+" / "+i(c.value.length),1),a(e(S),{type:r.value.correct>r.value.wrong?"success":"warning"},{default:t(()=>[f(" 正确率: "+i(Math.round(r.value.correct/(r.value.correct+r.value.wrong||1)*100))+"% ",1)]),_:1},8,["type"])]),a(e(Q),{type:"line",percentage:g.value/c.value.length*100,"show-indicator":!1,processing:"",color:"#6366f1",class:"progress-bar"},null,8,["percentage"]),l("div",{class:"flashcard-container",onClick:q},[l("div",{class:Y(["flashcard",{"is-flipped":y.value}])},[l("div",re,[l("h2",oe,i(v.value?.word),1),l("p",ie,i(v.value?.phonetic),1),s[8]||(s[8]=l("p",{class:"hint"},"点击查看释义",-1))]),l("div",ne,[s[9]||(s[9]=l("div",{class:"top-bar"},null,-1)),l("h3",ue,i(v.value?.translation),1),l("div",ce,[a(e(S),{size:"small",type:"info"},{default:t(()=>[f("Level "+i(v.value?.mastery_level),1)]),_:1}),a(e(S),{size:"small",type:"warning"},{default:t(()=>[f("复习 "+i(v.value?.review_count)+" 次",1)]),_:1})])])],2)]),y.value?(w(),h("div",de,[a(e(m),{size:"large",type:"error",circle:"",style:{width:"64px",height:"64px"},onClick:s[2]||(s[2]=I(k=>M(!1),["stop"]))},{icon:t(()=>[a(e(ee),{size:32})]),_:1}),a(e(m),{size:"large",type:"success",circle:"",style:{width:"64px",height:"64px"},onClick:s[3]||(s[3]=I(k=>M(!0),["stop"]))},{icon:t(()=>[a(e(N),{size:32})]),_:1})])):(w(),h("div",ve," 思考一下... "))])):C.value?(w(),h("div",pe,[l("div",fe,[a(e(N),{size:80,color:"#22c55e"})]),s[14]||(s[14]=l("h2",null,"复习完成！",-1)),l("p",null,"本次复习 "+i(r.value.correct+r.value.wrong)+" 个单词",1),a(e(T),{justify:"center",size:"large",class:"result-stats"},{default:t(()=>[l("div",ge,[l("div",ye,i(r.value.correct),1),s[10]||(s[10]=l("div",{class:"lbl"},"掌握",-1))]),l("div",_e,[l("div",we,i(r.value.wrong),1),s[11]||(s[11]=l("div",{class:"lbl"},"待加强",-1))])]),_:1}),a(e(T),{justify:"center",class:"mt-8"},{default:t(()=>[a(e(m),{type:"primary",size:"large",onClick:A},{default:t(()=>[...s[12]||(s[12]=[f(" 再复习一遍 ",-1)])]),_:1}),a(e(m),{secondary:"",size:"large",onClick:s[4]||(s[4]=k=>e(u).push("/vocabulary"))},{default:t(()=>[...s[13]||(s[13]=[f(" 返回学习 ",-1)])]),_:1})]),_:1})])):K("",!0)]),_:1},8,["show"])]),_:1})]))}},ke=E(me,[["__scopeId","data-v-6f2115ee"]]);export{ke as default};
