import{a as F}from"./ai-CYMBpxnS.js";import{Y as q,_ as le,af as ie,r as v,V as re,o as ne,a as ce,g as u,b as r,k as w,e as s,d as o,w as l,j as p,u as t,f as S,F as z,x as N,n as $,t as c,i as R,y as I,a3 as E,am as O,c as P,ad as A,a2 as Y,al as V,z as ue,D as de,bn as pe,aj as ve}from"./index-DxUHCA-q.js";import{R as ge}from"./rotate-ccw-C4DsUMxD.js";import{C as fe}from"./circle-stop-ChkWTsNT.js";import{C as me}from"./circle-play-BNF1hpSe.js";import{C as ye}from"./circle-check-Ch9ZOaK_.js";import{H as he}from"./history-DU2rBN7r.js";import{N as _e}from"./Result-BjByxIDK.js";const be=q("languages",[["path",{d:"m5 8 6 6",key:"1wu5hv"}],["path",{d:"m4 14 6-6 2-3",key:"1k1g8d"}],["path",{d:"M2 5h12",key:"or177f"}],["path",{d:"M7 2h1",key:"1t2jsx"}],["path",{d:"m22 22-5-10-5 10",key:"don7ne"}],["path",{d:"M14 18h6",key:"1m8k6r"}]]);const ke=q("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]),xe={class:"page-container"},we={key:0,class:"page-header"},Se={key:1,class:"setup-container"},Ce={class:"setting-section"},Te={class:"options-grid"},ze=["onClick"],Ne={class:"option-label"},Re={class:"option-desc"},Ie={class:"setting-section mt-8"},Me={key:2,class:"practice-container"},Pe={class:"mb-4"},Ae={class:"text-xl font-bold mb-4 text-white"},De={class:"question-box p-4 bg-white/5 rounded-lg mb-4 text-lg leading-relaxed text-gray-200"},Le={class:"tips-section"},Fe={class:"recorder-ui flex flex-col items-center justify-center h-full min-h-[400px]"},Ee={key:0,class:"ripple"},Ve={key:1,class:"ripple delay-1"},je={class:"timer text-4xl font-mono mb-8 text-white font-bold"},Be={class:"controls mb-8"},He={class:"transcript-preview w-full p-4 bg-black/20 rounded-lg text-gray-400 text-sm h-32 overflow-y-auto"},Ue={class:"w-full mt-4"},$e={key:3,class:"result-container"},Oe={class:"stat-item text-center"},Ye={class:"text-lg font-bold"},qe={class:"stat-item text-center"},Ge={class:"text-lg font-bold"},Je={class:"stat-item text-center"},Ke={class:"text-lg font-bold"},Qe={class:"feedback-text text-lg text-gray-200 mb-6 p-4 bg-white/5 rounded-lg"},We={class:"text-indigo-400 mb-2 flex items-center gap-2"},Xe={class:"mt-8 text-center"},Ze={key:0,class:"history-section mt-12"},et={class:"section-title"},tt=["onClick"],st={class:"history-card-header"},at={class:"topic-title"},ot={key:0,class:"pagination-wrapper mt-6"},lt={__name:"SpeakingView",setup(it){const y=ie(),g=v("setup"),k=v(!1),h=v(null),f=v(!1),m=v(""),_=v(0);let D=null,d=null;const n=v(null),C=v([]),L=v(1),x=v(6),M=v({type:"ielts_part2",difficulty:"normal"}),G=[{label:"IELTS Part 1",value:"ielts_part1",desc:"Short Q&A"},{label:"IELTS Part 2",value:"ielts_part2",desc:"Topic Card (2 mins)"},{label:"Business",value:"business",desc:"Meeting / Negotiation"},{label:"Daily Life",value:"daily",desc:"Travel, Food, Hobby"},{label:"Debate",value:"debate",desc:"Agree or Disagree"}],J=(a,e)=>{M.value[a]=e},K=re(()=>{const a=(L.value-1)*x.value,e=a+x.value;return C.value.slice(a,e)});ne(()=>{Q()});const Q=async()=>{try{const a=await F.getSpeakingHistory();a.code===200&&(C.value=a.data||[])}catch(a){console.error("Failed to fetch speaking history",a)}},W=a=>{h.value=a,g.value="practice",m.value="",_.value=0,y.success(`已加载: ${a.topic||a.title}`)},X=async()=>{k.value=!0;try{const a=await F.generateSpeaking({type:M.value.type,difficulty:M.value.difficulty});a.code===200&&a.data?(h.value=a.data,g.value="practice",m.value="",_.value=0,y.success("Topic generated!")):y.error("Failed to generate topic")}catch(a){console.error(a),h.value={title:"Describe a traditional festival",question:"Describe a traditional festival in your country. You should say: when it is celebrated, what people do, what you enjoy about it, and explain why it is important.",tips:["Use present tense","Mention colors and food","Explain cultural significance"],keywords:["Celebration","Tradition","Atmosphere","Customs"]},g.value="practice",m.value="",_.value=0}finally{k.value=!1}},Z=()=>{if("webkitSpeechRecognition"in window||"SpeechRecognition"in window){const a=window.SpeechRecognition||window.webkitSpeechRecognition;d=new a,d.continuous=!0,d.interimResults=!0,d.lang="en-US",d.onresult=e=>{let i="",T="";for(let b=e.resultIndex;b<e.results.length;++b)e.results[b].isFinal?T+=e.results[b][0].transcript:i+=e.results[b][0].transcript;const oe=Array.from(e.results).map(b=>b[0].transcript).join("");m.value=oe},d.onerror=e=>{console.error("Speech recognition error",e.error),f.value&&j(),y.error("Speech recognition error: "+e.error)}}else y.warning("Browser does not support Speech Recognition. Please type your response instead.")},ee=()=>{f.value?j():te()},te=()=>{if(d||Z(),d)try{d.start(),f.value=!0,B()}catch(a){console.error(a)}else f.value=!0,B(),y.info("Simulating recording (No Speech API)")},j=()=>{d&&d.stop(),f.value=!1,H()},B=()=>{clearInterval(D),D=setInterval(()=>{_.value++},1e3)},H=()=>{clearInterval(D)},se=a=>{const e=Math.floor(a/60).toString().padStart(2,"0"),i=(a%60).toString().padStart(2,"0");return`${e}:${i}`};ce(()=>{H(),d&&d.stop()});const ae=async()=>{if(!m.value&&_.value<5){y.warning("Please say something more substantial.");return}k.value=!0;try{const a=await F.evaluateSpeaking({topic:h.value.title,transcription:m.value||"(No speech detected, user submitted empty)"});if(a.code===200&&a.data){n.value=a.data,g.value="result",y.success("Evaluation complete");try{await ve.createRecord({contentType:"speaking",contentId:0,isCorrect:n.value.score>60?1:0,answer:m.value,correctAnswer:"N/A",score:n.value.score,masteryLevel:Math.floor(n.value.score/20),originalContent:JSON.stringify({topic:h.value,feedback:n.value})})}catch(e){console.error("Failed to save record",e)}}else y.error("Evaluation failed")}catch(a){console.error(a),n.value={score:75,fluency:70,vocabulary:80,grammar:75,relevance:80,feedback:"Overall good attempt. You addressed the prompt well. Try to reduce hesitation.",suggestions:["Use more transitional phrases","Practice past tense verbs"]},g.value="result"}finally{k.value=!1}},U=()=>{g.value="setup",m.value="",_.value=0,n.value=null};return(a,e)=>(r(),u("div",xe,[g.value==="setup"?(r(),u("div",we,[...e[2]||(e[2]=[s("h1",null,"AI 口语陪练",-1),s("p",null,"模拟真实雅思/托福口语考试场景，AI 实时听音纠错",-1)])])):w("",!0),g.value==="setup"?(r(),u("div",Se,[o(t(I),{class:"setup-card",bordered:!1,size:"huge"},{default:l(()=>[s("div",Ce,[s("h3",null,[o(t(S),{component:t(be),color:"#fdba74",class:"mr-2"},null,8,["component"]),e[3]||(e[3]=p(" 选择话题类型",-1))]),s("div",Te,[(r(),u(z,null,N(G,i=>s("div",{key:i.value,class:$(["option-card",{active:M.value.type===i.value}]),onClick:T=>J("type",i.value)},[s("div",Ne,c(i.label),1),s("div",Re,c(i.desc),1)],10,ze)),64))])]),s("div",Ie,[o(t(R),{type:"primary",size:"large",block:"",round:"",class:"start-btn",loading:k.value,onClick:X},{default:l(()=>[...e[4]||(e[4]=[p(" 开始练习 ",-1)])]),_:1},8,["loading"])])]),_:1})])):g.value==="practice"?(r(),u("div",Me,[s("div",Pe,[o(t(R),{secondary:"",onClick:U},{icon:l(()=>[o(t(S),{component:t(ge)},null,8,["component"])]),default:l(()=>[e[5]||(e[5]=p(" 重选话题",-1))]),_:1})]),o(t(Y),{"x-gap":"24",cols:"1 800:2",responsive:"screen"},{default:l(()=>[o(t(E),null,{default:l(()=>[o(t(I),{class:"topic-card",title:"Speaking Topic",bordered:!1},{default:l(()=>[s("h2",Ae,c(h.value.title),1),s("div",De,c(h.value.question),1),s("div",Le,[e[6]||(e[6]=s("div",{class:"text-gray-400 mb-2 text-sm"},"KEYWORDS & TIPS",-1)),o(t(O),null,{default:l(()=>[(r(!0),u(z,null,N(h.value.keywords,i=>(r(),P(t(A),{key:i,size:"small",bordered:!1,type:"info"},{default:l(()=>[p(c(i),1)]),_:2},1024))),128)),(r(!0),u(z,null,N(h.value.tips,i=>(r(),P(t(A),{key:i,size:"small",bordered:!1,type:"warning"},{default:l(()=>[p(c(i),1)]),_:2},1024))),128))]),_:1})])]),_:1})]),_:1}),o(t(E),null,{default:l(()=>[o(t(I),{class:"recorder-card",bordered:!1},{default:l(()=>[s("div",Fe,[s("div",{class:$(["visualizer-circle mb-8",{active:f.value}])},[o(t(S),{component:t(ke),size:"48",color:"white"},null,8,["component"]),f.value?(r(),u("div",Ee)):w("",!0),f.value?(r(),u("div",Ve)):w("",!0)],2),s("div",je,c(se(_.value)),1),s("div",Be,[o(t(R),{circle:"",size:"large",style:{width:"80px",height:"80px"},type:f.value?"error":"primary",onClick:ee},{icon:l(()=>[o(t(S),{component:f.value?t(fe):t(me),size:"40"},null,8,["component"])]),_:1},8,["type"])]),s("div",He,c(m.value||"Click microphone to start speaking..."),1),s("div",Ue,[o(t(R),{type:"success",block:"",size:"large",disabled:!m.value&&_.value<2,onClick:ae,loading:k.value},{default:l(()=>[...e[7]||(e[7]=[p(" 完成并评估 ",-1)])]),_:1},8,["disabled","loading"])])])]),_:1})]),_:1})]),_:1})])):g.value==="result"?(r(),u("div",$e,[o(t(I),{class:"score-card",bordered:!1},{default:l(()=>[o(t(_e),{status:"success",title:"Evaluation Complete",description:"Overall Score: "+n.value.score},{footer:l(()=>[o(t(O),{justify:"center",size:"large"},{default:l(()=>[s("div",Oe,[o(t(V),{type:"circle",percentage:n.value.fluency,color:"#6366f1",width:80},{default:l(()=>[e[8]||(e[8]=s("span",{class:"text-xs text-gray-400"},"Fluency",-1)),e[9]||(e[9]=s("br",null,null,-1)),s("span",Ye,c(n.value.fluency),1)]),_:1},8,["percentage"])]),s("div",qe,[o(t(V),{type:"circle",percentage:n.value.vocabulary,color:"#10b981",width:80},{default:l(()=>[e[10]||(e[10]=s("span",{class:"text-xs text-gray-400"},"Vocab",-1)),e[11]||(e[11]=s("br",null,null,-1)),s("span",Ge,c(n.value.vocabulary),1)]),_:1},8,["percentage"])]),s("div",Je,[o(t(V),{type:"circle",percentage:n.value.grammar,color:"#f59e0b",width:80},{default:l(()=>[e[12]||(e[12]=s("span",{class:"text-xs text-gray-400"},"Grammar",-1)),e[13]||(e[13]=s("br",null,null,-1)),s("span",Ke,c(n.value.grammar),1)]),_:1},8,["percentage"])])]),_:1})]),_:1},8,["description"])]),_:1}),o(t(I),{title:"Detailed Feedback",class:"mt-6",bordered:!1},{default:l(()=>[s("div",Qe,c(n.value.feedback),1),s("h3",We,[o(t(S),{component:t(ye)},null,8,["component"]),e[14]||(e[14]=p(" Suggestions",-1))]),o(t(ue),null,{default:l(()=>[(r(!0),u(z,null,N(n.value.suggestions,(i,T)=>(r(),P(t(de),{key:T},{default:l(()=>[p(c(i),1)]),_:2},1024))),128))]),_:1}),s("div",Xe,[o(t(R),{type:"primary",size:"large",onClick:U},{default:l(()=>[...e[15]||(e[15]=[p("Practice Another Topic",-1)])]),_:1})])]),_:1}),C.value.length>0?(r(),u("div",Ze,[s("div",et,[o(t(S),{component:t(he)},null,8,["component"]),e[16]||(e[16]=p(" 最近生成话题 ",-1))]),o(t(Y),{"x-gap":"20","y-gap":"20",cols:"1 600:2 1200:3"},{default:l(()=>[(r(!0),u(z,null,N(K.value,i=>(r(),P(t(E),{key:i.id},{default:l(()=>[s("div",{class:"history-card",onClick:T=>W(i)},[s("div",st,[o(t(A),{size:"small",type:"warning",bordered:!1},{default:l(()=>[p(c(i.type),1)]),_:2},1024),o(t(A),{size:"tiny",bordered:!1},{default:l(()=>[p(c(i.difficulty),1)]),_:2},1024)]),s("h4",at,c(i.topic),1)],8,tt)]),_:2},1024))),128))]),_:1}),C.value.length>x.value?(r(),u("div",ot,[o(t(pe),{page:L.value,"onUpdate:page":e[0]||(e[0]=i=>L.value=i),"page-count":Math.ceil(C.value.length/x.value),"page-size":x.value,"show-size-picker":"","page-sizes":[6,12,18],"onUpdate:pageSize":e[1]||(e[1]=i=>x.value=i)},null,8,["page","page-count","page-size"])])):w("",!0)])):w("",!0)])):w("",!0)]))}},ft=le(lt,[["__scopeId","data-v-b1f9f86e"]]);export{ft as default};
