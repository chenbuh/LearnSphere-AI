<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
        }
        .test-btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .stop-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
        }
        #log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-top: 20px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”Š TTS è¯­éŸ³åˆæˆæµ‹è¯•</h1>
    
    <div>
        <button class="test-btn" onclick="testBasicTTS()">æµ‹è¯•åŸºç¡€ TTS</button>
        <button class="test-btn" onclick="testEnglishTTS()">æµ‹è¯•è‹±è¯­ TTS</button>
        <button class="test-btn" onclick="testExamScript()">æµ‹è¯•è€ƒè¯•è„šæœ¬</button>
        <button class="stop-btn" onclick="stopTTS()">åœæ­¢æ’­æ”¾</button>
    </div>
    
    <div>
        <button class="test-btn" onclick="checkVoices()">æ£€æŸ¥å¯ç”¨è¯­éŸ³</button>
        <button class="test-btn" onclick="checkSupport()">æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ</button>
        <button class="test-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div id="log"></div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function checkSupport() {
            log('=== æ£€æŸ¥æµè§ˆå™¨æ”¯æŒ ===');
            log('speechSynthesis æ”¯æŒ: ' + ('speechSynthesis' in window));
            log('SpeechSynthesisUtterance æ”¯æŒ: ' + ('SpeechSynthesisUtterance' in window));
            
            if ('speechSynthesis' in window) {
                const synth = window.speechSynthesis;
                log('speaking: ' + synth.speaking);
                log('pending: ' + synth.pending);
                log('paused: ' + synth.paused);
            }
        }

        function checkVoices() {
            log('=== æ£€æŸ¥å¯ç”¨è¯­éŸ³ ===');
            if (!('speechSynthesis' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ speechSynthesis');
                return;
            }

            const synth = window.speechSynthesis;
            const voices = synth.getVoices();
            log('å¯ç”¨è¯­éŸ³æ•°é‡: ' + voices.length);
            
            if (voices.length === 0) {
                log('â³ è¯­éŸ³åº“æœªåŠ è½½ï¼Œç­‰å¾… onvoiceschanged...');
                synth.onvoiceschanged = () => {
                    const newVoices = synth.getVoices();
                    log('âœ… è¯­éŸ³åº“åŠ è½½å®Œæˆï¼Œæ•°é‡: ' + newVoices.length);
                    newVoices.forEach((voice, index) => {
                        log(`${index + 1}. ${voice.name} (${voice.lang}) ${voice.default ? '[é»˜è®¤]' : ''}`);
                    });
                };
            } else {
                voices.forEach((voice, index) => {
                    log(`${index + 1}. ${voice.name} (${voice.lang}) ${voice.default ? '[é»˜è®¤]' : ''}`);
                });
            }
        }

        function testBasicTTS() {
            log('=== æµ‹è¯•åŸºç¡€ TTS ===');
            if (!('speechSynthesis' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ speechSynthesis');
                return;
            }

            const synth = window.speechSynthesis;
            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance('Hello, this is a test.');
            utterance.lang = 'en-US';
            utterance.rate = 1.0;
            
            utterance.onstart = () => log('âœ… TTS å¼€å§‹æ’­æ”¾');
            utterance.onend = () => log('âœ… TTS æ’­æ”¾ç»“æŸ');
            utterance.onerror = (e) => log('âŒ TTS é”™è¯¯: ' + e.error);
            
            log('ğŸ™ï¸ è°ƒç”¨ speak()...');
            synth.speak(utterance);
        }

        function testEnglishTTS() {
            log('=== æµ‹è¯•è‹±è¯­ TTS ===');
            if (!('speechSynthesis' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ speechSynthesis');
                return;
            }

            const synth = window.speechSynthesis;
            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance('What is the main topic of the conversation?');
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            
            // é€‰æ‹©è‹±è¯­è¯­éŸ³
            const voices = synth.getVoices();
            const englishVoice = voices.find(v => v.lang && v.lang.toLowerCase().startsWith('en'));
            if (englishVoice) {
                utterance.voice = englishVoice;
                log('ğŸ¯ ä½¿ç”¨è¯­éŸ³: ' + englishVoice.name);
            } else {
                log('âš ï¸ æœªæ‰¾åˆ°è‹±è¯­è¯­éŸ³ï¼Œä½¿ç”¨é»˜è®¤è¯­éŸ³');
            }
            
            utterance.onstart = () => log('âœ… è‹±è¯­ TTS å¼€å§‹æ’­æ”¾');
            utterance.onend = () => log('âœ… è‹±è¯­ TTS æ’­æ”¾ç»“æŸ');
            utterance.onerror = (e) => log('âŒ è‹±è¯­ TTS é”™è¯¯: ' + e.error);
            
            log('ğŸ™ï¸ è°ƒç”¨è‹±è¯­ speak()...');
            synth.speak(utterance);
            
            // resume æ£€æŸ¥
            setTimeout(() => {
                if (synth.paused) {
                    log('ğŸ”“ æ£€æµ‹åˆ°æš‚åœï¼Œå°è¯• resume...');
                    synth.resume();
                }
            }, 100);
        }

        function testExamScript() {
            log('=== æµ‹è¯•è€ƒè¯•è„šæœ¬ ===');
            const script = `[Audio Script for cet4]
Speaker: What is the main topic of the conversation?
[End of audio]`;
            
            if (!('speechSynthesis' in window)) {
                log('âŒ æµè§ˆå™¨ä¸æ”¯æŒ speechSynthesis');
                return;
            }

            const synth = window.speechSynthesis;
            synth.cancel();
            
            const utterance = new SpeechSynthesisUtterance(script);
            utterance.lang = 'en-US';
            utterance.rate = 0.8;
            
            utterance.onstart = () => log('âœ… è€ƒè¯•è„šæœ¬ TTS å¼€å§‹æ’­æ”¾');
            utterance.onend = () => log('âœ… è€ƒè¯•è„šæœ¬ TTS æ’­æ”¾ç»“æŸ');
            utterance.onerror = (e) => log('âŒ è€ƒè¯•è„šæœ¬ TTS é”™è¯¯: ' + e.error);
            
            log('ğŸ™ï¸ è°ƒç”¨è€ƒè¯•è„šæœ¬ speak()...');
            synth.speak(utterance);
        }

        function stopTTS() {
            log('=== åœæ­¢ TTS ===');
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                log('â¹ TTS å·²åœæ­¢');
            }
        }

        function clearLog() {
            document.getElementById('log').textContent = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥æ”¯æŒ
        window.onload = function() {
            log('ğŸš€ TTS æµ‹è¯•é¡µé¢å·²åŠ è½½');
            checkSupport();
            
            // å»¶è¿Ÿæ£€æŸ¥è¯­éŸ³
            setTimeout(() => {
                checkVoices();
            }, 1000);
        };
    </script>
</body>
</html>
