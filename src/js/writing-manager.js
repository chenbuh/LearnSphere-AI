/**
 * å†™ä½œç»ƒä¹ ç®¡ç†å™¨
 * è´Ÿè´£å¤„ç†è‹±è¯­å†™ä½œç»ƒä¹ çš„æ‰€æœ‰åŠŸèƒ½
 */
class WritingManager {
    constructor() {
        this.currentWriting = null;
        this.writingSession = null;
        this.startTime = null;
        this.timer = null;
        
        // é…ç½®é€‰é¡¹
        this.config = {
            writingType: 'essay',
            difficulty: 'intermediate',
            examType: 'ielts',
            wordLimit: 250
        };
        
        // ç”¨æˆ·å†™ä½œæ•°æ®
        this.writingProgress = {
            totalWritings: 0,
            totalWords: 0,
            averageScore: 0,
            totalTime: 0,
            typeStats: {
                essay: { completed: 0, averageScore: 0, totalWords: 0 },
                letter: { completed: 0, averageScore: 0, totalWords: 0 },
                report: { completed: 0, averageScore: 0, totalWords: 0 },
                email: { completed: 0, averageScore: 0, totalWords: 0 }
            },
            recentWritings: []
        };
        
        this.init();
    }

    /**
     * åˆå§‹åŒ–å†™ä½œç®¡ç†å™¨
     */
    init() {
        this.loadWritingProgress();
        this.initializeTopicsDatabase();
        console.log('âœï¸ å†™ä½œç»ƒä¹ ç®¡ç†å™¨å·²åˆå§‹åŒ–');
    }

    /**
     * åˆå§‹åŒ–å†™ä½œé¢˜ç›®æ•°æ®åº“
     */
    initializeTopicsDatabase() {
        this.topicsDatabase = {
            essay: {
                beginner: [
                    {
                        id: 'essay_beg_001',
                        type: 'opinion',
                        title: 'æˆ‘æœ€å–œæ¬¢çš„å­£èŠ‚',
                        prompt: 'æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±æœ€å–œæ¬¢çš„å­£èŠ‚ã€‚è¯·å†™ä¸€ç¯‡çŸ­æ–‡ï¼Œä»‹ç»ä½ æœ€å–œæ¬¢çš„å­£èŠ‚ï¼Œå¹¶è¯´æ˜å–œæ¬¢çš„åŸå› ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº150å­—',
                            'ä½¿ç”¨ç®€å•æ¸…æ™°çš„è¯­è¨€',
                            'ç»™å‡ºå…·ä½“çš„ç†ç”±',
                            'ç»“æ„ç®€å•æ˜äº†'
                        ],
                        keywords: ['å­£èŠ‚', 'å–œå¥½', 'åŸå› ', 'å¤©æ°”', 'æ´»åŠ¨'],
                        difficulty: 'beginner',
                        timeLimit: 30,
                        wordLimit: 150,
                        examType: 'general'
                    },
                    {
                        id: 'essay_beg_002',
                        type: 'descriptive',
                        title: 'æˆ‘çš„å®¶ä¹¡',
                        prompt: 'è¯·æè¿°ä½ çš„å®¶ä¹¡ï¼ŒåŒ…æ‹¬å®ƒçš„åœ°ç†ä½ç½®ã€æ°”å€™ç‰¹ç‚¹ã€è‘—åæ™¯ç‚¹æˆ–ç‰¹è‰²æ–‡åŒ–ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº160å­—',
                            'æè¿°å…·ä½“ç”ŸåŠ¨',
                            'åŒ…å«åœ°ç†å’Œæ–‡åŒ–ä¿¡æ¯',
                            'ä½¿ç”¨åŸºç¡€è¯æ±‡å’Œå¥å‹'
                        ],
                        keywords: ['å®¶ä¹¡', 'åœ°ç†ä½ç½®', 'æ°”å€™', 'æ™¯ç‚¹', 'æ–‡åŒ–'],
                        difficulty: 'beginner',
                        timeLimit: 35,
                        wordLimit: 160,
                        examType: 'general'
                    },
                    {
                        id: 'essay_beg_003',
                        type: 'narrative',
                        title: 'éš¾å¿˜çš„ä¸€å¤©',
                        prompt: 'è¯·å†™ä¸€ç¯‡çŸ­æ–‡ï¼Œæè¿°ä½ ç”Ÿæ´»ä¸­éš¾å¿˜çš„ä¸€å¤©ï¼Œè¯´æ˜è¿™ä¸€å¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè®©ä½ å°è±¡æ·±åˆ»ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº140å­—',
                            'æŒ‰æ—¶é—´é¡ºåºå™è¿°',
                            'è¡¨è¾¾çœŸå®æ„Ÿå—',
                            'è¯­è¨€ç®€å•æ˜“æ‡‚'
                        ],
                        keywords: ['éš¾å¿˜', 'ç»å†', 'æ„Ÿå—', 'å›å¿†', 'æ•…äº‹'],
                        difficulty: 'beginner',
                        timeLimit: 30,
                        wordLimit: 140,
                        examType: 'general'
                    }
                ],
                intermediate: [
                    {
                        id: 'essay_int_001',
                        type: 'argumentative',
                        title: 'åœ¨çº¿å­¦ä¹ çš„ä¼˜ç¼ºç‚¹',
                        prompt: 'è¿‘å¹´æ¥ï¼Œåœ¨çº¿å­¦ä¹ å˜å¾—è¶Šæ¥è¶Šæµè¡Œã€‚ä¸€äº›äººè®¤ä¸ºåœ¨çº¿å­¦ä¹ æ˜¯æœªæ¥æ•™è‚²çš„è¶‹åŠ¿ï¼Œè€Œå¦ä¸€äº›äººåˆ™è®¤ä¸ºä¼ ç»Ÿè¯¾å ‚æ•™å­¦æ›´æœ‰æ•ˆã€‚è¯·è®¨è®ºåœ¨çº¿å­¦ä¹ çš„ä¼˜ç¼ºç‚¹ï¼Œå¹¶ç»™å‡ºä½ çš„è§‚ç‚¹ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº250å­—',
                            'æ¸…æ¥šè¡¨è¾¾è§‚ç‚¹å¹¶æä¾›æ”¯æŒè®ºæ®',
                            'ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘è¿è´¯',
                            'ä½¿ç”¨é€‚å½“çš„è¯æ±‡å’Œè¯­æ³•'
                        ],
                        keywords: ['åœ¨çº¿å­¦ä¹ ', 'ä¼ ç»Ÿæ•™è‚²', 'ä¼˜åŠ¿', 'åŠ£åŠ¿', 'æŠ€æœ¯', 'äº’åŠ¨'],
                        difficulty: 'intermediate',
                        timeLimit: 40, // åˆ†é’Ÿ
                        wordLimit: 250,
                        examType: 'ielts'
                    },
                    {
                        id: 'essay_int_002',
                        type: 'opinion',
                        title: 'ç¤¾äº¤åª’ä½“å¯¹å¹´è½»äººçš„å½±å“',
                        prompt: 'ç¤¾äº¤åª’ä½“å·²æˆä¸ºç°ä»£ç”Ÿæ´»çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯å¯¹å¹´è½»äººè€Œè¨€ã€‚è¯·è®ºè¿°ç¤¾äº¤åª’ä½“å¯¹å¹´è½»äººç”Ÿæ´»çš„ç§¯æå’Œæ¶ˆæå½±å“ï¼Œå¹¶è¡¨è¾¾ä½ çš„çœ‹æ³•ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº250å­—',
                            'åˆ†æç§¯æå’Œæ¶ˆæå½±å“',
                            'æä¾›å…·ä½“ä¾‹å­å’Œè®ºæ®',
                            'ç»™å‡ºå¹³è¡¡çš„è§‚ç‚¹'
                        ],
                        keywords: ['ç¤¾äº¤åª’ä½“', 'å¹´è½»äºº', 'å½±å“', 'æ²Ÿé€š', 'å¿ƒç†å¥åº·', 'ä¿¡æ¯ä¼ æ’­'],
                        difficulty: 'intermediate',
                        timeLimit: 40,
                        wordLimit: 250,
                        examType: 'ielts'
                    },
                    {
                        id: 'essay_int_003',
                        type: 'problem_solution',
                        title: 'åŸå¸‚äº¤é€šæ‹¥å µé—®é¢˜',
                        prompt: 'è®¸å¤šå¤§åŸå¸‚éƒ½é¢ä¸´äº¤é€šæ‹¥å µçš„ä¸¥é‡é—®é¢˜ï¼Œè¿™ä¸ä»…å½±å“äººä»¬çš„æ—¥å¸¸ç”Ÿæ´»ï¼Œè¿˜å¯¹ç¯å¢ƒé€ æˆè´Ÿé¢å½±å“ã€‚è¯·åˆ†æé€ æˆäº¤é€šæ‹¥å µçš„ä¸»è¦åŸå› ï¼Œå¹¶æå‡ºå¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº250å­—',
                            'åˆ†æé—®é¢˜çš„ä¸»è¦åŸå› ',
                            'æå‡ºåˆ‡å®å¯è¡Œçš„è§£å†³æ–¹æ¡ˆ',
                            'é€»è¾‘æ¸…æ™°ï¼Œè®ºè¿°å……åˆ†'
                        ],
                        keywords: ['äº¤é€šæ‹¥å µ', 'åŸå¸‚åŒ–', 'å…¬å…±äº¤é€š', 'ç¯å¢ƒæ±¡æŸ“', 'è§£å†³æ–¹æ¡ˆ'],
                        difficulty: 'intermediate',
                        timeLimit: 40,
                        wordLimit: 250,
                        examType: 'ielts'
                    }
                ],
                advanced: [
                    {
                        id: 'essay_adv_001',
                        type: 'argumentative',
                        title: 'äººå·¥æ™ºèƒ½å¯¹å°±ä¸šå¸‚åœºçš„å½±å“',
                        prompt: 'éšç€äººå·¥æ™ºèƒ½æŠ€æœ¯çš„å¿«é€Ÿå‘å±•ï¼Œè®¸å¤šäººæ‹…å¿ƒAIä¼šå–ä»£äººç±»çš„å·¥ä½œå²—ä½ï¼Œè€Œå¦ä¸€äº›äººè®¤ä¸ºAIä¼šåˆ›é€ æ–°çš„å°±ä¸šæœºä¼šã€‚è¯·æ·±å…¥åˆ†æäººå·¥æ™ºèƒ½å¯¹å°±ä¸šå¸‚åœºçš„å½±å“ï¼Œå¹¶è®ºè¿°æˆ‘ä»¬åº”è¯¥å¦‚ä½•åº”å¯¹è¿™ä¸€æŒ‘æˆ˜ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº300å­—',
                            'æ·±å…¥åˆ†æAIå¯¹å°±ä¸šçš„å¤šæ–¹é¢å½±å“',
                            'æå‡ºåº”å¯¹ç­–ç•¥å’Œå»ºè®®',
                            'ä½¿ç”¨é«˜çº§è¯æ±‡å’Œå¤æ‚å¥å¼',
                            'è®ºè¯ä¸¥å¯†ï¼Œé€»è¾‘æ€§å¼º'
                        ],
                        keywords: ['äººå·¥æ™ºèƒ½', 'å°±ä¸šå¸‚åœº', 'è‡ªåŠ¨åŒ–', 'æŠ€èƒ½è½¬å‹', 'æœªæ¥å·¥ä½œ', 'æ•™è‚²åŸ¹è®­'],
                        difficulty: 'advanced',
                        timeLimit: 45,
                        wordLimit: 300,
                        examType: 'ielts'
                    },
                    {
                        id: 'essay_adv_002',
                        type: 'argumentative',
                        title: 'å…¨çƒåŒ–å¯¹æ–‡åŒ–å¤šæ ·æ€§çš„å½±å“',
                        prompt: 'å…¨çƒåŒ–è¿›ç¨‹åœ¨ä¿ƒè¿›ä¸–ç•Œç»æµå‘å±•çš„åŒæ—¶ï¼Œä¹Ÿå¯¹å„å›½çš„ä¼ ç»Ÿæ–‡åŒ–äº§ç”Ÿäº†æ·±è¿œå½±å“ã€‚æœ‰äººè®¤ä¸ºå…¨çƒåŒ–å¯¼è‡´æ–‡åŒ–åŒè´¨åŒ–ï¼Œå¨èƒæ–‡åŒ–å¤šæ ·æ€§ï¼›è€Œå¦ä¸€äº›äººè®¤ä¸ºå…¨çƒåŒ–ä¿ƒè¿›äº†æ–‡åŒ–äº¤æµä¸èåˆã€‚è¯·å°±å…¨çƒåŒ–å¯¹æ–‡åŒ–å¤šæ ·æ€§çš„å½±å“è¿›è¡Œæ·±å…¥åˆ†æã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº320å­—',
                            'åˆ†æå…¨çƒåŒ–çš„ç§¯æå’Œæ¶ˆæå½±å“',
                            'æä¾›å…·ä½“ä¾‹å­æ”¯æŒè®ºç‚¹',
                            'å±•ç°æ‰¹åˆ¤æ€§æ€ç»´',
                            'ç»“è®ºéƒ¨åˆ†æå‡ºå¹³è¡¡è§‚ç‚¹'
                        ],
                        keywords: ['å…¨çƒåŒ–', 'æ–‡åŒ–å¤šæ ·æ€§', 'æ–‡åŒ–äº¤æµ', 'ä¼ ç»Ÿæ–‡åŒ–', 'ç°ä»£åŒ–', 'æ–‡åŒ–ä¿æŠ¤'],
                        difficulty: 'advanced',
                        timeLimit: 50,
                        wordLimit: 320,
                        examType: 'ielts'
                    },
                    {
                        id: 'essay_adv_003',
                        type: 'problem_solution',
                        title: 'æ°”å€™å˜åŒ–çš„è§£å†³æ–¹æ¡ˆ',
                        prompt: 'æ°”å€™å˜åŒ–å·²æˆä¸º21ä¸–çºªæœ€ä¸¥å³»çš„å…¨çƒæ€§æŒ‘æˆ˜ä¹‹ä¸€ã€‚è¯·åˆ†ææ°”å€™å˜åŒ–äº§ç”Ÿçš„ä¸»è¦åŸå› ï¼Œè¯„ä¼°å…¶å¯¹äººç±»ç¤¾ä¼šå’Œè‡ªç„¶ç¯å¢ƒçš„å½±å“ï¼Œå¹¶æå‡ºåˆ‡å®å¯è¡Œçš„è§£å†³æ–¹æ¡ˆã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº350å­—',
                            'ç³»ç»Ÿåˆ†æé—®é¢˜çš„æ ¹æœ¬åŸå› ',
                            'è¯„ä¼°å¤šå±‚é¢çš„å½±å“',
                            'æå‡ºåˆ›æ–°æ€§è§£å†³æ–¹æ¡ˆ',
                            'è€ƒè™‘æ–¹æ¡ˆçš„å¯è¡Œæ€§å’Œæœ‰æ•ˆæ€§'
                        ],
                        keywords: ['æ°”å€™å˜åŒ–', 'æ¸©å®¤æ°”ä½“', 'å¯æŒç»­å‘å±•', 'æ–°èƒ½æº', 'ç¯å¢ƒä¿æŠ¤', 'å›½é™…åˆä½œ'],
                        difficulty: 'advanced',
                        timeLimit: 50,
                        wordLimit: 350,
                        examType: 'ielts'
                    },
                    {
                        id: 'essay_adv_004',
                        type: 'opinion',
                        title: 'è¿œç¨‹å·¥ä½œçš„æœªæ¥å‘å±•',
                        prompt: 'æ–°å† ç–«æƒ…åŠ é€Ÿäº†è¿œç¨‹å·¥ä½œæ¨¡å¼çš„æ™®åŠã€‚è¯·åˆ†æè¿œç¨‹å·¥ä½œæ¨¡å¼çš„ä¼˜åŠ¿å’ŒæŒ‘æˆ˜ï¼Œå¹¶é¢„æµ‹å…¶åœ¨åç–«æƒ…æ—¶ä»£çš„å‘å±•è¶‹åŠ¿ã€‚ä½ è®¤ä¸ºè¿œç¨‹å·¥ä½œä¼šæˆä¸ºæœªæ¥å·¥ä½œçš„ä¸»æµæ¨¡å¼å—ï¼Ÿ',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº300å­—',
                            'å…¨é¢åˆ†æè¿œç¨‹å·¥ä½œçš„åˆ©å¼Š',
                            'ç»“åˆå®é™…æ¡ˆä¾‹å’Œæ•°æ®',
                            'æå‡ºæœ‰è¯´æœåŠ›çš„ä¸ªäººè§‚ç‚¹',
                            'é¢„æµ‹æœªæ¥å‘å±•è¶‹åŠ¿'
                        ],
                        keywords: ['è¿œç¨‹å·¥ä½œ', 'å·¥ä½œæ•ˆç‡', 'å·¥ä½œç”Ÿæ´»å¹³è¡¡', 'æ•°å­—åŒ–è½¬å‹', 'ä¼ä¸šç®¡ç†', 'æœªæ¥è¶‹åŠ¿'],
                        difficulty: 'advanced',
                        timeLimit: 45,
                        wordLimit: 300,
                        examType: 'ielts'
                    }
                ]
            },
            letter: {
                beginner: [
                    {
                        id: 'letter_beg_001',
                        type: 'informal',
                        title: 'ç»™æœ‹å‹çš„ä¿¡ï¼šå‡æœŸè®¡åˆ’',
                        prompt: 'ä½ çš„æœ‹å‹è¯¢é—®ä½ çš„å‡æœŸè®¡åˆ’ã€‚è¯·å†™ä¸€å°éæ­£å¼çš„ä¿¡ï¼Œå‘Šè¯‰ä»–/å¥¹ä½ çš„å‡æœŸå®‰æ’å’Œæƒ³åšçš„äº‹æƒ…ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº120å­—',
                            'ä½¿ç”¨å‹å¥½çš„è¯­è°ƒ',
                            'æè¿°å…·ä½“çš„è®¡åˆ’',
                            'è¡¨è¾¾æœŸå¾…å¿ƒæƒ…'
                        ],
                        keywords: ['å‡æœŸè®¡åˆ’', 'æœ‹å‹', 'æ´»åŠ¨å®‰æ’', 'æœŸå¾…', 'åˆ†äº«'],
                        difficulty: 'beginner',
                        timeLimit: 20,
                        wordLimit: 120,
                        examType: 'general'
                    },
                    {
                        id: 'letter_beg_002',
                        type: 'informal',
                        title: 'æ„Ÿè°¢ä¿¡ï¼šå¸®åŠ©æ„Ÿè°¢',
                        prompt: 'ä½ çš„æœ‹å‹æœ€è¿‘å¸®åŠ©äº†ä½ ã€‚è¯·å†™ä¸€å°æ„Ÿè°¢ä¿¡ï¼Œè¡¨è¾¾ä½ çš„æ„Ÿæ¿€ä¹‹æƒ…ï¼Œå¹¶è¯´æ˜ä»–/å¥¹æ˜¯å¦‚ä½•å¸®åŠ©ä½ çš„ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº100å­—',
                            'çœŸè¯šè¡¨è¾¾æ„Ÿè°¢',
                            'å…·ä½“è¯´æ˜å¸®åŠ©å†…å®¹',
                            'è¯­è¨€ç®€å•æ¸©æš–'
                        ],
                        keywords: ['æ„Ÿè°¢', 'å¸®åŠ©', 'å‹è°Š', 'æ„Ÿæ¿€', 'æ”¯æŒ'],
                        difficulty: 'beginner',
                        timeLimit: 18,
                        wordLimit: 100,
                        examType: 'general'
                    }
                ],
                intermediate: [
                    {
                        id: 'letter_int_001',
                        type: 'formal',
                        title: 'æŠ•è¯‰ä¿¡ï¼šåœ¨çº¿è´­ç‰©é—®é¢˜',
                        prompt: 'ä½ åœ¨æŸåœ¨çº¿å•†åŸè´­ä¹°äº†ä¸€å°ç¬”è®°æœ¬ç”µè„‘ï¼Œä½†æ”¶åˆ°çš„å•†å“å­˜åœ¨è´¨é‡é—®é¢˜ã€‚è¯·å†™ä¸€å°æŠ•è¯‰ä¿¡ç»™å®¢æœéƒ¨é—¨ï¼Œè¯´æ˜é—®é¢˜å¹¶è¦æ±‚è§£å†³ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº150å­—',
                            'ä½¿ç”¨æ­£å¼çš„ä¹¦ä¿¡æ ¼å¼',
                            'æ¸…æ¥šæè¿°é—®é¢˜',
                            'æå‡ºåˆç†çš„è§£å†³è¦æ±‚',
                            'è¯­è°ƒç¤¼è²Œä½†åšå®š'
                        ],
                        keywords: ['æŠ•è¯‰', 'äº§å“è´¨é‡', 'é€€æ¢è´§', 'å®¢æœ', 'è§£å†³æ–¹æ¡ˆ'],
                        difficulty: 'intermediate',
                        timeLimit: 20,
                        wordLimit: 150,
                        examType: 'ielts'
                    },
                    {
                        id: 'letter_int_002',
                        type: 'informal',
                        title: 'é‚€è¯·ä¿¡ï¼šç”Ÿæ—¥èšä¼š',
                        prompt: 'ä½ å°†ä¸¾åŠç”Ÿæ—¥èšä¼šï¼Œæƒ³é‚€è¯·ä½ çš„å¤–å›½æœ‹å‹å‚åŠ ã€‚è¯·å†™ä¸€å°éæ­£å¼çš„é‚€è¯·ä¿¡ï¼ŒåŒ…å«èšä¼šçš„è¯¦ç»†ä¿¡æ¯ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº150å­—',
                            'ä½¿ç”¨å‹å¥½ã€è½»æ¾çš„è¯­è°ƒ',
                            'åŒ…å«æ—¶é—´ã€åœ°ç‚¹ã€æ´»åŠ¨å®‰æ’',
                            'è¡¨è¾¾æœŸå¾…æœ‹å‹å‚åŠ çš„å¿ƒæƒ…'
                        ],
                        keywords: ['ç”Ÿæ—¥èšä¼š', 'é‚€è¯·', 'æœ‹å‹', 'åº†ç¥', 'æ´»åŠ¨å®‰æ’'],
                        difficulty: 'intermediate',
                        timeLimit: 20,
                        wordLimit: 150,
                        examType: 'ielts'
                    },
                    {
                        id: 'letter_int_003',
                        type: 'formal',
                        title: 'ç”³è¯·ä¿¡ï¼šå¥–å­¦é‡‘ç”³è¯·',
                        prompt: 'ä½ æƒ³ç”³è¯·æŸå¤§å­¦çš„å¥–å­¦é‡‘é¡¹ç›®ã€‚è¯·å†™ä¸€å°æ­£å¼çš„ç”³è¯·ä¿¡ï¼Œè¯´æ˜ä½ çš„å­¦æœ¯èƒŒæ™¯ã€ç”³è¯·ç†ç”±å’Œæœªæ¥è®¡åˆ’ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº180å­—',
                            'ä½¿ç”¨æ­£å¼çš„ä¹¦ä¿¡æ ¼å¼å’Œè¯­è¨€',
                            'çªå‡ºä¸ªäººä¼˜åŠ¿å’Œæˆå°±',
                            'è¯´æ˜ç”³è¯·åŠ¨æœºå’Œæœªæ¥è§„åˆ’',
                            'è¯­è°ƒä¸“ä¸šä¸”æœ‰è¯´æœåŠ›'
                        ],
                        keywords: ['å¥–å­¦é‡‘ç”³è¯·', 'å­¦æœ¯èƒŒæ™¯', 'ä¸ªäººæˆå°±', 'æœªæ¥è§„åˆ’', 'ç”³è¯·ç†ç”±'],
                        difficulty: 'intermediate',
                        timeLimit: 25,
                        wordLimit: 180,
                        examType: 'ielts'
                    },
                    {
                        id: 'letter_int_004',
                        type: 'informal',
                        title: 'å»ºè®®ä¿¡ï¼šæ—…è¡Œå»ºè®®',
                        prompt: 'ä½ çš„æœ‹å‹è®¡åˆ’æ¥ä½ æ‰€åœ¨çš„åŸå¸‚æ—…æ¸¸ï¼Œå‘ä½ è¯¢é—®æ—…è¡Œå»ºè®®ã€‚è¯·å†™ä¸€å°ä¿¡ç»™ä»–/å¥¹ï¼Œæ¨èä¸€äº›å€¼å¾—æ¸¸è§ˆçš„åœ°æ–¹å’Œæ³¨æ„äº‹é¡¹ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº160å­—',
                            'æ¨èå…·ä½“çš„æ™¯ç‚¹å’Œæ´»åŠ¨',
                            'æä¾›å®ç”¨çš„æ—…è¡Œå»ºè®®',
                            'ä½¿ç”¨å‹å¥½ã€çƒ­æƒ…çš„è¯­è°ƒ',
                            'ç»“æ„æ¸…æ™°ï¼Œä¿¡æ¯å®Œæ•´'
                        ],
                        keywords: ['æ—…è¡Œå»ºè®®', 'æ™¯ç‚¹æ¨è', 'æ—…æ¸¸æ”»ç•¥', 'æ³¨æ„äº‹é¡¹', 'åŸå¸‚ä»‹ç»'],
                        difficulty: 'intermediate',
                        timeLimit: 22,
                        wordLimit: 160,
                        examType: 'ielts'
                    }
                ],
                advanced: [
                    {
                        id: 'letter_adv_001',
                        type: 'formal',
                        title: 'æ±‚èŒä¿¡ï¼šè·¨å›½å…¬å¸èŒä½ç”³è¯·',
                        prompt: 'ä½ çœ‹åˆ°ä¸€å®¶è·¨å›½å…¬å¸æ‹›è˜é¡¹ç›®ç»ç†çš„èŒä½å¹¿å‘Šï¼Œè¯¥èŒä½è¦æ±‚æœ‰ç›¸å…³ç»éªŒå’Œè¯­è¨€èƒ½åŠ›ã€‚è¯·å†™ä¸€å°æ±‚èŒä¿¡ï¼Œå±•ç¤ºä½ çš„èµ„æ ¼å’Œé€‚åˆè¯¥èŒä½çš„ç†ç”±ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº220å­—',
                            'å±•ç°ä¸“ä¸šçš„å•†åŠ¡å†™ä½œæŠ€èƒ½',
                            'çªå‡ºç›¸å…³å·¥ä½œç»éªŒå’ŒæŠ€èƒ½',
                            'ä½“ç°å¯¹å…¬å¸å’ŒèŒä½çš„äº†è§£',
                            'ä½¿ç”¨é«˜çº§è¯æ±‡å’Œå¤æ‚å¥å¼',
                            'ç»“æ„ä¸¥è°¨ï¼Œé€»è¾‘æ¸…æ™°'
                        ],
                        keywords: ['æ±‚èŒä¿¡', 'é¡¹ç›®ç»ç†', 'å·¥ä½œç»éªŒ', 'ä¸“ä¸šæŠ€èƒ½', 'è·¨å›½å…¬å¸', 'èŒä¸šå‘å±•'],
                        difficulty: 'advanced',
                        timeLimit: 30,
                        wordLimit: 220,
                        examType: 'ielts'
                    },
                    {
                        id: 'letter_adv_002',
                        type: 'formal',
                        title: 'å»ºè®®ä¿¡ï¼šæ”¿ç­–å»ºè®®',
                        prompt: 'ä½œä¸ºä¸€åå…³å¿ƒç¯å¢ƒä¿æŠ¤çš„å…¬æ°‘ï¼Œä½ æƒ³å‘å½“åœ°æ”¿åºœæå‡ºå…³äºå‡å°‘åŸå¸‚æ±¡æŸ“çš„å»ºè®®ã€‚è¯·å†™ä¸€å°æ­£å¼çš„å»ºè®®ä¿¡ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº250å­—',
                            'åˆ†æå½“å‰ç¯å¢ƒé—®é¢˜',
                            'æå‡ºå…·ä½“å¯è¡Œçš„å»ºè®®',
                            'ä½¿ç”¨æ­£å¼ã€ç¤¼è²Œçš„è¯­è°ƒ',
                            'è®ºè¯å……åˆ†ï¼Œæœ‰è¯´æœåŠ›',
                            'ä½“ç°å…¬æ°‘è´£ä»»æ„Ÿ'
                        ],
                        keywords: ['ç¯å¢ƒä¿æŠ¤', 'æ”¿ç­–å»ºè®®', 'åŸå¸‚æ±¡æŸ“', 'å¯æŒç»­å‘å±•', 'å…¬æ°‘å‚ä¸', 'æ”¿åºœæ”¿ç­–'],
                        difficulty: 'advanced',
                        timeLimit: 35,
                        wordLimit: 250,
                        examType: 'ielts'
                    }
                ]
            },
            report: {
                beginner: [
                    {
                        id: 'report_beg_001',
                        type: 'simple',
                        title: 'ç­çº§æ´»åŠ¨æ€»ç»“',
                        prompt: 'è¯·å†™ä¸€ä»½å…³äºä¸Šä¸ªæœˆç­çº§ç»„ç»‡çš„éƒŠæ¸¸æ´»åŠ¨çš„ç®€å•æ€»ç»“æŠ¥å‘Šï¼ŒåŒ…æ‹¬æ´»åŠ¨å†…å®¹ã€å‚ä¸äººæ•°å’Œå¤§å®¶çš„åé¦ˆã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº120å­—',
                            'ä½¿ç”¨ç®€å•çš„æŠ¥å‘Šæ ¼å¼',
                            'åŒ…å«åŸºæœ¬ä¿¡æ¯',
                            'è¯­è¨€æ¸…æ™°ç®€æ´'
                        ],
                        keywords: ['æ´»åŠ¨æ€»ç»“', 'ç­çº§éƒŠæ¸¸', 'å‚ä¸æƒ…å†µ', 'åé¦ˆ', 'æŠ¥å‘Š'],
                        difficulty: 'beginner',
                        timeLimit: 20,
                        wordLimit: 120,
                        examType: 'general'
                    },
                    {
                        id: 'report_beg_002',
                        type: 'observation',
                        title: 'å›¾ä¹¦é¦†ä½¿ç”¨æƒ…å†µè§‚å¯Ÿ',
                        prompt: 'ä½ è§‚å¯Ÿäº†å­¦æ ¡å›¾ä¹¦é¦†ä¸€å‘¨çš„ä½¿ç”¨æƒ…å†µã€‚è¯·å†™ä¸€ä»½ç®€å•çš„è§‚å¯ŸæŠ¥å‘Šï¼Œæè¿°ä½ çœ‹åˆ°çš„æƒ…å†µã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº130å­—',
                            'å®¢è§‚æè¿°è§‚å¯Ÿç»“æœ',
                            'ä½¿ç”¨ç®€å•çš„æ•°æ®',
                            'ç»“æ„æ¸…æ™°'
                        ],
                        keywords: ['è§‚å¯ŸæŠ¥å‘Š', 'å›¾ä¹¦é¦†', 'ä½¿ç”¨æƒ…å†µ', 'å­¦ä¹ ç¯å¢ƒ', 'ç»Ÿè®¡'],
                        difficulty: 'beginner',
                        timeLimit: 22,
                        wordLimit: 130,
                        examType: 'general'
                    }
                ],
                intermediate: [
                    {
                        id: 'report_int_001',
                        type: 'survey',
                        title: 'å­¦ç”Ÿè¯¾å¤–æ´»åŠ¨è°ƒæŸ¥æŠ¥å‘Š',
                        prompt: 'è¯·æ ¹æ®ä»¥ä¸‹æ•°æ®å†™ä¸€ä»½å…³äºå­¦ç”Ÿè¯¾å¤–æ´»åŠ¨å‚ä¸æƒ…å†µçš„è°ƒæŸ¥æŠ¥å‘Šã€‚æ•°æ®æ˜¾ç¤ºï¼šä½“è‚²æ´»åŠ¨60%ï¼Œè‰ºæœ¯æ´»åŠ¨25%ï¼Œå­¦æœ¯ç«èµ›15%ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº150å­—',
                            'å®¢è§‚æè¿°æ•°æ®',
                            'åˆ†æè¶‹åŠ¿å’ŒåŸå› ',
                            'ä½¿ç”¨æ­£å¼çš„æŠ¥å‘Šæ ¼å¼',
                            'æä¾›ç»“è®ºå’Œå»ºè®®'
                        ],
                        keywords: ['è°ƒæŸ¥æŠ¥å‘Š', 'æ•°æ®åˆ†æ', 'è¯¾å¤–æ´»åŠ¨', 'è¶‹åŠ¿', 'ç»“è®º'],
                        difficulty: 'intermediate',
                        timeLimit: 20,
                        wordLimit: 150,
                        examType: 'ielts'
                    },
                    {
                        id: 'report_int_002',
                        type: 'comparison',
                        title: 'åŸå¸‚äº¤é€šæ–¹å¼å¯¹æ¯”æŠ¥å‘Š',
                        prompt: 'æ ¹æ®æä¾›çš„æ•°æ®ï¼Œå†™ä¸€ä»½å…³äºä¸åŒåŸå¸‚äº¤é€šæ–¹å¼ä½¿ç”¨æƒ…å†µçš„å¯¹æ¯”æŠ¥å‘Šã€‚æ•°æ®åŒ…æ‹¬ï¼šç§å®¶è½¦45%ï¼Œå…¬å…±äº¤é€š30%ï¼Œè‡ªè¡Œè½¦15%ï¼Œæ­¥è¡Œ10%ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº170å­—',
                            'æ¸…æ™°å‘ˆç°æ•°æ®å¯¹æ¯”',
                            'åˆ†æå„ç§äº¤é€šæ–¹å¼çš„ç‰¹ç‚¹',
                            'ä½¿ç”¨é€‚å½“çš„è¿æ¥è¯',
                            'æ€»ç»“ä¸»è¦å‘ç°'
                        ],
                        keywords: ['å¯¹æ¯”æŠ¥å‘Š', 'äº¤é€šæ–¹å¼', 'æ•°æ®å¯¹æ¯”', 'åŸå¸‚äº¤é€š', 'ç»Ÿè®¡åˆ†æ'],
                        difficulty: 'intermediate',
                        timeLimit: 25,
                        wordLimit: 170,
                        examType: 'ielts'
                    },
                    {
                        id: 'report_int_003',
                        type: 'process',
                        title: 'é¡¹ç›®å®æ–½è¿‡ç¨‹æŠ¥å‘Š',
                        prompt: 'ä½ å‚ä¸äº†ä¸€ä¸ªç¤¾åŒºç¯ä¿é¡¹ç›®çš„å®æ–½ã€‚è¯·å†™ä¸€ä»½è¿‡ç¨‹æŠ¥å‘Šï¼Œæè¿°é¡¹ç›®çš„å„ä¸ªé˜¶æ®µã€é‡åˆ°çš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº180å­—',
                            'æŒ‰æ—¶é—´é¡ºåºæè¿°è¿‡ç¨‹',
                            'è¯¦ç»†è¯´æ˜å„ä¸ªé˜¶æ®µ',
                            'åˆ†æé—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ',
                            'è¯„ä¼°é¡¹ç›®æ•ˆæœ'
                        ],
                        keywords: ['è¿‡ç¨‹æŠ¥å‘Š', 'é¡¹ç›®å®æ–½', 'ç¯ä¿é¡¹ç›®', 'é—®é¢˜è§£å†³', 'æ•ˆæœè¯„ä¼°'],
                        difficulty: 'intermediate',
                        timeLimit: 25,
                        wordLimit: 180,
                        examType: 'ielts'
                    }
                ],
                advanced: [
                    {
                        id: 'report_adv_001',
                        type: 'research',
                        title: 'æ•°å­—åŒ–å­¦ä¹ æ•ˆæœç ”ç©¶æŠ¥å‘Š',
                        prompt: 'åŸºäºç›¸å…³ç ”ç©¶æ•°æ®ï¼Œæ’°å†™ä¸€ä»½å…³äºæ•°å­—åŒ–å­¦ä¹ å·¥å…·å¯¹å­¦ç”Ÿå­¦ä¹ æ•ˆæœå½±å“çš„ç ”ç©¶æŠ¥å‘Šã€‚éœ€è¦åˆ†æä¸åŒå¹´é¾„æ®µå­¦ç”Ÿçš„é€‚åº”æƒ…å†µå’Œå­¦ä¹ æˆæœã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº280å­—',
                            'å±•ç°æ·±å…¥çš„æ•°æ®åˆ†æèƒ½åŠ›',
                            'ä½¿ç”¨å­¦æœ¯å†™ä½œé£æ ¼',
                            'æä¾›è¯¦ç»†çš„ç ”ç©¶å‘ç°',
                            'å¾—å‡ºæœ‰ä»·å€¼çš„ç»“è®º',
                            'å»ºè®®è¿›ä¸€æ­¥ç ”ç©¶æ–¹å‘'
                        ],
                        keywords: ['ç ”ç©¶æŠ¥å‘Š', 'æ•°å­—åŒ–å­¦ä¹ ', 'å­¦ä¹ æ•ˆæœ', 'æ•°æ®åˆ†æ', 'å­¦æœ¯ç ”ç©¶', 'æ•™è‚²æŠ€æœ¯'],
                        difficulty: 'advanced',
                        timeLimit: 40,
                        wordLimit: 280,
                        examType: 'ielts'
                    },
                    {
                        id: 'report_adv_002',
                        type: 'business',
                        title: 'å¸‚åœºåˆ†ææŠ¥å‘Š',
                        prompt: 'ä½œä¸ºå¸‚åœºåˆ†æå¸ˆï¼Œè¯·æ’°å†™ä¸€ä»½å…³äºæ–°å…´ç§‘æŠ€äº§å“å¸‚åœºå‰æ™¯çš„åˆ†ææŠ¥å‘Šã€‚éœ€è¦åŒ…æ‹¬å¸‚åœºè§„æ¨¡ã€ç«äº‰æ€åŠ¿ã€å‘å±•è¶‹åŠ¿ç­‰å†…å®¹ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº320å­—',
                            'å±•ç°ä¸“ä¸šçš„å•†ä¸šåˆ†æèƒ½åŠ›',
                            'ä½¿ç”¨å•†åŠ¡æŠ¥å‘Šæ ¼å¼',
                            'æä¾›å…·ä½“çš„å¸‚åœºæ•°æ®',
                            'åˆ†æç«äº‰ä¼˜åŠ¿å’Œé£é™©',
                            'æå‡ºæˆ˜ç•¥å»ºè®®'
                        ],
                        keywords: ['å¸‚åœºåˆ†æ', 'ç§‘æŠ€äº§å“', 'ç«äº‰æ€åŠ¿', 'å‘å±•è¶‹åŠ¿', 'å•†ä¸šæŠ¥å‘Š', 'æˆ˜ç•¥å»ºè®®'],
                        difficulty: 'advanced',
                        timeLimit: 45,
                        wordLimit: 320,
                        examType: 'business'
                    }
                ]
            },
            email: {
                beginner: [
                    {
                        id: 'email_beg_001',
                        type: 'personal',
                        title: 'ä¸ªäººé‚®ä»¶ï¼šè¯¾ç¨‹å’¨è¯¢',
                        prompt: 'ä½ æƒ³äº†è§£æŸä¸ªåŸ¹è®­è¯¾ç¨‹çš„è¯¦ç»†ä¿¡æ¯ã€‚è¯·å†™ä¸€å°é‚®ä»¶ç»™åŸ¹è®­æœºæ„ï¼Œè¯¢é—®è¯¾ç¨‹å†…å®¹ã€æ—¶é—´å®‰æ’å’Œè´¹ç”¨ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº100å­—',
                            'ä½¿ç”¨ç¤¼è²Œçš„è¯¢é—®è¯­è¨€',
                            'æå‡ºå…·ä½“é—®é¢˜',
                            'æ ¼å¼ç®€å•æ­£ç¡®'
                        ],
                        keywords: ['è¯¾ç¨‹å’¨è¯¢', 'åŸ¹è®­', 'æ—¶é—´å®‰æ’', 'è´¹ç”¨', 'è¯¢é—®'],
                        difficulty: 'beginner',
                        timeLimit: 15,
                        wordLimit: 100,
                        examType: 'general'
                    },
                    {
                        id: 'email_beg_002',
                        type: 'appointment',
                        title: 'é¢„çº¦é‚®ä»¶ï¼šåŒ»ç”Ÿé¢„çº¦',
                        prompt: 'ä½ éœ€è¦é¢„çº¦çœ‹åŒ»ç”Ÿã€‚è¯·å†™ä¸€å°é‚®ä»¶ç»™è¯Šæ‰€ï¼Œè¯´æ˜ä½ çš„æƒ…å†µå¹¶è¯·æ±‚é¢„çº¦æ—¶é—´ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº110å­—',
                            'è¯´æ˜é¢„çº¦åŸå› ',
                            'æå‡ºæ—¶é—´åå¥½',
                            'è¯­è°ƒç¤¼è²Œä¸“ä¸š'
                        ],
                        keywords: ['åŒ»ç”Ÿé¢„çº¦', 'è¯Šæ‰€', 'æ—¶é—´å®‰æ’', 'å¥åº·', 'é¢„çº¦'],
                        difficulty: 'beginner',
                        timeLimit: 16,
                        wordLimit: 110,
                        examType: 'general'
                    }
                ],
                intermediate: [
                    {
                        id: 'email_int_001',
                        type: 'business',
                        title: 'å•†åŠ¡é‚®ä»¶ï¼šä¼šè®®å®‰æ’',
                        prompt: 'ä½ éœ€è¦ç»™å›¢é˜Ÿæˆå‘˜å‘é€ä¸€å°é‚®ä»¶ï¼Œå®‰æ’ä¸‹å‘¨çš„é¡¹ç›®è®¨è®ºä¼šè®®ã€‚è¯·åŒ…å«ä¼šè®®ç›®çš„ã€æ—¶é—´ã€åœ°ç‚¹å’Œè®®ç¨‹ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº120å­—',
                            'ä½¿ç”¨ä¸“ä¸šçš„å•†åŠ¡è¯­è¨€',
                            'ä¿¡æ¯å®Œæ•´å‡†ç¡®',
                            'ç»“æ„æ¸…æ™°',
                            'è¯­è°ƒæ­£å¼ç¤¼è²Œ'
                        ],
                        keywords: ['å•†åŠ¡é‚®ä»¶', 'ä¼šè®®å®‰æ’', 'è®®ç¨‹', 'å›¢é˜Ÿæ²Ÿé€š', 'é¡¹ç›®è®¨è®º'],
                        difficulty: 'intermediate',
                        timeLimit: 15,
                        wordLimit: 120,
                        examType: 'business'
                    },
                    {
                        id: 'email_int_002',
                        type: 'inquiry',
                        title: 'è¯¢é—®é‚®ä»¶ï¼šäº§å“å’¨è¯¢',
                        prompt: 'ä½ å¯¹æŸå…¬å¸çš„æ–°äº§å“æ„Ÿå…´è¶£ï¼Œæƒ³äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚è¯·å†™ä¸€å°è¯¢é—®é‚®ä»¶ï¼ŒåŒ…æ‹¬ä½ çš„éœ€æ±‚å’Œå…·ä½“é—®é¢˜ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº140å­—',
                            'æ¸…æ¥šè¡¨è¾¾è¯¢é—®ç›®çš„',
                            'æå‡ºå…·ä½“é—®é¢˜',
                            'ä½¿ç”¨ç¤¼è²Œçš„è¯¢é—®è¯­è¨€',
                            'æä¾›å¿…è¦çš„èƒŒæ™¯ä¿¡æ¯'
                        ],
                        keywords: ['è¯¢é—®é‚®ä»¶', 'äº§å“å’¨è¯¢', 'éœ€æ±‚è¯´æ˜', 'ä¿¡æ¯è·å–', 'å•†åŠ¡æ²Ÿé€š'],
                        difficulty: 'intermediate',
                        timeLimit: 18,
                        wordLimit: 140,
                        examType: 'business'
                    },
                    {
                        id: 'email_int_003',
                        type: 'notification',
                        title: 'é€šçŸ¥é‚®ä»¶ï¼šæ´»åŠ¨å˜æ›´',
                        prompt: 'ç”±äºå¤©æ°”åŸå› ï¼ŒåŸå®šçš„æˆ·å¤–å›¢å»ºæ´»åŠ¨éœ€è¦æ”¹æœŸã€‚è¯·å†™ä¸€å°é‚®ä»¶é€šçŸ¥æ‰€æœ‰å‚ä¸è€…ï¼Œè¯´æ˜å˜æ›´æƒ…å†µå’Œæ–°çš„å®‰æ’ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº130å­—',
                            'æ¸…æ¥šè¯´æ˜å˜æ›´åŸå› ',
                            'æä¾›æ–°çš„æ—¶é—´å®‰æ’',
                            'è¡¨è¾¾æ­‰æ„',
                            'è¯­è°ƒå‹å¥½ä¸”ä¸“ä¸š'
                        ],
                        keywords: ['é€šçŸ¥é‚®ä»¶', 'æ´»åŠ¨å˜æ›´', 'æ—¶é—´è°ƒæ•´', 'å›¢å»ºæ´»åŠ¨', 'æ²Ÿé€šåè°ƒ'],
                        difficulty: 'intermediate',
                        timeLimit: 16,
                        wordLimit: 130,
                        examType: 'business'
                    }
                ],
                advanced: [
                    {
                        id: 'email_adv_001',
                        type: 'proposal',
                        title: 'ææ¡ˆé‚®ä»¶ï¼šæ–°é¡¹ç›®å»ºè®®',
                        prompt: 'ä½ æœ‰ä¸€ä¸ªåˆ›æ–°çš„é¡¹ç›®æƒ³æ³•ï¼Œæƒ³å‘å…¬å¸é«˜å±‚æå‡ºå»ºè®®ã€‚è¯·å†™ä¸€å°ææ¡ˆé‚®ä»¶ï¼Œè¯¦ç»†è¯´æ˜é¡¹ç›®æ¦‚å¿µã€é¢„æœŸæ”¶ç›Šå’Œå®æ–½è®¡åˆ’ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº250å­—',
                            'å±•ç°ä¸“ä¸šçš„å•†åŠ¡å†™ä½œèƒ½åŠ›',
                            'é€»è¾‘æ¸…æ™°åœ°é˜è¿°ææ¡ˆ',
                            'æä¾›å…·ä½“çš„æ•°æ®æ”¯æŒ',
                            'ä½¿ç”¨è¯´æœæ€§è¯­è¨€',
                            'ç»“æ„ä¸¥è°¨ï¼Œé‡ç‚¹çªå‡º'
                        ],
                        keywords: ['ææ¡ˆé‚®ä»¶', 'é¡¹ç›®å»ºè®®', 'å•†ä¸šè®¡åˆ’', 'åˆ›æ–°æƒ³æ³•', 'é«˜å±‚æ²Ÿé€š', 'æˆ˜ç•¥è§„åˆ’'],
                        difficulty: 'advanced',
                        timeLimit: 35,
                        wordLimit: 250,
                        examType: 'business'
                    },
                    {
                        id: 'email_adv_002',
                        type: 'negotiation',
                        title: 'è°ˆåˆ¤é‚®ä»¶ï¼šåˆä½œåè®®',
                        prompt: 'ä½ ä»£è¡¨å…¬å¸ä¸æ½œåœ¨åˆä½œä¼™ä¼´è¿›è¡Œå•†åŠ¡è°ˆåˆ¤ã€‚è¯·å†™ä¸€å°é‚®ä»¶ï¼Œæå‡ºåˆä½œæ¡ä»¶å¹¶å°è¯•è¾¾æˆäº’åˆ©çš„åè®®ã€‚',
                        requirements: [
                            'å†™ä½œå­—æ•°ï¼šä¸å°‘äº280å­—',
                            'å±•ç°é«˜çº§çš„è°ˆåˆ¤æŠ€å·§',
                            'å¹³è¡¡åŒæ–¹åˆ©ç›Š',
                            'ä½¿ç”¨å¤–äº¤æ€§è¯­è¨€',
                            'æå‡ºå…·ä½“çš„åˆä½œæ¡æ¬¾',
                            'ä¿æŒä¸“ä¸šå’Œçµæ´»æ€§'
                        ],
                        keywords: ['è°ˆåˆ¤é‚®ä»¶', 'åˆä½œåè®®', 'å•†åŠ¡è°ˆåˆ¤', 'åˆä½œæ¡ä»¶', 'äº’åˆ©å…±èµ¢', 'å•†ä¸šåˆä½œ'],
                        difficulty: 'advanced',
                        timeLimit: 40,
                        wordLimit: 280,
                        examType: 'business'
                    }
                ]
            }
        };
        
        console.log('ğŸ“ å†™ä½œé¢˜ç›®æ•°æ®åº“å·²åˆå§‹åŒ–');
        
        // åˆå§‹åŒ–å†™ä½œæ¨¡æ¿æ•°æ®åº“
        this.initializeTemplatesDatabase();
    }

    /**
     * åˆå§‹åŒ–å†™ä½œæ¨¡æ¿æ•°æ®åº“
     */
    initializeTemplatesDatabase() {
        this.templatesDatabase = {
            essay: {
                argumentative: {
                    title: 'è®®è®ºæ–‡æ¨¡æ¿',
                    structure: [
                        'å¼•è¨€æ®µï¼šæå‡ºè¯é¢˜ï¼Œè¡¨æ˜ç«‹åœº',
                        'ä¸»ä½“æ®µ1ï¼šç¬¬ä¸€ä¸ªè®ºç‚¹åŠæ”¯æ’‘è®ºæ®',
                        'ä¸»ä½“æ®µ2ï¼šç¬¬äºŒä¸ªè®ºç‚¹åŠæ”¯æ’‘è®ºæ®', 
                        'ä¸»ä½“æ®µ3ï¼šåé©³å¯¹ç«‹è§‚ç‚¹ï¼ˆå¯é€‰ï¼‰',
                        'ç»“è®ºæ®µï¼šæ€»ç»“è§‚ç‚¹ï¼Œé‡ç”³ç«‹åœº'
                    ],
                    template: `ç¬¬ä¸€æ®µï¼šå¼•è¨€æ®µ
- èƒŒæ™¯ä»‹ç»ï¼šç®€è¦ä»‹ç»è¯é¢˜èƒŒæ™¯
- è§‚ç‚¹è¡¨è¿°ï¼šæ˜ç¡®è¡¨è¾¾ä½ çš„ç«‹åœº
- æ–‡ç« æ¦‚è§ˆï¼šç®€è¿°å°†è¦è®¨è®ºçš„è¦ç‚¹

ç¬¬äºŒæ®µï¼šä¸»ä½“æ®µè½1
- ä¸»é¢˜å¥ï¼šæå‡ºç¬¬ä¸€ä¸ªè®ºç‚¹
- è§£é‡Šè¯´æ˜ï¼šè¯¦ç»†é˜è¿°è¿™ä¸ªè®ºç‚¹
- å…·ä½“ä¾‹è¯ï¼šæä¾›æ”¯æŒæ€§ä¾‹å­æˆ–æ•°æ®
- å°ç»“ï¼šæ€»ç»“æœ¬æ®µè¦ç‚¹

ç¬¬ä¸‰æ®µï¼šä¸»ä½“æ®µè½2
- ä¸»é¢˜å¥ï¼šæå‡ºç¬¬äºŒä¸ªè®ºç‚¹
- è§£é‡Šè¯´æ˜ï¼šè¯¦ç»†é˜è¿°è¿™ä¸ªè®ºç‚¹
- å…·ä½“ä¾‹è¯ï¼šæä¾›æ”¯æŒæ€§ä¾‹å­æˆ–æ•°æ®
- å°ç»“ï¼šæ€»ç»“æœ¬æ®µè¦ç‚¹

ç¬¬å››æ®µï¼šç»“è®ºæ®µ
- é‡ç”³è§‚ç‚¹ï¼šé‡æ–°è¡¨è¿°ä½ çš„ç«‹åœº
- æ€»ç»“è¦ç‚¹ï¼šæ¦‚æ‹¬ä¸»è¦è®ºç‚¹
- ç»“æŸè¯­ï¼šç»™å‡ºæœ€ç»ˆæ€è€ƒæˆ–å‘¼å`,
                    phrases: [
                        'å¼•è¨€å¸¸ç”¨è¡¨è¾¾ï¼š',
                        '- It is widely believed that...',
                        '- There is a growing concern about...',
                        '- In recent years, there has been...',
                        '',
                        'è¡¨è¾¾è§‚ç‚¹ï¼š',
                        '- I strongly believe that...',
                        '- From my perspective...',
                        '- It is my view that...',
                        '',
                        'ä¸¾ä¾‹è¯´æ˜ï¼š',
                        '- For example...',
                        '- To illustrate this point...',
                        '- A case in point is...',
                        '',
                        'æ€»ç»“è¡¨è¾¾ï¼š',
                        '- In conclusion...',
                        '- To sum up...',
                        '- All things considered...'
                    ]
                },
                opinion: {
                    title: 'è§‚ç‚¹æ–‡æ¨¡æ¿',
                    structure: [
                        'å¼€å¤´æ®µï¼šä»‹ç»è¯é¢˜ï¼Œè¡¨è¾¾ä¸ªäººè§‚ç‚¹',
                        'ä¸»ä½“æ®µï¼šè¯¦ç»†é˜è¿°è§‚ç‚¹ï¼Œæä¾›ç†ç”±',
                        'ç»“å°¾æ®µï¼šæ€»ç»“è§‚ç‚¹ï¼Œç»™å‡ºå»ºè®®'
                    ],
                    template: `ç¬¬ä¸€æ®µï¼šå¼€å¤´æ®µ
- è¯é¢˜å¼•å…¥ï¼šç”¨ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜æˆ–äº‹å®å¼€å§‹
- ä¸ªäººè§‚ç‚¹ï¼šæ¸…æ¥šè¡¨è¾¾ä½ çš„çœ‹æ³•
- é¢„å‘Šç»“æ„ï¼šç®€è¿°æ–‡ç« çš„ç»„ç»‡æ–¹å¼

ç¬¬äºŒæ®µï¼šä¸»ä½“æ®µ
- ç†ç”±1ï¼šæå‡ºæ”¯æŒè§‚ç‚¹çš„ç¬¬ä¸€ä¸ªç†ç”±
- å…·ä½“è¯´æ˜ï¼šè¯¦ç»†è§£é‡Šè¿™ä¸ªç†ç”±
- ç†ç”±2ï¼šæå‡ºæ”¯æŒè§‚ç‚¹çš„ç¬¬äºŒä¸ªç†ç”±
- å…·ä½“è¯´æ˜ï¼šè¯¦ç»†è§£é‡Šè¿™ä¸ªç†ç”±

ç¬¬ä¸‰æ®µï¼šç»“å°¾æ®µ
- è§‚ç‚¹é‡ç”³ï¼šé‡æ–°è¡¨è¿°ä½ çš„è§‚ç‚¹
- ä¸ªäººå»ºè®®ï¼šåŸºäºä½ çš„è§‚ç‚¹ç»™å‡ºå»ºè®®
- å±•æœ›æœªæ¥ï¼šå¯¹ç›¸å…³è¯é¢˜çš„æœªæ¥å‘å±•è¡¨è¾¾çœ‹æ³•`,
                    phrases: [
                        'è¡¨è¾¾è§‚ç‚¹ï¼š',
                        '- In my opinion...',
                        '- I believe that...',
                        '- From my point of view...',
                        '',
                        'æä¾›ç†ç”±ï¼š',
                        '- The main reason is...',
                        '- Another important factor is...',
                        '- What\'s more...',
                        '',
                        'ä¸ªäººç»å†ï¼š',
                        '- Based on my experience...',
                        '- I have found that...',
                        '- In my case...'
                    ]
                }
            },
            letter: {
                formal: {
                    title: 'æ­£å¼ä¹¦ä¿¡æ¨¡æ¿',
                    structure: [
                        'ä¿¡å¤´ï¼šå†™ä¿¡äººåœ°å€å’Œæ—¥æœŸ',
                        'æ”¶ä¿¡äººä¿¡æ¯ï¼šå§“åå’Œåœ°å€',
                        'ç§°å‘¼ï¼šæ­£å¼ç§°å‘¼',
                        'æ­£æ–‡ï¼šè¯´æ˜å†™ä¿¡ç›®çš„å’Œè¯¦ç»†å†…å®¹',
                        'ç»“å°¾ï¼šç¤¼è²Œç»“æŸè¯­',
                        'ç­¾åï¼šå†™ä¿¡äººå§“å'
                    ],
                    template: `[Your Address]
[City, State ZIP Code]
[Date]

[Recipient's Name]
[Title]
[Company/Organization]
[Address]
[City, State ZIP Code]

Dear [Mr./Ms. Last Name],

ç¬¬ä¸€æ®µï¼šå†™ä¿¡ç›®çš„
- ç®€æ´è¯´æ˜å†™ä¿¡çš„åŸå› 
- å¦‚æœæ˜¯å›å¤æ¥ä¿¡ï¼Œå¯ä»¥æåŠæ”¶åˆ°çš„ä¿¡ä»¶

ç¬¬äºŒæ®µï¼šè¯¦ç»†å†…å®¹
- è¯¦ç»†è¯´æ˜ç›¸å…³æƒ…å†µ
- æä¾›å¿…è¦çš„èƒŒæ™¯ä¿¡æ¯
- è¡¨è¾¾ä½ çš„éœ€æ±‚æˆ–è§‚ç‚¹

ç¬¬ä¸‰æ®µï¼šè¡ŒåŠ¨è¦æ±‚
- æ˜ç¡®è¯´æ˜ä½ å¸Œæœ›å¯¹æ–¹é‡‡å–çš„è¡ŒåŠ¨
- æä¾›æ—¶é—´æ¡†æ¶ï¼ˆå¦‚é€‚ç”¨ï¼‰
- è¡¨è¾¾åˆä½œæ„æ„¿

ç¬¬å››æ®µï¼šç»“å°¾
- æ„Ÿè°¢å¯¹æ–¹çš„æ—¶é—´å’Œè€ƒè™‘
- æœŸå¾…å›å¤
- æä¾›è”ç³»æ–¹å¼

Sincerely,
[Your Signature]
[Your Typed Name]`,
                    phrases: [
                        'å¼€å¤´è¡¨è¾¾ï¼š',
                        '- I am writing to...',
                        '- I would like to...',
                        '- I am writing in response to...',
                        '',
                        'è¯·æ±‚å¸®åŠ©ï¼š',
                        '- I would be grateful if...',
                        '- Could you please...',
                        '- I would appreciate it if...',
                        '',
                        'ç»“å°¾è¡¨è¾¾ï¼š',
                        '- Thank you for your consideration',
                        '- I look forward to hearing from you',
                        '- Please do not hesitate to contact me'
                    ]
                },
                informal: {
                    title: 'éæ­£å¼ä¹¦ä¿¡æ¨¡æ¿',
                    structure: [
                        'æ—¥æœŸ',
                        'äº²åˆ‡ç§°å‘¼',
                        'æ­£æ–‡ï¼šåˆ†äº«è¿‘å†µï¼Œè¡¨è¾¾å…³å¿ƒ',
                        'å‹å¥½ç»“å°¾',
                        'ç­¾å'
                    ],
                    template: `[Date]

Dear [Friend's Name],

ç¬¬ä¸€æ®µï¼šé—®å€™å’Œè¿‘å†µ
- å‹å¥½çš„é—®å€™
- è¯¢é—®å¯¹æ–¹è¿‘å†µ
- åˆ†äº«è‡ªå·±çš„è¿‘å†µ

ç¬¬äºŒæ®µï¼šä¸»è¦å†…å®¹
- è¯¦ç»†è¯´æ˜å†™ä¿¡çš„ä¸»è¦ç›®çš„
- åˆ†äº«æœ‰è¶£çš„ç»å†æˆ–æƒ³æ³•
- è¡¨è¾¾æƒ…æ„Ÿæˆ–å…³å¿ƒ

ç¬¬ä¸‰æ®µï¼šæœªæ¥è®¡åˆ’
- æåŠæœªæ¥çš„è®¡åˆ’æˆ–é‚€è¯·
- è¡¨è¾¾è§é¢çš„æ„¿æœ›
- è¯¢é—®å¯¹æ–¹çš„è®¡åˆ’

ç¬¬å››æ®µï¼šç»“å°¾
- å†æ¬¡è¡¨è¾¾å…³å¿ƒ
- æœŸå¾…å›ä¿¡
- å‹å¥½çš„ç»“æŸè¯­

Best wishes,
[Your Name]`,
                    phrases: [
                        'å‹å¥½å¼€å¤´ï¼š',
                        '- How are you doing?',
                        '- I hope you\'re well',
                        '- It\'s been a while since...',
                        '',
                        'åˆ†äº«ç»å†ï¼š',
                        '- Guess what happened...',
                        '- You won\'t believe...',
                        '- I wanted to tell you about...',
                        '',
                        'å‹å¥½ç»“å°¾ï¼š',
                        '- Hope to hear from you soon',
                        '- Take care',
                        '- Give my regards to...'
                    ]
                }
            },
            email: {
                business: {
                    title: 'å•†åŠ¡é‚®ä»¶æ¨¡æ¿',
                    structure: [
                        'ä¸»é¢˜è¡Œï¼šæ¸…æ™°ç®€æ´çš„ä¸»é¢˜',
                        'ç§°å‘¼ï¼šä¸“ä¸šç§°å‘¼',
                        'æ­£æ–‡ï¼šç›®çš„ã€è¯¦æƒ…ã€è¡ŒåŠ¨è¦æ±‚',
                        'ç»“å°¾ï¼šä¸“ä¸šç»“æŸè¯­',
                        'ç­¾åï¼šå®Œæ•´è”ç³»ä¿¡æ¯'
                    ],
                    template: `Subject: [Clear and Specific Subject Line]

Dear [Mr./Ms. Last Name],

ç¬¬ä¸€æ®µï¼šç›®çš„è¯´æ˜
- ç›´æ¥è¯´æ˜é‚®ä»¶ç›®çš„
- ç®€è¦ä»‹ç»èƒŒæ™¯ï¼ˆå¦‚éœ€è¦ï¼‰

ç¬¬äºŒæ®µï¼šè¯¦ç»†ä¿¡æ¯
- æä¾›å…·ä½“è¯¦æƒ…
- åŒ…å«ç›¸å…³æ•°æ®æˆ–äº‹å®
- è§£é‡Šé‡è¦æ€§æˆ–ç´§æ€¥æ€§

ç¬¬ä¸‰æ®µï¼šè¡ŒåŠ¨è¦æ±‚
- æ˜ç¡®è¯´æ˜éœ€è¦çš„è¡ŒåŠ¨
- æä¾›æˆªæ­¢æ—¥æœŸ
- è¯´æ˜ä¸‹ä¸€æ­¥å®‰æ’

Best regards,
[Your Full Name]
[Your Title]
[Company Name]
[Phone Number]
[Email Address]`,
                    phrases: [
                        'é‚®ä»¶å¼€å¤´ï¼š',
                        '- I am writing to inform you...',
                        '- I would like to discuss...',
                        '- Following our conversation...',
                        '',
                        'æä¾›ä¿¡æ¯ï¼š',
                        '- Please find attached...',
                        '- As requested...',
                        '- I am pleased to inform you...',
                        '',
                        'è¯·æ±‚è¡ŒåŠ¨ï¼š',
                        '- Please confirm...',
                        '- Could you please provide...',
                        '- I would appreciate your feedback...'
                    ]
                }
            },
            report: {
                survey: {
                    title: 'è°ƒæŸ¥æŠ¥å‘Šæ¨¡æ¿',
                    structure: [
                        'æ ‡é¢˜å’Œæ‘˜è¦',
                        'å¼•è¨€ï¼šè°ƒæŸ¥èƒŒæ™¯å’Œç›®çš„',
                        'æ–¹æ³•ï¼šè°ƒæŸ¥æ–¹æ³•å’Œæ ·æœ¬',
                        'ç»“æœï¼šæ•°æ®å‘ˆç°å’Œåˆ†æ',
                        'ç»“è®ºï¼šä¸»è¦å‘ç°å’Œå»ºè®®'
                    ],
                    template: `è°ƒæŸ¥æŠ¥å‘Šï¼š[Report Title]

æ‘˜è¦
- è°ƒæŸ¥ç›®çš„ç®€è¿°
- ä¸»è¦å‘ç°æ¦‚æ‹¬
- å…³é”®å»ºè®®æ€»ç»“

1. å¼•è¨€
- è°ƒæŸ¥èƒŒæ™¯ä»‹ç»
- è°ƒæŸ¥ç›®çš„è¯´æ˜
- è°ƒæŸ¥èŒƒå›´ç•Œå®š

2. è°ƒæŸ¥æ–¹æ³•
- è°ƒæŸ¥å¯¹è±¡æè¿°
- æ•°æ®æ”¶é›†æ–¹æ³•
- æ ·æœ¬è§„æ¨¡è¯´æ˜

3. è°ƒæŸ¥ç»“æœ
- æ•°æ®ç»Ÿè®¡å‘ˆç°
- å›¾è¡¨åˆ†æè¯´æ˜
- è¶‹åŠ¿å˜åŒ–æè¿°

4. ç»“è®ºä¸å»ºè®®
- ä¸»è¦å‘ç°æ€»ç»“
- é—®é¢˜åˆ†æè®¨è®º
- æ”¹è¿›å»ºè®®æå‡º`,
                    phrases: [
                        'æ•°æ®æè¿°ï¼š',
                        '- The survey shows that...',
                        '- According to the data...',
                        '- The results indicate...',
                        '',
                        'è¶‹åŠ¿åˆ†æï¼š',
                        '- There is a significant increase in...',
                        '- The trend shows...',
                        '- Compared to last year...',
                        '',
                        'ç»“è®ºè¡¨è¾¾ï¼š',
                        '- In conclusion...',
                        '- The findings suggest...',
                        '- It is recommended that...'
                    ]
                }
            }
        };
        
        // åˆå§‹åŒ–èŒƒæ–‡æ•°æ®åº“
        this.initializeSampleEssays();
        
        console.log('ğŸ“‹ å†™ä½œæ¨¡æ¿æ•°æ®åº“å·²åˆå§‹åŒ–');
    }

    /**
     * åˆå§‹åŒ–èŒƒæ–‡æ•°æ®åº“
     */
    initializeSampleEssays() {
        this.sampleEssays = {
            essay: {
                argumentative: [
                    {
                        title: 'åœ¨çº¿å­¦ä¹ vsä¼ ç»Ÿè¯¾å ‚æ•™å­¦',
                        prompt: 'æ¯”è¾ƒåœ¨çº¿å­¦ä¹ å’Œä¼ ç»Ÿè¯¾å ‚æ•™å­¦çš„ä¼˜ç¼ºç‚¹',
                        content: `Online Learning vs Traditional Classroom Education

In recent years, online learning has become increasingly popular, especially accelerated by the global pandemic. While some people argue that online learning is the future of education, others believe that traditional classroom teaching remains more effective. This essay will examine both approaches and argue that a blended model combining both methods offers the best educational experience.

Online learning offers several significant advantages. First, it provides unprecedented flexibility, allowing students to learn at their own pace and schedule. Working professionals and parents can pursue education without sacrificing their other responsibilities. Second, online learning eliminates geographical barriers, giving students access to courses and instructors from around the world. Third, it is often more cost-effective, reducing expenses related to transportation, accommodation, and physical materials.

However, traditional classroom education also has distinct benefits. Face-to-face interaction between teachers and students facilitates immediate feedback and clarification of complex concepts. The classroom environment promotes social interaction and collaborative learning, which are essential for developing communication skills. Additionally, the structured schedule of traditional classes helps students maintain discipline and motivation.

Nevertheless, both approaches have limitations. Online learning can lead to isolation and reduced motivation due to lack of direct supervision. Technical issues and the digital divide can also create barriers for some students. On the other hand, traditional classroom education is less flexible and may not accommodate different learning styles effectively.

In conclusion, rather than viewing these approaches as mutually exclusive, educational institutions should embrace a blended model that combines the flexibility of online learning with the personal interaction of traditional classrooms. This hybrid approach can maximize the benefits of both methods while minimizing their respective limitations, ultimately providing students with a more comprehensive and effective learning experience.`,
                        analysis: {
                            strengths: [
                                'æ¸…æ™°çš„è®ºç‚¹å’Œç»“æ„',
                                'å¹³è¡¡åœ°è®¨è®ºäº†ä¸¤ç§è§‚ç‚¹',
                                'ä½¿ç”¨äº†æ°å½“çš„è¿æ¥è¯',
                                'ç»“è®ºæå‡ºäº†å»ºè®¾æ€§å»ºè®®'
                            ],
                            techniques: [
                                'ä½¿ç”¨å¯¹æ¯”è®ºè¯ç»“æ„',
                                'æ¯ä¸ªä¸»ä½“æ®µè½éƒ½æœ‰æ˜ç¡®çš„ä¸»é¢˜å¥',
                                'æä¾›äº†å…·ä½“çš„ä¾‹å­å’Œç†ç”±',
                                'ä½¿ç”¨äº†å¤šæ ·çš„å¥å¼ç»“æ„'
                            ]
                        }
                    }
                ],
                opinion: [
                    {
                        title: 'æˆ‘æœ€å–œæ¬¢çš„å­£èŠ‚',
                        prompt: 'æè¿°ä½ æœ€å–œæ¬¢çš„å­£èŠ‚å¹¶è¯´æ˜åŸå› ',
                        content: `My Favorite Season: Autumn

Among the four seasons, autumn holds a special place in my heart. While many people prefer the warmth of summer or the renewal of spring, I find autumn to be the most beautiful and meaningful season of the year.

The main reason I love autumn is its stunning visual beauty. The changing colors of leaves create a natural masterpiece that never fails to amaze me. Walking through parks and forests, I am surrounded by brilliant shades of red, orange, and gold. The crisp, clear air makes everything seem more vivid and alive. Even the way sunlight filters through the colorful canopy creates magical moments that summer's harsh brightness cannot match.

Another reason autumn appeals to me is the comfortable weather. After the sweltering heat of summer, the cool, refreshing air of autumn is incredibly welcome. It's perfect for outdoor activities like hiking, cycling, or simply taking long walks. I can wear my favorite sweaters and jackets without feeling too hot or too cold. The weather invites you to spend time outdoors while still being cozy and comfortable.

Finally, autumn represents a time of reflection and preparation. As nature prepares for winter's rest, I find myself naturally reflecting on the year's experiences and planning for the future. There's something deeply satisfying about this rhythm of life. The harvest season also reminds me to be grateful for the abundance in my life.

In conclusion, autumn's combination of natural beauty, pleasant weather, and meaningful symbolism makes it my favorite season. While others may prefer different times of the year, I will always treasure the unique magic that autumn brings to our world.`,
                        analysis: {
                            strengths: [
                                'ä¸ªäººè§‚ç‚¹è¡¨è¾¾æ¸…æ™°',
                                'ä½¿ç”¨äº†ç”ŸåŠ¨çš„æè¿°æ€§è¯­è¨€',
                                'ç»“æ„ç®€å•ä½†æœ‰æ•ˆ',
                                'æƒ…æ„Ÿè¡¨è¾¾çœŸè¯š'
                            ],
                            techniques: [
                                'ä½¿ç”¨æ„Ÿå®˜æè¿°å¢å¼ºè¡¨ç°åŠ›',
                                'æ¯æ®µä¸“æ³¨ä¸€ä¸ªä¸»è¦ç†ç”±',
                                'ä½¿ç”¨ç¬¬ä¸€äººç§°å¢åŠ ä¸ªäººè‰²å½©',
                                'ç»“å°¾å‘¼åº”å¼€å¤´'
                            ]
                        }
                    }
                ]
            },
            letter: {
                formal: [
                    {
                        title: 'æ±‚èŒç”³è¯·ä¿¡',
                        content: `123 Main Street
Anytown, ST 12345
March 15, 2024

Ms. Sarah Johnson
Human Resources Manager
Tech Solutions Inc.
456 Business Avenue
Business City, ST 67890

Dear Ms. Johnson,

I am writing to express my strong interest in the Software Developer position advertised on your company website. With my background in computer science and three years of professional experience in software development, I believe I would be a valuable addition to your team.

In my current role at Digital Innovations, I have successfully developed and maintained multiple web applications using Java, Python, and React. I have experience working in agile development environments and have consistently delivered projects on time and within budget. My technical skills, combined with my ability to work collaboratively with cross-functional teams, have enabled me to contribute significantly to my current organization's success.

What particularly attracts me to Tech Solutions Inc. is your company's reputation for innovation and commitment to employee development. I am excited about the opportunity to work on cutting-edge projects and continue growing my skills in a dynamic environment. I am confident that my passion for technology and proven track record of success make me an ideal candidate for this position.

I would welcome the opportunity to discuss how my skills and experience can contribute to your team. Thank you for considering my application. I look forward to hearing from you soon.

Sincerely,
John Smith`,
                        analysis: {
                            strengths: [
                                'æ­£å¼çš„å•†åŠ¡ä¿¡ä»¶æ ¼å¼',
                                'æ˜ç¡®è¯´æ˜äº†ç”³è¯·ç›®çš„',
                                'çªå‡ºäº†ç›¸å…³ç»éªŒå’ŒæŠ€èƒ½',
                                'è¡¨è¾¾äº†å¯¹å…¬å¸çš„äº†è§£å’Œå…´è¶£'
                            ]
                        }
                    }
                ]
            }
        };
        
        console.log('ğŸ“š èŒƒæ–‡æ•°æ®åº“å·²åˆå§‹åŒ–');
    }

    /**
     * è·å–å†™ä½œæ¨¡æ¿
     */
    getWritingTemplate(type, subtype) {
        try {
            const template = this.templatesDatabase[type]?.[subtype];
            if (!template) {
                console.warn(`æœªæ‰¾åˆ°ç±»å‹ ${type}-${subtype} çš„æ¨¡æ¿`);
                return null;
            }
            return template;
        } catch (error) {
            console.error('è·å–å†™ä½œæ¨¡æ¿å¤±è´¥:', error);
            return null;
        }
    }

    /**
     * è·å–èŒƒæ–‡
     */
    getSampleEssays(type, subtype) {
        try {
            const samples = this.sampleEssays[type]?.[subtype];
            if (!samples) {
                console.warn(`æœªæ‰¾åˆ°ç±»å‹ ${type}-${subtype} çš„èŒƒæ–‡`);
                return [];
            }
            return samples;
        } catch (error) {
            console.error('è·å–èŒƒæ–‡å¤±è´¥:', error);
            return [];
        }
    }

    /**
     * æ ¹æ®å½“å‰é¢˜ç›®æ¨èç›¸å…³æ¨¡æ¿
     */
    getRecommendedTemplate() {
        if (!this.currentWriting) {
            return null;
        }
        
        const topic = this.currentWriting;
        const writingType = topic.id.split('_')[0]; // essay, letter, report, email
        const subtype = topic.type; // argumentative, formal, etc.
        
        return this.getWritingTemplate(writingType, subtype);
    }

    /**
     * æ ¹æ®å½“å‰é¢˜ç›®æ¨èç›¸å…³èŒƒæ–‡
     */
    getRecommendedSamples() {
        if (!this.currentWriting) {
            return [];
        }
        
        const topic = this.currentWriting;
        const writingType = topic.id.split('_')[0]; // essay, letter, report, email
        const subtype = topic.type; // argumentative, formal, etc.
        
        return this.getSampleEssays(writingType, subtype);
    }

    /**
     * æ ¹æ®é…ç½®è·å–å†™ä½œé¢˜ç›®
     */
    getTopicsByConfig() {
        const topics = this.topicsDatabase[this.config.writingType]?.[this.config.difficulty];
        return topics || [];
    }

    /**
     * éšæœºé€‰æ‹©ä¸€ä¸ªå†™ä½œé¢˜ç›®
     */
    selectRandomTopic() {
        const topics = this.getTopicsByConfig();
        
        if (topics.length === 0) {
            console.warn('æœªæ‰¾åˆ°å¯¹åº”ç±»å‹çš„å†™ä½œé¢˜ç›®');
            return null;
        }
        
        const randomIndex = Math.floor(Math.random() * topics.length);
        return topics[randomIndex];
    }

    /**
     * å¼€å§‹å†™ä½œç»ƒä¹ 
     */
    startWritingPractice() {
        console.log('âœï¸ å¼€å§‹å†™ä½œç»ƒä¹ ');
        console.log('é…ç½®:', this.config);
        
        // é€‰æ‹©é¢˜ç›®
        this.currentWriting = this.selectRandomTopic();
        
        if (!this.currentWriting) {
            return null;
        }
        
        // åˆ›å»ºå†™ä½œä¼šè¯
        this.writingSession = {
            topic: this.currentWriting,
            startTime: Date.now(),
            endTime: null,
            content: '',
            wordCount: 0,
            timeSpent: 0,
            completed: false
        };
        
        console.log('âœ… å·²é€‰æ‹©å†™ä½œé¢˜ç›®:', this.currentWriting.title);
        return this.currentWriting;
    }

    /**
     * å¼€å§‹è®¡æ—¶
     */
    startTimer() {
        this.startTime = Date.now();
        
        this.timer = setInterval(() => {
            const elapsed = Date.now() - this.startTime;
            const minutes = Math.floor(elapsed / 60000);
            const seconds = Math.floor((elapsed % 60000) / 1000);
            
            // æ›´æ–°ç•Œé¢æ˜¾ç¤º
            const timerElement = document.getElementById('writingTimer');
            if (timerElement) {
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
        }, 1000);
    }

    /**
     * åœæ­¢è®¡æ—¶
     */
    stopTimer() {
        if (this.timer) {
            clearInterval(this.timer);
            this.timer = null;
        }
    }

    /**
     * æ›´æ–°å†™ä½œå†…å®¹
     */
    updateWritingContent(content) {
        if (!this.writingSession) return;
        
        this.writingSession.content = content;
        this.writingSession.wordCount = this.countWords(content);
        
        // æ›´æ–°å­—æ•°æ˜¾ç¤º
        const wordCountElement = document.getElementById('wordCount');
        if (wordCountElement) {
            const target = this.currentWriting.wordLimit;
            const current = this.writingSession.wordCount;
            wordCountElement.textContent = `${current}/${target} è¯`;
            
            // æ ¹æ®å­—æ•°å˜åŒ–é¢œè‰²
            if (current < target * 0.5) {
                wordCountElement.className = 'word-count insufficient';
            } else if (current >= target) {
                wordCountElement.className = 'word-count sufficient';
            } else {
                wordCountElement.className = 'word-count approaching';
            }
        }
    }

    /**
     * è®¡ç®—å­—æ•°
     */
    countWords(text) {
        if (!text || text.trim().length === 0) return 0;
        
        // ç®€å•çš„è‹±æ–‡å­—æ•°ç»Ÿè®¡
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        return words.length;
    }

    /**
     * å®Œæˆå†™ä½œç»ƒä¹ 
     */
    finishWriting(content) {
        if (!this.writingSession) {
            console.warn('æ²¡æœ‰æ´»åŠ¨çš„å†™ä½œä¼šè¯');
            return null;
        }

        this.stopTimer();
        
        this.writingSession.content = content;
        this.writingSession.wordCount = this.countWords(content);
        this.writingSession.endTime = Date.now();
        this.writingSession.timeSpent = this.writingSession.endTime - this.writingSession.startTime;
        this.writingSession.completed = true;
        
        // è¯„åˆ†
        const score = this.evaluateWriting(this.writingSession);
        
        const result = {
            session: this.writingSession,
            score: score,
            feedback: this.generateFeedback(score, this.writingSession)
        };
        
        // è®°å½•å­¦ä¹ ä¼šè¯
        if (window.app && window.app.recordStudySession) {
            window.app.recordStudySession('writing', this.writingSession.timeSpent / 1000, score.overall);
        }
        
        // æ›´æ–°è¿›åº¦
        this.updateWritingProgress(result);
        
        // ä¿å­˜ç»“æœ
        this.saveWritingResult(result);
        
        console.log('âœ… å†™ä½œç»ƒä¹ å®Œæˆ');
        return result;
    }

    /**
     * è¯„ä¼°å†™ä½œï¼ˆå¢å¼ºç‰ˆAIè¯„åˆ†ç³»ç»Ÿï¼‰
     */
    evaluateWriting(session) {
        let score = {
            total: 0,
            overall: 0,
            breakdown: {
                content: 0,        // å†…å®¹è´¨é‡ (25%)
                organization: 0,   // ç»“æ„ç»„ç»‡ (25%)
                language: 0,       // è¯­è¨€è¿ç”¨ (25%)
                mechanics: 0,      // è¯­æ³•æ‹¼å†™ (25%)
                coherence: 0,      // è¿è´¯æ€§ (é¢å¤–æŒ‡æ ‡)
                vocabulary: 0      // è¯æ±‡ä¸°å¯Œåº¦ (é¢å¤–æŒ‡æ ‡)
            },
            details: {
                wordCount: session.wordCount,
                targetWords: session.topic.wordLimit,
                timeSpent: Math.round(session.timeSpent / 1000 / 60),
                timeLimit: session.topic.timeLimit,
                paragraphCount: 0,
                sentenceCount: 0,
                avgWordsPerSentence: 0,
                vocabularyRichness: 0,
                readabilityScore: 0
            }
        };
        
        const content = session.content;
        const wordCount = session.wordCount;
        const targetWords = session.topic.wordLimit;
        const timeSpent = session.timeSpent / 1000 / 60; // è½¬æ¢ä¸ºåˆ†é’Ÿ
        const timeLimit = session.topic.timeLimit;
        
        // è¯¦ç»†åˆ†ææ–‡æœ¬
        const textAnalysis = this.analyzeText(content);
        score.details = { ...score.details, ...textAnalysis };
        
        // 1. å†…å®¹è¯„åˆ† (åŸºäºå­—æ•°è¾¾æ ‡ã€ä¸»é¢˜ç›¸å…³æ€§)
        score.breakdown.content = this.evaluateContent(wordCount, targetWords, content, session.topic);
        
        // 2. ç»“æ„è¯„åˆ† (åŸºäºæ®µè½ç»„ç»‡ã€é€»è¾‘ç»“æ„)
        score.breakdown.organization = this.evaluateOrganization(content, textAnalysis);
        
        // 3. è¯­è¨€è¯„åˆ† (åŸºäºè¯æ±‡å¤šæ ·æ€§ã€å¥å¼å¤æ‚åº¦)
        score.breakdown.language = this.evaluateLanguage(content, textAnalysis);
        
        // 4. è¯­æ³•æœºåˆ¶è¯„åˆ† (åŸºäºè¯­æ³•è§„åˆ™ã€æ‹¼å†™æ£€æŸ¥)
        score.breakdown.mechanics = this.evaluateMechanics(content, textAnalysis);
        
        // 5. è¿è´¯æ€§è¯„åˆ† (åŸºäºé€»è¾‘è¿æ¥ã€è¿‡æ¸¡è¯ä½¿ç”¨)
        score.breakdown.coherence = this.evaluateCoherence(content, textAnalysis);
        
        // 6. è¯æ±‡è¯„åˆ† (åŸºäºè¯æ±‡ä¸°å¯Œåº¦ã€å‡†ç¡®æ€§)
        score.breakdown.vocabulary = this.evaluateVocabulary(content, textAnalysis);
        
        // è®¡ç®—åŠ æƒæ€»åˆ†
        const weights = {
            content: 0.25,
            organization: 0.25,
            language: 0.20,
            mechanics: 0.15,
            coherence: 0.10,
            vocabulary: 0.05
        };
        
        score.total = Math.round(
            (score.breakdown.content * weights.content +
             score.breakdown.organization * weights.organization + 
             score.breakdown.language * weights.language + 
             score.breakdown.mechanics * weights.mechanics +
             score.breakdown.coherence * weights.coherence +
             score.breakdown.vocabulary * weights.vocabulary) * 10
        ) / 10;
        
        // è®¾ç½®overallåˆ†æ•°ç”¨äºå…¼å®¹æ€§
        score.overall = score.total;
        
        return score;
    }

    /**
     * åˆ†ææ–‡æœ¬çš„åŸºæœ¬ç‰¹å¾
     */
    analyzeText(content) {
        if (!content || content.trim().length === 0) {
            return {
                paragraphCount: 0,
                sentenceCount: 0,
                avgWordsPerSentence: 0,
                vocabularyRichness: 0,
                readabilityScore: 0,
                uniqueWords: 0,
                totalWords: 0
            };
        }
        
        // æ®µè½æ•°é‡
        const paragraphs = content.split(/\n\s*\n/).filter(p => p.trim().length > 0);
        const paragraphCount = paragraphs.length;
        
        // å¥å­æ•°é‡ (åŸºäºå¥å·ã€é—®å·ã€æ„Ÿå¹å·)
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        const sentenceCount = sentences.length;
        
        // è¯æ±‡åˆ†æ
        const words = content.toLowerCase().match(/\b[a-z]+\b/g) || [];
        const totalWords = words.length;
        const uniqueWords = new Set(words);
        const vocabularyRichness = totalWords > 0 ? uniqueWords.size / totalWords : 0;
        
        // å¹³å‡å¥é•¿
        const avgWordsPerSentence = sentenceCount > 0 ? totalWords / sentenceCount : 0;
        
        // ç®€å•çš„å¯è¯»æ€§è¯„åˆ† (åŸºäºå¹³å‡å¥é•¿å’ŒéŸ³èŠ‚æ•°ä¼°ç®—)
        const readabilityScore = this.calculateReadabilityScore(avgWordsPerSentence, vocabularyRichness);
        
        return {
            paragraphCount,
            sentenceCount,
            avgWordsPerSentence: Math.round(avgWordsPerSentence * 10) / 10,
            vocabularyRichness: Math.round(vocabularyRichness * 100) / 100,
            readabilityScore: Math.round(readabilityScore * 10) / 10,
            uniqueWords: uniqueWords.size,
            totalWords
        };
    }

    /**
     * è¯„ä¼°å†…å®¹è´¨é‡
     */
    evaluateContent(wordCount, targetWords, content, topic) {
        let score = 5; // åŸºç¡€åˆ†æ•°
        
        // å­—æ•°è¾¾æ ‡æƒ…å†µ (40%æƒé‡)
        const wordRatio = wordCount / targetWords;
        if (wordRatio >= 1.0) {
            score += 2.5;
        } else if (wordRatio >= 0.9) {
            score += 2.0;
        } else if (wordRatio >= 0.8) {
            score += 1.5;
        } else if (wordRatio >= 0.7) {
            score += 1.0;
        } else if (wordRatio >= 0.6) {
            score += 0.5;
        }
        
        // ä¸»é¢˜ç›¸å…³æ€§ (30%æƒé‡) - åŸºäºå…³é”®è¯åŒ¹é…
        const keywordScore = this.calculateKeywordRelevance(content, topic.keywords);
        score += keywordScore * 1.5;
        
        // å†…å®¹æ·±åº¦ (30%æƒé‡) - åŸºäºå†…å®¹å¤æ‚åº¦
        const depthScore = this.calculateContentDepth(content);
        score += depthScore * 1.5;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è¯„ä¼°ç»“æ„ç»„ç»‡
     */
    evaluateOrganization(content, analysis) {
        let score = 5; // åŸºç¡€åˆ†æ•°
        
        // æ®µè½ç»“æ„ (50%æƒé‡)
        if (analysis.paragraphCount >= 4) {
            score += 2;
        } else if (analysis.paragraphCount >= 3) {
            score += 1.5;
        } else if (analysis.paragraphCount >= 2) {
            score += 1;
        } else if (analysis.paragraphCount >= 1) {
            score += 0.5;
        }
        
        // é€»è¾‘è¿æ¥è¯ä½¿ç”¨ (30%æƒé‡)
        const transitionScore = this.evaluateTransitionWords(content);
        score += transitionScore * 1.2;
        
        // ç»“æ„æ¸…æ™°åº¦ (20%æƒé‡)
        const structureScore = this.evaluateStructureClarity(content);
        score += structureScore * 0.8;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è¯„ä¼°è¯­è¨€è¿ç”¨
     */
    evaluateLanguage(content, analysis) {
        let score = 5; // åŸºç¡€åˆ†æ•°
        
        // è¯æ±‡å¤šæ ·æ€§ (40%æƒé‡)
        if (analysis.vocabularyRichness > 0.7) {
            score += 2;
        } else if (analysis.vocabularyRichness > 0.6) {
            score += 1.5;
        } else if (analysis.vocabularyRichness > 0.5) {
            score += 1;
        } else if (analysis.vocabularyRichness > 0.4) {
            score += 0.5;
        }
        
        // å¥å¼å¤æ‚åº¦ (35%æƒé‡)
        const complexityScore = this.evaluateSentenceComplexity(content, analysis);
        score += complexityScore * 1.4;
        
        // è¯­è¨€å‡†ç¡®æ€§ (25%æƒé‡)
        const accuracyScore = this.evaluateLanguageAccuracy(content);
        score += accuracyScore * 1;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è¯„ä¼°è¯­æ³•æœºåˆ¶
     */
    evaluateMechanics(content, analysis) {
        let score = 7; // é»˜è®¤è¾ƒé«˜åˆ†æ•°ï¼Œå› ä¸ºè¯¦ç»†è¯­æ³•æ£€æŸ¥éœ€è¦ä¸“é—¨å·¥å…·
        
        // åŸºæœ¬æ‹¼å†™æ£€æŸ¥ (40%æƒé‡)
        const spellingScore = this.basicSpellingCheck(content);
        score += (spellingScore - 0.5) * 1.6;
        
        // æ ‡ç‚¹ç¬¦å·ä½¿ç”¨ (30%æƒé‡)
        const punctuationScore = this.evaluatePunctuation(content);
        score += (punctuationScore - 0.5) * 1.2;
        
        // å¤§å°å†™è§„èŒƒ (30%æƒé‡)
        const capitalizationScore = this.evaluateCapitalization(content);
        score += (capitalizationScore - 0.5) * 1.2;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è¯„ä¼°è¿è´¯æ€§
     */
    evaluateCoherence(content, analysis) {
        let score = 6; // åŸºç¡€åˆ†æ•°
        
        // é€»è¾‘æµç•…æ€§ (60%æƒé‡)
        const flowScore = this.evaluateLogicalFlow(content);
        score += flowScore * 1.8;
        
        // ä»£è¯æŒ‡ä»£æ¸…æ™°åº¦ (40%æƒé‡)
        const referenceScore = this.evaluatePronounReference(content);
        score += referenceScore * 1.2;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è¯„ä¼°è¯æ±‡è¿ç”¨
     */
    evaluateVocabulary(content, analysis) {
        let score = 6; // åŸºç¡€åˆ†æ•°
        
        // é«˜çº§è¯æ±‡ä½¿ç”¨ (70%æƒé‡)
        const advancedVocabScore = this.evaluateAdvancedVocabulary(content);
        score += advancedVocabScore * 2.1;
        
        // è¯æ±‡å‡†ç¡®æ€§ (30%æƒé‡)
        const vocabularyAccuracy = this.evaluateVocabularyAccuracy(content);
        score += vocabularyAccuracy * 0.9;
        
        return Math.min(Math.max(score, 0), 9);
    }

    /**
     * è®¡ç®—å…³é”®è¯ç›¸å…³æ€§
     */
    calculateKeywordRelevance(content, keywords) {
        if (!keywords || keywords.length === 0) return 0.5;
        
        const lowerContent = content.toLowerCase();
        let matchCount = 0;
        
        keywords.forEach(keyword => {
            if (lowerContent.includes(keyword.toLowerCase())) {
                matchCount++;
            }
        });
        
        return matchCount / keywords.length;
    }

    /**
     * è®¡ç®—å†…å®¹æ·±åº¦
     */
    calculateContentDepth(content) {
        // åŸºäºå¥å­é•¿åº¦å˜åŒ–ã€è¯æ±‡å¤æ‚åº¦ç­‰å› ç´ 
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        if (sentences.length === 0) return 0;
        
        let complexityScore = 0;
        let totalLength = 0;
        
        sentences.forEach(sentence => {
            const words = sentence.trim().split(/\s+/);
            totalLength += words.length;
            
            // é•¿å¥å­è·å¾—æ›´é«˜åˆ†æ•°
            if (words.length > 15) complexityScore += 0.3;
            else if (words.length > 10) complexityScore += 0.2;
            else if (words.length > 5) complexityScore += 0.1;
        });
        
        const avgLength = totalLength / sentences.length;
        const depthScore = Math.min(complexityScore / sentences.length + avgLength / 20, 1);
        
        return depthScore;
    }

    /**
     * è¯„ä¼°è¿‡æ¸¡è¯ä½¿ç”¨
     */
    evaluateTransitionWords(content) {
        const transitionWords = [
            'however', 'furthermore', 'moreover', 'therefore', 'consequently',
            'in addition', 'on the other hand', 'in contrast', 'similarly',
            'for example', 'in conclusion', 'finally', 'first', 'second',
            'although', 'despite', 'because', 'since', 'as a result'
        ];
        
        const lowerContent = content.toLowerCase();
        let transitionCount = 0;
        
        transitionWords.forEach(word => {
            if (lowerContent.includes(word)) {
                transitionCount++;
            }
        });
        
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        const transitionRatio = sentences.length > 0 ? transitionCount / sentences.length : 0;
        
        return Math.min(transitionRatio * 2, 1);
    }

    /**
     * è¯„ä¼°ç»“æ„æ¸…æ™°åº¦
     */
    evaluateStructureClarity(content) {
        // ç®€åŒ–çš„ç»“æ„è¯„ä¼°ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æ˜ç¡®çš„å¼€å¤´ã€ä¸­é—´ã€ç»“å°¾
        const paragraphs = content.split(/\n\s*\n/).filter(p => p.trim().length > 0);
        
        if (paragraphs.length < 2) return 0.3;
        if (paragraphs.length === 2) return 0.6;
        if (paragraphs.length >= 3) return 0.9;
        
        return 0.5;
    }

    /**
     * è¯„ä¼°å¥å¼å¤æ‚åº¦
     */
    evaluateSentenceComplexity(content, analysis) {
        // åŸºäºå¹³å‡å¥é•¿å’Œå¥å¼å˜åŒ–
        const avgLength = analysis.avgWordsPerSentence;
        let complexityScore = 0;
        
        if (avgLength > 20) complexityScore = 1;
        else if (avgLength > 15) complexityScore = 0.8;
        else if (avgLength > 12) complexityScore = 0.6;
        else if (avgLength > 8) complexityScore = 0.4;
        else complexityScore = 0.2;
        
        // æ£€æŸ¥å¤æ‚å¥å¼æ ‡å¿—è¯
        const complexMarkers = ['which', 'that', 'although', 'because', 'since', 'while', 'whereas'];
        const lowerContent = content.toLowerCase();
        let markerCount = 0;
        
        complexMarkers.forEach(marker => {
            if (lowerContent.includes(marker)) markerCount++;
        });
        
        const markerBonus = Math.min(markerCount * 0.1, 0.3);
        
        return Math.min(complexityScore + markerBonus, 1);
    }

    /**
     * è¯„ä¼°è¯­è¨€å‡†ç¡®æ€§
     */
    evaluateLanguageAccuracy(content) {
        // ç®€åŒ–çš„å‡†ç¡®æ€§è¯„ä¼°
        // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥é›†æˆæ›´ä¸“ä¸šçš„è¯­æ³•æ£€æŸ¥å·¥å…·
        return 0.8; // é»˜è®¤ç»™è¾ƒé«˜åˆ†æ•°
    }

    /**
     * åŸºæœ¬æ‹¼å†™æ£€æŸ¥
     */
    basicSpellingCheck(content) {
        // ç®€åŒ–çš„æ‹¼å†™æ£€æŸ¥
        // å®é™…åº”ç”¨ä¸­åº”è¯¥ä½¿ç”¨ä¸“ä¸šçš„æ‹¼å†™æ£€æŸ¥åº“
        return 0.8; // é»˜è®¤ç»™è¾ƒé«˜åˆ†æ•°
    }

    /**
     * è¯„ä¼°æ ‡ç‚¹ç¬¦å·ä½¿ç”¨
     */
    evaluatePunctuation(content) {
        // æ£€æŸ¥åŸºæœ¬æ ‡ç‚¹ç¬¦å·çš„ä½¿ç”¨
        const hasCommas = content.includes(',');
        const hasPeriods = content.includes('.');
        const hasQuestionMarks = content.includes('?');
        const hasExclamation = content.includes('!');
        
        let score = 0.5;
        if (hasPeriods) score += 0.2;
        if (hasCommas) score += 0.2;
        if (hasQuestionMarks || hasExclamation) score += 0.1;
        
        return Math.min(score, 1);
    }

    /**
     * è¯„ä¼°å¤§å°å†™è§„èŒƒ
     */
    evaluateCapitalization(content) {
        // æ£€æŸ¥å¥é¦–å¤§å†™
        const sentences = content.split(/[.!?]+/).filter(s => s.trim().length > 0);
        let correctCapitalization = 0;
        
        sentences.forEach(sentence => {
            const trimmed = sentence.trim();
            if (trimmed.length > 0 && /^[A-Z]/.test(trimmed)) {
                correctCapitalization++;
            }
        });
        
        return sentences.length > 0 ? correctCapitalization / sentences.length : 0.5;
    }

    /**
     * è¯„ä¼°é€»è¾‘æµç•…æ€§
     */
    evaluateLogicalFlow(content) {
        // ç®€åŒ–çš„é€»è¾‘æµç•…æ€§è¯„ä¼°
        // åŸºäºæ®µè½ä¹‹é—´çš„è¿æ¥å’Œå†…å®¹çš„è¿è´¯æ€§
        const paragraphs = content.split(/\n\s*\n/).filter(p => p.trim().length > 0);
        
        if (paragraphs.length < 2) return 0.5;
        
        // æ£€æŸ¥æ®µè½é—´çš„é€»è¾‘è¿æ¥
        let connectionScore = 0.6; // åŸºç¡€åˆ†æ•°
        
        // ç®€å•æ£€æŸ¥ï¼šåç»­æ®µè½æ˜¯å¦ä¸å‰é¢å†…å®¹ç›¸å…³
        // è¿™é‡Œå¯ä»¥æ‰©å±•ä¸ºæ›´å¤æ‚çš„è¯­ä¹‰åˆ†æ
        
        return connectionScore;
    }

    /**
     * è¯„ä¼°ä»£è¯æŒ‡ä»£æ¸…æ™°åº¦
     */
    evaluatePronounReference(content) {
        // ç®€åŒ–çš„ä»£è¯æŒ‡ä»£è¯„ä¼°
        const pronouns = ['it', 'they', 'this', 'that', 'these', 'those'];
        const lowerContent = content.toLowerCase();
        
        let pronounCount = 0;
        pronouns.forEach(pronoun => {
            const regex = new RegExp(`\\b${pronoun}\\b`, 'g');
            const matches = lowerContent.match(regex);
            if (matches) pronounCount += matches.length;
        });
        
        // é€‚åº¦ä½¿ç”¨ä»£è¯å¾—é«˜åˆ†ï¼Œè¿‡å¤šæˆ–è¿‡å°‘éƒ½æ‰£åˆ†
        const words = content.split(/\s+/).length;
        const pronounRatio = words > 0 ? pronounCount / words : 0;
        
        if (pronounRatio > 0.05 && pronounRatio < 0.15) return 0.8;
        else if (pronounRatio > 0.02 && pronounRatio < 0.2) return 0.6;
        else return 0.4;
    }

    /**
     * è¯„ä¼°é«˜çº§è¯æ±‡ä½¿ç”¨
     */
    evaluateAdvancedVocabulary(content) {
        // é«˜çº§è¯æ±‡åˆ—è¡¨ï¼ˆç¤ºä¾‹ï¼‰
        const advancedWords = [
            'consequently', 'furthermore', 'nevertheless', 'moreover', 'significantly',
            'substantial', 'comprehensive', 'sophisticated', 'innovative', 'fundamental',
            'crucial', 'essential', 'substantial', 'considerable', 'remarkable',
            'extraordinary', 'exceptional', 'unprecedented', 'profound', 'tremendous'
        ];
        
        const lowerContent = content.toLowerCase();
        let advancedCount = 0;
        
        advancedWords.forEach(word => {
            if (lowerContent.includes(word)) {
                advancedCount++;
            }
        });
        
        const totalWords = content.split(/\s+/).length;
        const advancedRatio = totalWords > 0 ? advancedCount / totalWords : 0;
        
        return Math.min(advancedRatio * 20, 1); // æ”¾å¤§æ¯”ä¾‹ä»¥è·å¾—åˆç†åˆ†æ•°
    }

    /**
     * è¯„ä¼°è¯æ±‡å‡†ç¡®æ€§
     */
    evaluateVocabularyAccuracy(content) {
        // ç®€åŒ–çš„è¯æ±‡å‡†ç¡®æ€§è¯„ä¼°
        // å®é™…åº”ç”¨ä¸­åº”è¯¥æ£€æŸ¥è¯æ±‡æ­é…ã€è¯­å¢ƒé€‚å½“æ€§ç­‰
        return 0.8; // é»˜è®¤ç»™è¾ƒé«˜åˆ†æ•°
    }

    /**
     * è®¡ç®—å¯è¯»æ€§è¯„åˆ†
     */
    calculateReadabilityScore(avgWordsPerSentence, vocabularyRichness) {
        // åŸºäºFlesch Reading Easeçš„ç®€åŒ–ç‰ˆæœ¬
        // è¾ƒçŸ­çš„å¥å­å’Œå¸¸ç”¨è¯æ±‡è·å¾—æ›´é«˜çš„å¯è¯»æ€§åˆ†æ•°
        let readabilityScore = 100;
        
        // å¥é•¿å½±å“ (å¥å­è¶Šé•¿ï¼Œå¯è¯»æ€§è¶Šä½)
        readabilityScore -= (avgWordsPerSentence - 10) * 2;
        
        // è¯æ±‡å¤æ‚åº¦å½±å“ (è¯æ±‡è¶Šä¸°å¯Œï¼Œå¯è¯»æ€§ç›¸å¯¹é™ä½)
        readabilityScore -= (vocabularyRichness - 0.5) * 20;
        
        return Math.max(Math.min(readabilityScore, 100), 0);
    }

    /**
     * ç”Ÿæˆå¢å¼ºç‰ˆåé¦ˆ
     */
    generateFeedback(score, session) {
        const feedback = {
            overall: '',
            strengths: [],
            improvements: [],
            suggestions: [],
            detailedAnalysis: {
                content: '',
                organization: '',
                language: '',
                mechanics: '',
                coherence: '',
                vocabulary: ''
            },
            scoreBreakdown: {
                content: score.breakdown.content,
                organization: score.breakdown.organization,
                language: score.breakdown.language,
                mechanics: score.breakdown.mechanics,
                coherence: score.breakdown.coherence,
                vocabulary: score.breakdown.vocabulary
            },
            writingAnalysis: score.details
        };
        
        // æ€»ä½“è¯„ä»·
        if (score.total >= 8.5) {
            feedback.overall = 'ğŸŒŸ å“è¶Šçš„å†™ä½œï¼ä½ å±•ç°äº†å‡ºè‰²çš„è‹±è¯­å†™ä½œèƒ½åŠ›ï¼Œå„æ–¹é¢è¡¨ç°éƒ½å¾ˆä¼˜ç§€ã€‚';
        } else if (score.total >= 7.5) {
            feedback.overall = 'âœ¨ ä¼˜ç§€çš„å†™ä½œï¼æ•´ä½“è´¨é‡å¾ˆé«˜ï¼Œåªéœ€è¦åœ¨ä¸€äº›ç»†èŠ‚ä¸Šè¿›è¡Œå¾®è°ƒã€‚';
        } else if (score.total >= 6.5) {
            feedback.overall = 'ğŸ‘ è‰¯å¥½çš„å†™ä½œï¼åŸºç¡€æ‰å®ï¼Œæœ‰æ˜æ˜¾çš„è¿›æ­¥ç©ºé—´ã€‚';
        } else if (score.total >= 5.5) {
            feedback.overall = 'ğŸ“ˆ ä¸é”™çš„å°è¯•ï¼ç»§ç»­ç»ƒä¹ ä¼šæœ‰æ›´å¤§çš„æå‡ã€‚';
        } else {
            feedback.overall = 'ğŸ’ª éœ€è¦æ›´å¤šç»ƒä¹ ï¼ä¸è¦æ°”é¦ï¼Œæ¯æ¬¡ç»ƒä¹ éƒ½æ˜¯è¿›æ­¥çš„æœºä¼šã€‚';
        }
        
        // è¯¦ç»†åˆ†æå„ä¸ªç»´åº¦
        this.generateContentFeedback(feedback, score.breakdown.content, session);
        this.generateOrganizationFeedback(feedback, score.breakdown.organization, session);
        this.generateLanguageFeedback(feedback, score.breakdown.language, session);
        this.generateMechanicsFeedback(feedback, score.breakdown.mechanics, session);
        this.generateCoherenceFeedback(feedback, score.breakdown.coherence, session);
        this.generateVocabularyFeedback(feedback, score.breakdown.vocabulary, session);
        
        // ä¸ªæ€§åŒ–å»ºè®®
        this.generatePersonalizedSuggestions(feedback, score, session);
        
        return feedback;
    }

    /**
     * ç”Ÿæˆå†…å®¹åé¦ˆ
     */
    generateContentFeedback(feedback, contentScore, session) {
        if (contentScore >= 8) {
            feedback.strengths.push('ğŸ“ å†…å®¹å……å®ä¸°å¯Œï¼Œå¾ˆå¥½åœ°å›åº”äº†é¢˜ç›®è¦æ±‚');
            feedback.detailedAnalysis.content = 'å†…å®¹è´¨é‡ä¼˜ç§€ï¼Œä¸»é¢˜æŠŠæ¡å‡†ç¡®ï¼Œè®ºè¿°æ·±å…¥ã€‚';
        } else if (contentScore >= 7) {
            feedback.strengths.push('ğŸ“ å†…å®¹åŸºæœ¬å……å®ï¼Œèƒ½å¤Ÿå›åº”é¢˜ç›®è¦æ±‚');
            feedback.detailedAnalysis.content = 'å†…å®¹è´¨é‡è‰¯å¥½ï¼Œä¸»é¢˜ç›¸å…³æ€§è¾ƒå¼ºã€‚';
        } else if (contentScore >= 6) {
            feedback.improvements.push('ğŸ“ å†…å®¹éœ€è¦æ›´åŠ å……å®ï¼Œå¯ä»¥æ·»åŠ æ›´å¤šå…·ä½“ä¾‹å­å’Œç»†èŠ‚');
            feedback.detailedAnalysis.content = 'å†…å®¹åŸºæœ¬ç¬¦åˆè¦æ±‚ï¼Œä½†æ·±åº¦æœ‰å¾…æé«˜ã€‚';
        } else {
            feedback.improvements.push('ğŸ“ å†…å®¹è¿‡äºç®€å•ï¼Œéœ€è¦å¤§å¹…æ‰©å±•å’Œæ·±åŒ–');
            feedback.detailedAnalysis.content = 'å†…å®¹ä¸å¤Ÿå……å®ï¼Œéœ€è¦æ›´å¤šçš„è®ºè¿°å’Œæ”¯æ’‘ã€‚';
        }
        
        // å­—æ•°ç›¸å…³åé¦ˆ
        const wordRatio = session.wordCount / session.topic.wordLimit;
        if (wordRatio < 0.8) {
            feedback.improvements.push(`ğŸ“Š å­—æ•°ä¸è¶³ï¼Œå½“å‰${session.wordCount}å­—ï¼Œå»ºè®®è¾¾åˆ°${session.topic.wordLimit}å­—ä»¥ä¸Š`);
        } else if (wordRatio >= 1.2) {
            feedback.suggestions.push('ğŸ“Š å­—æ•°å……è¶³ï¼Œæ³¨æ„æ§åˆ¶ç¯‡å¹…ï¼Œä¿æŒå†…å®¹ç´§å‡‘');
        }
    }

    /**
     * ç”Ÿæˆç»“æ„åé¦ˆ
     */
    generateOrganizationFeedback(feedback, orgScore, session) {
        const paragraphCount = session.content.split(/\n\s*\n/).filter(p => p.trim().length > 0).length;
        
        if (orgScore >= 8) {
            feedback.strengths.push('ğŸ—ï¸ æ–‡ç« ç»“æ„æ¸…æ™°ï¼Œæ®µè½ç»„ç»‡åˆç†');
            feedback.detailedAnalysis.organization = 'ç»“æ„ä¼˜ç§€ï¼Œé€»è¾‘å±‚æ¬¡åˆ†æ˜ï¼Œæ®µè½è¿‡æ¸¡è‡ªç„¶ã€‚';
        } else if (orgScore >= 7) {
            feedback.strengths.push('ğŸ—ï¸ æ–‡ç« ç»“æ„åŸºæœ¬æ¸…æ™°');
            feedback.detailedAnalysis.organization = 'ç»“æ„è‰¯å¥½ï¼Œé€»è¾‘åŸºæœ¬æ¸…æ™°ã€‚';
        } else if (orgScore >= 6) {
            feedback.improvements.push('ğŸ—ï¸ æ–‡ç« ç»“æ„éœ€è¦æ”¹è¿›ï¼Œæ³¨æ„æ®µè½é—´çš„é€»è¾‘å…³ç³»');
            feedback.detailedAnalysis.organization = 'ç»“æ„åŸºæœ¬åˆç†ï¼Œä½†é€»è¾‘è¿æ¥æœ‰å¾…åŠ å¼ºã€‚';
        } else {
            feedback.improvements.push('ğŸ—ï¸ æ–‡ç« ç»“æ„æ··ä¹±ï¼Œéœ€è¦é‡æ–°ç»„ç»‡å†…å®¹');
            feedback.detailedAnalysis.organization = 'ç»“æ„ä¸å¤Ÿæ¸…æ™°ï¼Œæ®µè½ç»„ç»‡éœ€è¦æ”¹è¿›ã€‚';
        }
        
        // æ®µè½æ•°é‡å»ºè®®
        if (paragraphCount < 3) {
            feedback.suggestions.push('ğŸ“„ å»ºè®®å°†å†…å®¹åˆ†ä¸ºæ›´å¤šæ®µè½ï¼Œæ¯æ®µä¸“æ³¨ä¸€ä¸ªä¸»è¦è§‚ç‚¹');
        } else if (paragraphCount > 6) {
            feedback.suggestions.push('ğŸ“„ æ®µè½è¾ƒå¤šï¼Œå¯è€ƒè™‘åˆå¹¶ç›¸å…³å†…å®¹ï¼Œä½¿ç»“æ„æ›´ç´§å‡‘');
        }
    }

    /**
     * ç”Ÿæˆè¯­è¨€åé¦ˆ
     */
    generateLanguageFeedback(feedback, langScore, session) {
        if (langScore >= 8) {
            feedback.strengths.push('ğŸ¯ è¯­è¨€è¡¨è¾¾å‡†ç¡®æµç•…ï¼Œè¯æ±‡è¿ç”¨æ°å½“');
            feedback.detailedAnalysis.language = 'è¯­è¨€è¿ç”¨ä¼˜ç§€ï¼Œè¡¨è¾¾è‡ªç„¶æµç•…ã€‚';
        } else if (langScore >= 7) {
            feedback.strengths.push('ğŸ¯ è¯­è¨€è¡¨è¾¾åŸºæœ¬å‡†ç¡®');
            feedback.detailedAnalysis.language = 'è¯­è¨€è¿ç”¨è‰¯å¥½ï¼Œè¡¨è¾¾è¾ƒä¸ºæ¸…æ™°ã€‚';
        } else if (langScore >= 6) {
            feedback.improvements.push('ğŸ¯ è¯­è¨€è¡¨è¾¾éœ€è¦æé«˜ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æ›´å¤šæ ·çš„å¥å¼');
            feedback.detailedAnalysis.language = 'è¯­è¨€è¿ç”¨åŸºæœ¬åˆæ ¼ï¼Œä½†è¡¨è¾¾æ–¹å¼éœ€è¦æ›´åŠ å¤šæ ·åŒ–ã€‚';
        } else {
            feedback.improvements.push('ğŸ¯ è¯­è¨€è¡¨è¾¾æœ‰è¾ƒå¤šé—®é¢˜ï¼Œéœ€è¦åŠ å¼ºåŸºç¡€è®­ç»ƒ');
            feedback.detailedAnalysis.language = 'è¯­è¨€è¿ç”¨å­˜åœ¨é—®é¢˜ï¼Œéœ€è¦åŠ å¼ºåŸºç¡€ç»ƒä¹ ã€‚';
        }
    }

    /**
     * ç”Ÿæˆè¯­æ³•æœºåˆ¶åé¦ˆ
     */
    generateMechanicsFeedback(feedback, mechScore, session) {
        if (mechScore >= 8) {
            feedback.strengths.push('âœ… è¯­æ³•å’Œæ‹¼å†™åŸºæœ¬å‡†ç¡®ï¼Œæ ‡ç‚¹ä½¿ç”¨è§„èŒƒ');
            feedback.detailedAnalysis.mechanics = 'è¯­æ³•æœºåˆ¶ä¼˜ç§€ï¼Œé”™è¯¯å¾ˆå°‘ã€‚';
        } else if (mechScore >= 7) {
            feedback.strengths.push('âœ… è¯­æ³•å’Œæ‹¼å†™å¤§éƒ¨åˆ†æ­£ç¡®');
            feedback.detailedAnalysis.mechanics = 'è¯­æ³•æœºåˆ¶è‰¯å¥½ï¼Œå¶æœ‰å°é”™ã€‚';
        } else if (mechScore >= 6) {
            feedback.improvements.push('âœ… æ³¨æ„æ£€æŸ¥è¯­æ³•å’Œæ‹¼å†™é”™è¯¯');
            feedback.detailedAnalysis.mechanics = 'è¯­æ³•æœºåˆ¶åŸºæœ¬åˆæ ¼ï¼Œä½†éœ€è¦æ›´ä»”ç»†çš„æ£€æŸ¥ã€‚';
        } else {
            feedback.improvements.push('âœ… è¯­æ³•å’Œæ‹¼å†™é”™è¯¯è¾ƒå¤šï¼Œéœ€è¦åŠ å¼ºåŸºç¡€ç»ƒä¹ ');
            feedback.detailedAnalysis.mechanics = 'è¯­æ³•æœºåˆ¶éœ€è¦æ”¹è¿›ï¼Œå»ºè®®åŠ å¼ºåŸºç¡€è®­ç»ƒã€‚';
        }
    }

    /**
     * ç”Ÿæˆè¿è´¯æ€§åé¦ˆ
     */
    generateCoherenceFeedback(feedback, cohScore, session) {
        if (cohScore >= 8) {
            feedback.strengths.push('ğŸ”— æ–‡ç« è¿è´¯æ€§å¾ˆå¥½ï¼Œé€»è¾‘æµç•…');
            feedback.detailedAnalysis.coherence = 'è¿è´¯æ€§ä¼˜ç§€ï¼Œæ€è·¯æ¸…æ™°ï¼Œé€»è¾‘æ€§å¼ºã€‚';
        } else if (cohScore >= 7) {
            feedback.strengths.push('ğŸ”— æ–‡ç« è¿è´¯æ€§è¾ƒå¥½');
            feedback.detailedAnalysis.coherence = 'è¿è´¯æ€§è‰¯å¥½ï¼Œé€»è¾‘åŸºæœ¬æ¸…æ™°ã€‚';
        } else if (cohScore >= 6) {
            feedback.improvements.push('ğŸ”— åŠ å¼ºå¥å­å’Œæ®µè½é—´çš„é€»è¾‘è¿æ¥');
            feedback.detailedAnalysis.coherence = 'è¿è´¯æ€§æœ‰å¾…æé«˜ï¼Œéœ€è¦æ›´å¥½çš„é€»è¾‘è¿æ¥ã€‚';
        } else {
            feedback.improvements.push('ğŸ”— æ–‡ç« ç¼ºä¹è¿è´¯æ€§ï¼Œéœ€è¦æ”¹å–„é€»è¾‘ç»“æ„');
            feedback.detailedAnalysis.coherence = 'è¿è´¯æ€§ä¸è¶³ï¼Œé€»è¾‘å…³ç³»ä¸å¤Ÿæ¸…æ™°ã€‚';
        }
    }

    /**
     * ç”Ÿæˆè¯æ±‡åé¦ˆ
     */
    generateVocabularyFeedback(feedback, vocabScore, session) {
        if (vocabScore >= 8) {
            feedback.strengths.push('ğŸ“š è¯æ±‡è¿ç”¨ä¸°å¯Œå¤šæ ·ï¼Œå±•ç°äº†è‰¯å¥½çš„è¯­è¨€åŠŸåº•');
            feedback.detailedAnalysis.vocabulary = 'è¯æ±‡è¿ç”¨ä¼˜ç§€ï¼Œä¸°å¯Œå¤šæ ·ä¸”å‡†ç¡®ã€‚';
        } else if (vocabScore >= 7) {
            feedback.strengths.push('ğŸ“š è¯æ±‡è¿ç”¨è¾ƒä¸ºä¸°å¯Œ');
            feedback.detailedAnalysis.vocabulary = 'è¯æ±‡è¿ç”¨è‰¯å¥½ï¼Œæœ‰ä¸€å®šçš„å¤šæ ·æ€§ã€‚';
        } else if (vocabScore >= 6) {
            feedback.improvements.push('ğŸ“š å¯ä»¥å°è¯•ä½¿ç”¨æ›´å¤šé«˜çº§è¯æ±‡å’Œè¡¨è¾¾æ–¹å¼');
            feedback.detailedAnalysis.vocabulary = 'è¯æ±‡è¿ç”¨åŸºæœ¬åˆæ ¼ï¼Œä½†å¯ä»¥æ›´åŠ ä¸°å¯Œã€‚';
        } else {
            feedback.improvements.push('ğŸ“š è¯æ±‡è¿‡äºç®€å•ï¼Œéœ€è¦æ‰©å¤§è¯æ±‡é‡');
            feedback.detailedAnalysis.vocabulary = 'è¯æ±‡è¿ç”¨è¾ƒä¸ºç®€å•ï¼Œéœ€è¦æé«˜è¯æ±‡ä¸°å¯Œåº¦ã€‚';
        }
    }

    /**
     * ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
     */
    generatePersonalizedSuggestions(feedback, score, session) {
        const details = score.details;
        
        // åŸºäºå†™ä½œç±»å‹çš„å»ºè®®
        const writingType = session.topic.type;
        switch (writingType) {
            case 'argumentative':
                feedback.suggestions.push('ğŸ’¡ è®®è®ºæ–‡å»ºè®®ï¼šç¡®ä¿æœ‰æ¸…æ™°çš„è®ºç‚¹ï¼Œå……åˆ†çš„è®ºæ®æ”¯æŒï¼Œä»¥åŠæœ‰åŠ›çš„ç»“è®º');
                break;
            case 'descriptive':
                feedback.suggestions.push('ğŸ’¡ æè¿°æ–‡å»ºè®®ï¼šä½¿ç”¨æ›´å¤šæ„Ÿå®˜ç»†èŠ‚ï¼Œè®©æè¿°æ›´åŠ ç”ŸåŠ¨å…·ä½“');
                break;
            case 'narrative':
                feedback.suggestions.push('ğŸ’¡ è®°å™æ–‡å»ºè®®ï¼šæ³¨æ„æ—¶é—´é¡ºåºï¼Œçªå‡ºå…³é”®äº‹ä»¶å’Œæƒ…æ„Ÿå˜åŒ–');
                break;
            case 'formal':
                feedback.suggestions.push('ğŸ’¡ æ­£å¼æ–‡ä½“å»ºè®®ï¼šä¿æŒæ­£å¼è¯­è°ƒï¼Œä½¿ç”¨é€‚å½“çš„æ•¬è¯­å’Œå•†åŠ¡è¡¨è¾¾');
                break;
            case 'informal':
                feedback.suggestions.push('ğŸ’¡ éæ­£å¼æ–‡ä½“å»ºè®®ï¼šå¯ä»¥ä½¿ç”¨æ›´è½»æ¾çš„è¯­è°ƒï¼Œä½†ä»è¦ä¿æŒæ¸…æ™°è¡¨è¾¾');
                break;
        }
        
        // åŸºäºåˆ†æç»“æœçš„å»ºè®®
        if (details.avgWordsPerSentence < 8) {
            feedback.suggestions.push('ğŸ“ å°è¯•å†™æ›´é•¿çš„å¥å­ï¼Œä½¿ç”¨è¿æ¥è¯è¿æ¥ç›¸å…³æƒ³æ³•');
        } else if (details.avgWordsPerSentence > 20) {
            feedback.suggestions.push('ğŸ“ å¥å­è¿‡é•¿ï¼Œå¯ä»¥é€‚å½“åˆ†è§£ä¸ºæ›´çŸ­çš„å¥å­ä»¥æé«˜å¯è¯»æ€§');
        }
        
        if (details.vocabularyRichness < 0.5) {
            feedback.suggestions.push('ğŸ“š å¢åŠ è¯æ±‡å¤šæ ·æ€§ï¼Œé¿å…é‡å¤ä½¿ç”¨ç›¸åŒçš„è¯æ±‡');
        }
        
        if (details.paragraphCount < 3) {
            feedback.suggestions.push('ğŸ“„ å»ºè®®å¢åŠ æ®µè½æ•°é‡ï¼Œæ¯ä¸ªæ®µè½ä¸“æ³¨äºä¸€ä¸ªä¸»è¦è§‚ç‚¹');
        }
        
        // æ—¶é—´ç®¡ç†å»ºè®®
        const timeRatio = details.timeSpent / details.timeLimit;
        if (timeRatio < 0.5) {
            feedback.suggestions.push('â° ä½ å®Œæˆå¾—å¾ˆå¿«ï¼å¯ä»¥èŠ±æ›´å¤šæ—¶é—´æ£€æŸ¥å’Œå®Œå–„å†…å®¹');
        } else if (timeRatio > 0.9) {
            feedback.suggestions.push('â° æ³¨æ„æ—¶é—´ç®¡ç†ï¼Œå¯ä»¥åœ¨æ„æ€é˜¶æ®µèŠ±æ›´å¤šæ—¶é—´è§„åˆ’ç»“æ„');
        }
        
        // é€šç”¨æ”¹è¿›å»ºè®®
        feedback.suggestions.push('ğŸ“– å¤šè¯»ä¼˜ç§€èŒƒæ–‡ï¼Œå­¦ä¹ ä¸åŒçš„è¡¨è¾¾æ–¹å¼å’Œå†™ä½œæŠ€å·§');
        feedback.suggestions.push('âœï¸ åšæŒç»ƒä¹ ï¼Œæ¯å¤©å†™ä½œå¯ä»¥æ˜¾è‘—æé«˜å†™ä½œæ°´å¹³');
        feedback.suggestions.push('ğŸ” å®Œæˆå†™ä½œåï¼ŒèŠ±æ—¶é—´æ£€æŸ¥è¯­æ³•ã€æ‹¼å†™å’Œé€»è¾‘');
    }

    /**
     * æ›´æ–°å†™ä½œè¿›åº¦
     */
    updateWritingProgress(result) {
        this.writingProgress.totalWritings++;
        this.writingProgress.totalWords += result.session.wordCount;
        this.writingProgress.totalTime += Math.round(result.session.timeSpent / 1000 / 60);
        
        // æ›´æ–°å¹³å‡åˆ†æ•°
        const oldTotal = this.writingProgress.totalWritings - 1;
        const oldSum = this.writingProgress.averageScore * oldTotal;
        this.writingProgress.averageScore = Math.round(((oldSum + result.score.total) / this.writingProgress.totalWritings) * 10) / 10;
        
        // æ›´æ–°ç±»å‹ç»Ÿè®¡
        const writingType = result.session.topic.type;
        const topLevelType = result.session.topic.id.split('_')[0]; // essay, letter, report, email
        
        if (this.writingProgress.typeStats[topLevelType]) {
            const typeStats = this.writingProgress.typeStats[topLevelType];
            const oldCompleted = typeStats.completed;
            const oldScoreSum = typeStats.averageScore * oldCompleted;
            
            typeStats.completed++;
            typeStats.totalWords += result.session.wordCount;
            typeStats.averageScore = Math.round(((oldScoreSum + result.score.total) / typeStats.completed) * 10) / 10;
        }
        
        // æ·»åŠ åˆ°æœ€è¿‘å†™ä½œ
        this.writingProgress.recentWritings.unshift({
            title: result.session.topic.title,
            type: topLevelType,
            score: result.score.total,
            wordCount: result.session.wordCount,
            timeSpent: Math.round(result.session.timeSpent / 1000 / 60),
            date: new Date().toISOString()
        });
        
        // åªä¿ç•™æœ€è¿‘20ç¯‡
        if (this.writingProgress.recentWritings.length > 20) {
            this.writingProgress.recentWritings = this.writingProgress.recentWritings.slice(0, 20);
        }
        
        this.saveWritingProgress();
    }

    /**
     * ä¿å­˜å†™ä½œç»“æœ
     */
    saveWritingResult(result) {
        try {
            const writingHistory = JSON.parse(localStorage.getItem('writingHistory') || '[]');
            
            const historyItem = {
                id: Date.now().toString(),
                date: new Date().toISOString(),
                topic: {
                    title: result.session.topic.title,
                    type: result.session.topic.type,
                    difficulty: result.session.topic.difficulty
                },
                content: result.session.content,
                wordCount: result.session.wordCount,
                timeSpent: result.session.timeSpent,
                score: result.score,
                feedback: result.feedback
            };
            
            writingHistory.unshift(historyItem);
            
            // åªä¿ç•™æœ€è¿‘50æ¬¡è®°å½•
            if (writingHistory.length > 50) {
                writingHistory.splice(50);
            }
            
            localStorage.setItem('writingHistory', JSON.stringify(writingHistory));
            console.log('ğŸ’¾ å†™ä½œç»“æœå·²ä¿å­˜');
            
        } catch (error) {
            console.error('ä¿å­˜å†™ä½œç»“æœå¤±è´¥:', error);
        }
    }

    /**
     * è·å–å†™ä½œç»Ÿè®¡
     */
    getWritingStats() {
        return {
            totalWritings: this.writingProgress.totalWritings,
            averageScore: this.writingProgress.averageScore,
            totalWords: this.writingProgress.totalWords,
            totalTime: this.writingProgress.totalTime,
            typeStats: this.writingProgress.typeStats,
            recentWritings: this.writingProgress.recentWritings.slice(0, 5)
        };
    }

    /**
     * æ›´æ–°é…ç½®
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        console.log('ğŸ“ å†™ä½œé…ç½®å·²æ›´æ–°:', this.config);
    }

    /**
     * ä¿å­˜å†™ä½œè¿›åº¦
     */
    saveWritingProgress() {
        try {
            localStorage.setItem('writingProgress', JSON.stringify(this.writingProgress));
            console.log('ğŸ’¾ å†™ä½œè¿›åº¦å·²ä¿å­˜');
        } catch (error) {
            console.error('ä¿å­˜å†™ä½œè¿›åº¦å¤±è´¥:', error);
        }
    }

    /**
     * åŠ è½½å†™ä½œè¿›åº¦
     */
    loadWritingProgress() {
        try {
            const saved = localStorage.getItem('writingProgress');
            if (saved) {
                this.writingProgress = { ...this.writingProgress, ...JSON.parse(saved) };
                console.log('ğŸ“ˆ å†™ä½œè¿›åº¦å·²åŠ è½½');
            }
        } catch (error) {
            console.error('åŠ è½½å†™ä½œè¿›åº¦å¤±è´¥:', error);
        }
    }

    /**
     * é‡ç½®å†™ä½œè¿›åº¦
     */
    resetProgress() {
        this.writingProgress = {
            totalWritings: 0,
            totalWords: 0,
            averageScore: 0,
            totalTime: 0,
            typeStats: {
                essay: { completed: 0, averageScore: 0, totalWords: 0 },
                letter: { completed: 0, averageScore: 0, totalWords: 0 },
                report: { completed: 0, averageScore: 0, totalWords: 0 },
                email: { completed: 0, averageScore: 0, totalWords: 0 }
            },
            recentWritings: []
        };
        
        this.saveWritingProgress();
        console.log('ğŸ”„ å†™ä½œè¿›åº¦å·²é‡ç½®');
    }

    /**
     * é‡ç½®å½“å‰ä¼šè¯
     */
    resetCurrentSession() {
        this.currentWriting = null;
        this.writingSession = null;
        this.stopTimer();
    }

    /**
     * è·å–å†™ä½œå†å²
     */
    getWritingHistory() {
        try {
            return JSON.parse(localStorage.getItem('writingHistory') || '[]');
        } catch (error) {
            console.error('è·å–å†™ä½œå†å²å¤±è´¥:', error);
            return [];
        }
    }

    /**
     * è·å–å†™ä½œç»ƒä¹ ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¢å¼ºç‰ˆï¼‰
     */
    getStats() {
        const progress = this.writingProgress || {};
        
        // åŸºç¡€ç»Ÿè®¡
        const basicStats = {
            averageScore: progress.averageScore || 0,
            totalWritings: progress.totalWritings || 0,
            totalTime: Math.round((progress.totalTime || 0)), // ä¿æŒåˆ†é’Ÿå•ä½
            totalWords: progress.totalWords || 0,
            bestScore: Math.max(...(progress.recentWritings || []).map(w => w.score || 0), 0),
            completionRate: progress.totalWritings > 0 ? 100 : 0,
            streakDays: this.calculateWritingStreak()
        };

        // è¯¦ç»†åˆ†æ
        const detailedAnalysis = this.generateDetailedAnalysis(progress);
        
        // å­¦ä¹ è·¯å¾„æ¨è
        const learningPath = this.generateLearningPath(progress, detailedAnalysis);
        
        return {
            ...basicStats,
            analysis: detailedAnalysis,
            recommendations: learningPath,
            progressInsights: this.generateProgressInsights(progress)
        };
    }

    /**
     * ç”Ÿæˆè¯¦ç»†åˆ†æ
     */
    generateDetailedAnalysis(progress) {
        const recentWritings = progress.recentWritings || [];
        const typeStats = progress.typeStats || {};
        
        const analysis = {
            strengthAreas: [],
            weaknessAreas: [],
            improvementTrends: [],
            skillDistribution: {},
            timeManagement: {},
            consistencyScore: 0
        };

        // åˆ†æå„ç±»å‹è¡¨ç°
        Object.keys(typeStats).forEach(type => {
            const stats = typeStats[type];
            if (stats.completed > 0) {
                analysis.skillDistribution[type] = {
                    completed: stats.completed,
                    averageScore: stats.averageScore,
                    totalWords: stats.totalWords,
                    proficiency: this.calculateProficiencyLevel(stats.averageScore)
                };

                // è¯†åˆ«ä¼˜åŠ¿å’ŒåŠ£åŠ¿
                if (stats.averageScore >= 7.5) {
                    analysis.strengthAreas.push({
                        skill: type,
                        score: stats.averageScore,
                        description: this.getSkillDescription(type, 'strength')
                    });
                } else if (stats.averageScore < 6.0) {
                    analysis.weaknessAreas.push({
                        skill: type,
                        score: stats.averageScore,
                        description: this.getSkillDescription(type, 'weakness')
                    });
                }
            }
        });

        // åˆ†ææ”¹è¿›è¶‹åŠ¿
        if (recentWritings.length >= 3) {
            const recent5 = recentWritings.slice(0, 5);
            const older5 = recentWritings.slice(5, 10);
            
            if (older5.length > 0) {
                const recentAvg = recent5.reduce((sum, w) => sum + w.score, 0) / recent5.length;
                const olderAvg = older5.reduce((sum, w) => sum + w.score, 0) / older5.length;
                const improvement = recentAvg - olderAvg;
                
                if (improvement > 0.5) {
                    analysis.improvementTrends.push({
                        type: 'overall_improvement',
                        value: improvement,
                        description: `æ•´ä½“å†™ä½œæ°´å¹³æå‡äº†${improvement.toFixed(1)}åˆ†`
                    });
                } else if (improvement < -0.5) {
                    analysis.improvementTrends.push({
                        type: 'performance_decline',
                        value: improvement,
                        description: `éœ€è¦æ³¨æ„ï¼Œæœ€è¿‘è¡¨ç°æœ‰æ‰€ä¸‹é™`
                    });
                }
            }
        }

        // æ—¶é—´ç®¡ç†åˆ†æ
        if (recentWritings.length > 0) {
            const avgTime = recentWritings.reduce((sum, w) => sum + w.timeSpent, 0) / recentWritings.length;
            analysis.timeManagement = {
                averageTime: Math.round(avgTime),
                efficiency: this.calculateTimeEfficiency(recentWritings),
                recommendation: this.getTimeManagementAdvice(avgTime)
            };
        }

        // ä¸€è‡´æ€§è¯„åˆ†
        analysis.consistencyScore = this.calculateConsistencyScore(recentWritings);

        return analysis;
    }

    /**
     * ç”Ÿæˆå­¦ä¹ è·¯å¾„æ¨è
     */
    generateLearningPath(progress, analysis) {
        const recommendations = {
            immediate: [], // ç«‹å³è¡ŒåŠ¨å»ºè®®
            shortTerm: [], // çŸ­æœŸç›®æ ‡ï¼ˆ1-2å‘¨ï¼‰
            longTerm: [], // é•¿æœŸç›®æ ‡ï¼ˆ1-2æœˆï¼‰
            nextPractice: null, // ä¸‹æ¬¡ç»ƒä¹ å»ºè®®
            skillFocus: [] // æŠ€èƒ½é‡ç‚¹
        };

        // åŸºäºå¼±é¡¹æ¨èç«‹å³è¡ŒåŠ¨
        analysis.weaknessAreas.forEach(weakness => {
            recommendations.immediate.push({
                type: 'skill_improvement',
                priority: 'high',
                action: `åŠ å¼º${this.getTypeDisplayName(weakness.skill)}ç»ƒä¹ `,
                description: `å½“å‰${weakness.skill}å¹³å‡åˆ†ä»…${weakness.score.toFixed(1)}åˆ†ï¼Œå»ºè®®é‡ç‚¹ç»ƒä¹ `,
                estimatedTime: 'æ¯å¤©15-20åˆ†é’Ÿ'
            });
        });

        // åŸºäºæ€»ç»ƒä¹ æ¬¡æ•°æ¨è
        const totalWritings = progress.totalWritings || 0;
        if (totalWritings < 5) {
            recommendations.immediate.push({
                type: 'practice_frequency',
                priority: 'high',
                action: 'å¢åŠ ç»ƒä¹ é¢‘ç‡',
                description: 'å»ºè®®æ¯å¤©è‡³å°‘å®Œæˆä¸€ç¯‡å†™ä½œç»ƒä¹ ',
                estimatedTime: 'æ¯å¤©30-45åˆ†é’Ÿ'
            });
        }

        // çŸ­æœŸç›®æ ‡è®¾å®š
        if (progress.averageScore < 7.0) {
            recommendations.shortTerm.push({
                goal: 'æå‡æ•´ä½“å†™ä½œæ°´å¹³',
                target: 'å¹³å‡åˆ†è¾¾åˆ°7.0åˆ†ä»¥ä¸Š',
                actions: [
                    'æ¯å¤©ç»ƒä¹ ä¸€ç§å†™ä½œç±»å‹',
                    'é‡ç‚¹å­¦ä¹ å†™ä½œæ¨¡æ¿å’ŒèŒƒæ–‡',
                    'åŠ å¼ºè¯­æ³•å’Œè¯æ±‡åŸºç¡€'
                ],
                timeframe: '2å‘¨å†…'
            });
        }

        // é•¿æœŸç›®æ ‡
        recommendations.longTerm.push({
            goal: 'æˆä¸ºå…¨é¢çš„è‹±è¯­å†™ä½œé«˜æ‰‹',
            target: 'å„ç±»å‹å†™ä½œå¹³å‡åˆ†è¾¾åˆ°8.0åˆ†ä»¥ä¸Š',
            actions: [
                'æŒæ¡é«˜çº§å†™ä½œæŠ€å·§',
                'åŸ¹å…»æ‰¹åˆ¤æ€§æ€ç»´',
                'æ‰©å¤§å­¦æœ¯å’Œå•†åŠ¡è¯æ±‡é‡',
                'å½¢æˆä¸ªäººå†™ä½œé£æ ¼'
            ],
            timeframe: '2ä¸ªæœˆå†…'
        });

        // ä¸‹æ¬¡ç»ƒä¹ å»ºè®®
        recommendations.nextPractice = this.suggestNextPractice(progress, analysis);

        // æŠ€èƒ½é‡ç‚¹
        recommendations.skillFocus = this.identifySkillFocus(analysis);

        return recommendations;
    }

    /**
     * å»ºè®®ä¸‹æ¬¡ç»ƒä¹ å†…å®¹
     */
    suggestNextPractice(progress, analysis) {
        const typeStats = progress.typeStats || {};
        const recentWritings = progress.recentWritings || [];

        // æ‰¾å‡ºç»ƒä¹ æœ€å°‘çš„ç±»å‹
        let minPracticeType = null;
        let minCount = Infinity;

        Object.keys(typeStats).forEach(type => {
            if (typeStats[type].completed < minCount) {
                minCount = typeStats[type].completed;
                minPracticeType = type;
            }
        });

        // å¦‚æœæ²¡æœ‰æ˜æ˜¾çš„å¼±é¡¹ï¼Œæ ¹æ®æœ€è¿‘ç»ƒä¹ æƒ…å†µæ¨è
        if (!minPracticeType && recentWritings.length > 0) {
            const lastType = recentWritings[0].type;
            const allTypes = ['essay', 'letter', 'report', 'email'];
            const otherTypes = allTypes.filter(t => t !== lastType);
            minPracticeType = otherTypes[Math.floor(Math.random() * otherTypes.length)];
        }

        // æ ¹æ®å¹³å‡åˆ†æ¨èéš¾åº¦
        const avgScore = progress.averageScore || 0;
        let suggestedDifficulty;
        if (avgScore < 6.0) {
            suggestedDifficulty = 'beginner';
        } else if (avgScore < 7.5) {
            suggestedDifficulty = 'intermediate';
        } else {
            suggestedDifficulty = 'advanced';
        }

        return {
            type: minPracticeType || 'essay',
            difficulty: suggestedDifficulty,
            reason: this.getRecommendationReason(minPracticeType, suggestedDifficulty, analysis),
            estimatedTime: this.getEstimatedTime(minPracticeType, suggestedDifficulty)
        };
    }

    /**
     * è¯†åˆ«æŠ€èƒ½é‡ç‚¹
     */
    identifySkillFocus(analysis) {
        const focus = [];

        // åŸºäºå¼±é¡¹è¯†åˆ«
        if (analysis.weaknessAreas.length > 0) {
            analysis.weaknessAreas.forEach(weakness => {
                focus.push({
                    skill: weakness.skill,
                    priority: 'high',
                    currentLevel: weakness.score,
                    targetLevel: 7.0,
                    focusAreas: this.getSkillFocusAreas(weakness.skill)
                });
            });
        }

        // åŸºäºæ—¶é—´ç®¡ç†
        if (analysis.timeManagement.efficiency < 0.7) {
            focus.push({
                skill: 'time_management',
                priority: 'medium',
                currentLevel: analysis.timeManagement.efficiency,
                targetLevel: 0.8,
                focusAreas: ['å†™ä½œè§„åˆ’', 'æ—¶é—´åˆ†é…', 'æ•ˆç‡æå‡']
            });
        }

        // åŸºäºä¸€è‡´æ€§
        if (analysis.consistencyScore < 0.7) {
            focus.push({
                skill: 'consistency',
                priority: 'medium',
                currentLevel: analysis.consistencyScore,
                targetLevel: 0.8,
                focusAreas: ['ç¨³å®šå‘æŒ¥', 'è´¨é‡æ§åˆ¶', 'æ ‡å‡†åŒ–æµç¨‹']
            });
        }

        return focus;
    }

    /**
     * ç”Ÿæˆè¿›åº¦æ´å¯Ÿ
     */
    generateProgressInsights(progress) {
        const insights = [];
        const recentWritings = progress.recentWritings || [];
        const totalWritings = progress.totalWritings || 0;

        // ç»ƒä¹ é¢‘ç‡æ´å¯Ÿ
        if (totalWritings > 0) {
            const daysSinceFirst = this.calculateDaysSinceFirstWriting(recentWritings);
            const frequency = totalWritings / Math.max(daysSinceFirst, 1);
            
            if (frequency >= 1) {
                insights.push({
                    type: 'positive',
                    title: 'ç»ƒä¹ é¢‘ç‡å¾ˆé«˜',
                    description: `å¹³å‡æ¯å¤©å®Œæˆ${frequency.toFixed(1)}ç¯‡å†™ä½œï¼Œä¿æŒå¾—å¾ˆå¥½ï¼`,
                    icon: 'ğŸ”¥'
                });
            } else if (frequency >= 0.5) {
                insights.push({
                    type: 'neutral',
                    title: 'ç»ƒä¹ é¢‘ç‡é€‚ä¸­',
                    description: 'å»ºè®®å¯ä»¥é€‚å½“å¢åŠ ç»ƒä¹ é¢‘ç‡ï¼Œæ¯å¤©è‡³å°‘ä¸€ç¯‡',
                    icon: 'ğŸ“ˆ'
                });
            } else {
                insights.push({
                    type: 'suggestion',
                    title: 'éœ€è¦å¢åŠ ç»ƒä¹ ',
                    description: 'å»ºè®®å»ºç«‹æ¯æ—¥å†™ä½œä¹ æƒ¯ï¼ŒæŒç»­ç»ƒä¹ æ˜¯æé«˜çš„å…³é”®',
                    icon: 'ğŸ’ª'
                });
            }
        }

        // è¿›æ­¥æ´å¯Ÿ
        if (recentWritings.length >= 5) {
            const firstScore = recentWritings[recentWritings.length - 1].score;
            const latestScore = recentWritings[0].score;
            const improvement = latestScore - firstScore;

            if (improvement > 1.0) {
                insights.push({
                    type: 'positive',
                    title: 'æ˜¾è‘—è¿›æ­¥',
                    description: `å†™ä½œæ°´å¹³æå‡äº†${improvement.toFixed(1)}åˆ†ï¼Œç»§ç»­ä¿æŒï¼`,
                    icon: 'ğŸš€'
                });
            } else if (improvement > 0.3) {
                insights.push({
                    type: 'positive',
                    title: 'ç¨³æ­¥æå‡',
                    description: `å†™ä½œæ°´å¹³åœ¨ç¨³æ­¥æå‡ï¼Œå·²è¿›æ­¥${improvement.toFixed(1)}åˆ†`,
                    icon: 'ğŸ“Š'
                });
            }
        }

        // é‡Œç¨‹ç¢‘æ´å¯Ÿ
        if (totalWritings >= 50) {
            insights.push({
                type: 'achievement',
                title: 'å†™ä½œè¾¾äºº',
                description: `å·²å®Œæˆ${totalWritings}ç¯‡å†™ä½œï¼Œæ˜¯çœŸæ­£çš„å†™ä½œè¾¾äººï¼`,
                icon: 'ğŸ†'
            });
        } else if (totalWritings >= 20) {
            insights.push({
                type: 'achievement',
                title: 'å‹¤å¥‹ç»ƒä¹ è€…',
                description: `å·²å®Œæˆ${totalWritings}ç¯‡å†™ä½œï¼Œå‘50ç¯‡ç›®æ ‡å‰è¿›ï¼`,
                icon: 'ğŸ¯'
            });
        } else if (totalWritings >= 10) {
            insights.push({
                type: 'achievement',
                title: 'åˆè§æˆæ•ˆ',
                description: `å·²å®Œæˆ${totalWritings}ç¯‡å†™ä½œï¼ŒåŸºç¡€å·²ç»å»ºç«‹ï¼`,
                icon: 'ğŸŒ±'
            });
        }

        return insights;
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè®¡ç®—ç†Ÿç»ƒåº¦ç­‰çº§
     */
    calculateProficiencyLevel(averageScore) {
        if (averageScore >= 8.5) return 'expert';
        if (averageScore >= 7.5) return 'advanced';
        if (averageScore >= 6.5) return 'intermediate';
        if (averageScore >= 5.5) return 'beginner';
        return 'novice';
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–æŠ€èƒ½æè¿°
     */
    getSkillDescription(type, category) {
        const descriptions = {
            essay: {
                strength: 'è®®è®ºæ–‡å†™ä½œèƒ½åŠ›å¼ºï¼Œé€»è¾‘æ€ç»´æ¸…æ™°',
                weakness: 'è®®è®ºæ–‡å†™ä½œéœ€è¦åŠ å¼ºï¼Œç‰¹åˆ«æ˜¯è®ºè¯ç»“æ„'
            },
            letter: {
                strength: 'ä¹¦ä¿¡å†™ä½œæ ¼å¼è§„èŒƒï¼Œè¯­è¨€å¾—ä½“',
                weakness: 'ä¹¦ä¿¡å†™ä½œæ ¼å¼å’Œè¯­è°ƒéœ€è¦æ”¹è¿›'
            },
            report: {
                strength: 'æŠ¥å‘Šå†™ä½œæ¡ç†æ¸…æ™°ï¼Œæ•°æ®åˆ†æå‡†ç¡®',
                weakness: 'æŠ¥å‘Šå†™ä½œçš„å®¢è§‚æ€§å’Œæ•°æ®å‘ˆç°éœ€è¦æå‡'
            },
            email: {
                strength: 'é‚®ä»¶å†™ä½œç®€æ´æ˜äº†ï¼Œå•†åŠ¡è¯­è¨€ä¸“ä¸š',
                weakness: 'é‚®ä»¶å†™ä½œçš„æ­£å¼æ€§å’Œç»“æ„éœ€è¦å®Œå–„'
            }
        };
        
        return descriptions[type]?.[category] || 'éœ€è¦æ›´å¤šç»ƒä¹ ';
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè®¡ç®—æ—¶é—´æ•ˆç‡
     */
    calculateTimeEfficiency(recentWritings) {
        if (recentWritings.length === 0) return 0;
        
        let totalEfficiency = 0;
        recentWritings.forEach(writing => {
            const expectedTime = writing.wordCount * 0.5; // å‡è®¾æ¯è¯0.5åˆ†é’Ÿ
            const actualTime = writing.timeSpent;
            const efficiency = Math.min(expectedTime / actualTime, 1);
            totalEfficiency += efficiency;
        });
        
        return totalEfficiency / recentWritings.length;
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–æ—¶é—´ç®¡ç†å»ºè®®
     */
    getTimeManagementAdvice(avgTime) {
        if (avgTime > 60) {
            return 'å†™ä½œæ—¶é—´è¾ƒé•¿ï¼Œå»ºè®®æå‰åšå¥½å¤§çº²è§„åˆ’ï¼Œæé«˜å†™ä½œæ•ˆç‡';
        } else if (avgTime < 20) {
            return 'å†™ä½œæ—¶é—´è¾ƒçŸ­ï¼Œå»ºè®®èŠ±æ›´å¤šæ—¶é—´æ€è€ƒå’Œæ£€æŸ¥';
        } else {
            return 'å†™ä½œæ—¶é—´æ§åˆ¶å¾—å½“ï¼Œç»§ç»­ä¿æŒ';
        }
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè®¡ç®—ä¸€è‡´æ€§è¯„åˆ†
     */
    calculateConsistencyScore(recentWritings) {
        if (recentWritings.length < 3) return 0;
        
        const scores = recentWritings.map(w => w.score);
        const mean = scores.reduce((sum, score) => sum + score, 0) / scores.length;
        const variance = scores.reduce((sum, score) => sum + Math.pow(score - mean, 2), 0) / scores.length;
        const standardDeviation = Math.sqrt(variance);
        
        // æ ‡å‡†å·®è¶Šå°ï¼Œä¸€è‡´æ€§è¶Šé«˜
        return Math.max(0, 1 - standardDeviation / 3);
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–ç±»å‹æ˜¾ç¤ºåç§°
     */
    getTypeDisplayName(type) {
        const names = {
            essay: 'è®®è®ºæ–‡',
            letter: 'ä¹¦ä¿¡',
            report: 'æŠ¥å‘Š',
            email: 'é‚®ä»¶'
        };
        return names[type] || type;
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–æ¨èåŸå› 
     */
    getRecommendationReason(type, difficulty, analysis) {
        const reasons = [];
        
        if (analysis.weaknessAreas.some(w => w.skill === type)) {
            reasons.push(`${this.getTypeDisplayName(type)}æ˜¯æ‚¨çš„è–„å¼±ç¯èŠ‚`);
        }
        
        reasons.push(`${difficulty === 'beginner' ? 'åŸºç¡€' : difficulty === 'intermediate' ? 'ä¸­çº§' : 'é«˜çº§'}éš¾åº¦é€‚åˆå½“å‰æ°´å¹³`);
        
        return reasons.join('ï¼Œ');
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–é¢„ä¼°æ—¶é—´
     */
    getEstimatedTime(type, difficulty) {
        const baseTimes = {
            essay: { beginner: 25, intermediate: 35, advanced: 45 },
            letter: { beginner: 15, intermediate: 20, advanced: 25 },
            report: { beginner: 20, intermediate: 25, advanced: 35 },
            email: { beginner: 10, intermediate: 15, advanced: 20 }
        };
        
        return baseTimes[type]?.[difficulty] || 30;
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè·å–æŠ€èƒ½é‡ç‚¹é¢†åŸŸ
     */
    getSkillFocusAreas(skill) {
        const focusAreas = {
            essay: ['è®ºè¯ç»“æ„', 'é€»è¾‘è¿è´¯', 'è§‚ç‚¹è¡¨è¾¾', 'ä¾‹è¯ä½¿ç”¨'],
            letter: ['æ ¼å¼è§„èŒƒ', 'è¯­è°ƒæŠŠæ¡', 'å†…å®¹ç»„ç»‡', 'ç¤¼è²Œç”¨è¯­'],
            report: ['æ•°æ®å‘ˆç°', 'å®¢è§‚åˆ†æ', 'ç»“æ„æ¸…æ™°', 'ç»“è®ºæ€»ç»“'],
            email: ['ç®€æ´æ˜äº†', 'ä¸“ä¸šè¯­è¨€', 'æ ¼å¼æ ‡å‡†', 'è¡ŒåŠ¨å¯¼å‘']
        };
        
        return focusAreas[skill] || ['åŸºç¡€ç»ƒä¹ '];
    }

    /**
     * è¾…åŠ©æ–¹æ³•ï¼šè®¡ç®—è·ç¦»é¦–æ¬¡å†™ä½œçš„å¤©æ•°
     */
    calculateDaysSinceFirstWriting(recentWritings) {
        if (recentWritings.length === 0) return 0;
        
        const firstDate = new Date(recentWritings[recentWritings.length - 1].date);
        const now = new Date();
        const diffTime = Math.abs(now - firstDate);
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        return diffDays;
    }

    /**
     * å¯¼å‡ºå†™ä½œæ•°æ®
     */
    exportWritingData(format = 'json') {
        try {
            const exportData = {
                exportDate: new Date().toISOString(),
                version: '1.0',
                progress: this.writingProgress,
                history: this.getWritingHistory(),
                config: this.config
            };

            let content, filename, mimeType;

            switch (format.toLowerCase()) {
                case 'json':
                    content = JSON.stringify(exportData, null, 2);
                    filename = `writing_data_${this.formatDateForFilename()}.json`;
                    mimeType = 'application/json';
                    break;
                
                case 'csv':
                    content = this.convertToCSV(exportData.history);
                    filename = `writing_history_${this.formatDateForFilename()}.csv`;
                    mimeType = 'text/csv';
                    break;
                
                case 'txt':
                    content = this.convertToText(exportData);
                    filename = `writing_report_${this.formatDateForFilename()}.txt`;
                    mimeType = 'text/plain';
                    break;
                
                default:
                    throw new Error('ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼');
            }

            this.downloadFile(content, filename, mimeType);
            console.log(`âœ… å†™ä½œæ•°æ®å·²å¯¼å‡ºä¸º ${format.toUpperCase()} æ ¼å¼`);
            return true;

        } catch (error) {
            console.error('å¯¼å‡ºå†™ä½œæ•°æ®å¤±è´¥:', error);
            return false;
        }
    }

    /**
     * å¯¼å…¥å†™ä½œæ•°æ®
     */
    importWritingData(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = (event) => {
                try {
                    const content = event.target.result;
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    
                    let importData;
                    
                    switch (fileExtension) {
                        case 'json':
                            importData = JSON.parse(content);
                            break;
                        
                        case 'csv':
                            importData = this.parseCSV(content);
                            break;
                        
                        default:
                            throw new Error('ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼');
                    }
                    
                    const result = this.processImportData(importData);
                    resolve(result);
                    
                } catch (error) {
                    console.error('å¯¼å…¥æ•°æ®è§£æå¤±è´¥:', error);
                    reject(error);
                }
            };
            
            reader.onerror = () => {
                reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥'));
            };
            
            reader.readAsText(file);
        });
    }

    /**
     * å¤„ç†å¯¼å…¥çš„æ•°æ®
     */
    processImportData(importData) {
        try {
            const result = {
                success: false,
                imported: {
                    progress: false,
                    history: false,
                    config: false
                },
                errors: [],
                summary: {
                    totalWritings: 0,
                    newWritings: 0,
                    duplicates: 0
                }
            };

            // éªŒè¯æ•°æ®æ ¼å¼
            if (!this.validateImportData(importData)) {
                throw new Error('å¯¼å…¥æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
            }

            // å¤‡ä»½å½“å‰æ•°æ®
            const backup = {
                progress: { ...this.writingProgress },
                history: this.getWritingHistory(),
                config: { ...this.config }
            };

            try {
                // å¯¼å…¥è¿›åº¦æ•°æ®
                if (importData.progress) {
                    this.mergeProgressData(importData.progress);
                    result.imported.progress = true;
                }

                // å¯¼å…¥å†å²è®°å½•
                if (importData.history && Array.isArray(importData.history)) {
                    const historyResult = this.mergeHistoryData(importData.history);
                    result.imported.history = true;
                    result.summary.totalWritings = importData.history.length;
                    result.summary.newWritings = historyResult.newItems;
                    result.summary.duplicates = historyResult.duplicates;
                }

                // å¯¼å…¥é…ç½®ï¼ˆå¯é€‰ï¼‰
                if (importData.config && this.confirmConfigImport()) {
                    this.config = { ...this.config, ...importData.config };
                    result.imported.config = true;
                }

                result.success = true;
                console.log('âœ… å†™ä½œæ•°æ®å¯¼å…¥æˆåŠŸ');
                
            } catch (error) {
                // æ¢å¤å¤‡ä»½æ•°æ®
                this.writingProgress = backup.progress;
                this.saveWritingProgress();
                
                const currentHistory = this.getWritingHistory();
                localStorage.setItem('writingHistory', JSON.stringify(backup.history));
                
                this.config = backup.config;
                
                throw error;
            }

            return result;

        } catch (error) {
            console.error('å¤„ç†å¯¼å…¥æ•°æ®å¤±è´¥:', error);
            return {
                success: false,
                error: error.message,
                imported: { progress: false, history: false, config: false },
                summary: { totalWritings: 0, newWritings: 0, duplicates: 0 }
            };
        }
    }

    /**
     * åˆå¹¶è¿›åº¦æ•°æ®
     */
    mergeProgressData(importedProgress) {
        // åˆå¹¶æ€»ä½“ç»Ÿè®¡
        this.writingProgress.totalWritings += importedProgress.totalWritings || 0;
        this.writingProgress.totalWords += importedProgress.totalWords || 0;
        this.writingProgress.totalTime += importedProgress.totalTime || 0;

        // é‡æ–°è®¡ç®—å¹³å‡åˆ†
        const currentTotal = this.writingProgress.totalWritings - (importedProgress.totalWritings || 0);
        const currentSum = this.writingProgress.averageScore * currentTotal;
        const importedSum = (importedProgress.averageScore || 0) * (importedProgress.totalWritings || 0);
        
        if (this.writingProgress.totalWritings > 0) {
            this.writingProgress.averageScore = (currentSum + importedSum) / this.writingProgress.totalWritings;
        }

        // åˆå¹¶ç±»å‹ç»Ÿè®¡
        if (importedProgress.typeStats) {
            Object.keys(importedProgress.typeStats).forEach(type => {
                if (!this.writingProgress.typeStats[type]) {
                    this.writingProgress.typeStats[type] = { completed: 0, averageScore: 0, totalWords: 0 };
                }
                
                const current = this.writingProgress.typeStats[type];
                const imported = importedProgress.typeStats[type];
                
                const oldCompleted = current.completed;
                const oldSum = current.averageScore * oldCompleted;
                
                current.completed += imported.completed || 0;
                current.totalWords += imported.totalWords || 0;
                
                if (current.completed > 0) {
                    current.averageScore = (oldSum + (imported.averageScore || 0) * (imported.completed || 0)) / current.completed;
                }
            });
        }

        this.saveWritingProgress();
    }

    /**
     * åˆå¹¶å†å²è®°å½•
     */
    mergeHistoryData(importedHistory) {
        const currentHistory = this.getWritingHistory();
        const existingIds = new Set(currentHistory.map(item => item.id));
        
        let newItems = 0;
        let duplicates = 0;
        
        const mergedHistory = [...currentHistory];
        
        importedHistory.forEach(item => {
            if (existingIds.has(item.id)) {
                duplicates++;
            } else {
                mergedHistory.push(item);
                newItems++;
            }
        });

        // æŒ‰æ—¥æœŸæ’åºå¹¶é™åˆ¶æ•°é‡
        mergedHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
        const finalHistory = mergedHistory.slice(0, 100); // ä¿ç•™æœ€è¿‘100æ¡è®°å½•

        localStorage.setItem('writingHistory', JSON.stringify(finalHistory));
        
        return { newItems, duplicates };
    }

    /**
     * éªŒè¯å¯¼å…¥æ•°æ®æ ¼å¼
     */
    validateImportData(data) {
        // åŸºæœ¬ç»“æ„æ£€æŸ¥
        if (!data || typeof data !== 'object') {
            return false;
        }

        // æ£€æŸ¥æ˜¯å¦åŒ…å«å¿…è¦å­—æ®µ
        const hasValidProgress = !data.progress || (
            typeof data.progress === 'object' &&
            typeof data.progress.totalWritings === 'number'
        );

        const hasValidHistory = !data.history || Array.isArray(data.history);

        return hasValidProgress && hasValidHistory;
    }

    /**
     * è½¬æ¢ä¸ºCSVæ ¼å¼
     */
    convertToCSV(history) {
        if (!history || history.length === 0) {
            return 'No data available';
        }

        const headers = ['æ—¥æœŸ', 'æ ‡é¢˜', 'ç±»å‹', 'éš¾åº¦', 'å­—æ•°', 'ç”¨æ—¶(åˆ†é’Ÿ)', 'æ€»åˆ†', 'å†…å®¹åˆ†', 'ç»“æ„åˆ†', 'è¯­è¨€åˆ†', 'è¯­æ³•åˆ†'];
        const csvContent = [headers.join(',')];

        history.forEach(item => {
            const row = [
                new Date(item.date).toLocaleDateString('zh-CN'),
                `"${item.topic?.title || 'æœªçŸ¥é¢˜ç›®'}"`,
                item.topic?.type || 'æœªçŸ¥',
                item.topic?.difficulty || 'æœªçŸ¥',
                item.wordCount || 0,
                Math.round((item.timeSpent || 0) / 1000 / 60),
                item.score?.total || item.score?.overall || 0,
                item.score?.breakdown?.content || 0,
                item.score?.breakdown?.organization || 0,
                item.score?.breakdown?.language || 0,
                item.score?.breakdown?.mechanics || 0
            ];
            csvContent.push(row.join(','));
        });

        return csvContent.join('\n');
    }

    /**
     * è½¬æ¢ä¸ºæ–‡æœ¬æ ¼å¼
     */
    convertToText(exportData) {
        const lines = [];
        const progress = exportData.progress;
        const history = exportData.history;

        lines.push('='.repeat(50));
        lines.push('å†™ä½œç»ƒä¹ æ•°æ®æŠ¥å‘Š');
        lines.push('='.repeat(50));
        lines.push(`å¯¼å‡ºæ—¶é—´: ${new Date(exportData.exportDate).toLocaleString('zh-CN')}`);
        lines.push('');

        // æ€»ä½“ç»Ÿè®¡
        lines.push('ğŸ“Š æ€»ä½“ç»Ÿè®¡');
        lines.push('-'.repeat(30));
        lines.push(`æ€»å†™ä½œæ•°é‡: ${progress.totalWritings || 0}ç¯‡`);
        lines.push(`å¹³å‡åˆ†æ•°: ${(progress.averageScore || 0).toFixed(1)}åˆ†`);
        lines.push(`æ€»å­—æ•°: ${progress.totalWords || 0}å­—`);
        lines.push(`æ€»ç”¨æ—¶: ${progress.totalTime || 0}åˆ†é’Ÿ`);
        lines.push('');

        // å„ç±»å‹ç»Ÿè®¡
        if (progress.typeStats) {
            lines.push('ğŸ“ å„ç±»å‹è¡¨ç°');
            lines.push('-'.repeat(30));
            Object.keys(progress.typeStats).forEach(type => {
                const stats = progress.typeStats[type];
                if (stats.completed > 0) {
                    lines.push(`${this.getTypeDisplayName(type)}: ${stats.completed}ç¯‡, å¹³å‡${stats.averageScore.toFixed(1)}åˆ†`);
                }
            });
            lines.push('');
        }

        // æœ€è¿‘å†™ä½œè®°å½•
        if (history && history.length > 0) {
            lines.push('ğŸ“‹ æœ€è¿‘å†™ä½œè®°å½•');
            lines.push('-'.repeat(30));
            history.slice(0, 10).forEach((item, index) => {
                lines.push(`${index + 1}. ${item.topic?.title || 'æœªçŸ¥é¢˜ç›®'}`);
                lines.push(`   æ—¥æœŸ: ${new Date(item.date).toLocaleDateString('zh-CN')}`);
                lines.push(`   åˆ†æ•°: ${item.score?.total || item.score?.overall || 0}åˆ†`);
                lines.push(`   å­—æ•°: ${item.wordCount || 0}å­—`);
                lines.push('');
            });
        }

        return lines.join('\n');
    }

    /**
     * è§£æCSVæ•°æ®
     */
    parseCSV(csvContent) {
        // ç®€åŒ–çš„CSVè§£æï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦æ›´å¤æ‚çš„è§£æé€»è¾‘
        const lines = csvContent.split('\n');
        const headers = lines[0].split(',');
        const data = [];

        for (let i = 1; i < lines.length; i++) {
            if (lines[i].trim()) {
                const values = lines[i].split(',');
                const item = {};
                headers.forEach((header, index) => {
                    item[header.trim()] = values[index]?.trim() || '';
                });
                data.push(item);
            }
        }

        return { history: data };
    }

    /**
     * ä¸‹è½½æ–‡ä»¶
     */
    downloadFile(content, filename, mimeType) {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
    }

    /**
     * æ ¼å¼åŒ–æ—¥æœŸç”¨äºæ–‡ä»¶å
     */
    formatDateForFilename() {
        const now = new Date();
        return now.toISOString().slice(0, 19).replace(/:/g, '-').replace('T', '_');
    }

    /**
     * ç¡®è®¤é…ç½®å¯¼å…¥
     */
    confirmConfigImport() {
        return confirm('æ˜¯å¦è¦å¯¼å…¥å†™ä½œé…ç½®è®¾ç½®ï¼Ÿè¿™å°†è¦†ç›–å½“å‰çš„é…ç½®ã€‚');
    }

    /**
     * å¯¼å‡ºå†™ä½œä½œå“ï¼ˆå•ç¯‡ï¼‰
     */
    exportSingleWriting(writingId, format = 'txt') {
        try {
            const history = this.getWritingHistory();
            const writing = history.find(item => item.id === writingId);
            
            if (!writing) {
                throw new Error('æœªæ‰¾åˆ°æŒ‡å®šçš„å†™ä½œä½œå“');
            }

            let content, filename, mimeType;

            switch (format.toLowerCase()) {
                case 'txt':
                    content = this.formatSingleWritingAsText(writing);
                    filename = `writing_${writing.topic?.title || 'untitled'}_${this.formatDateForFilename()}.txt`;
                    mimeType = 'text/plain';
                    break;
                
                case 'md':
                    content = this.formatSingleWritingAsMarkdown(writing);
                    filename = `writing_${writing.topic?.title || 'untitled'}_${this.formatDateForFilename()}.md`;
                    mimeType = 'text/markdown';
                    break;
                
                case 'json':
                    content = JSON.stringify(writing, null, 2);
                    filename = `writing_${writing.topic?.title || 'untitled'}_${this.formatDateForFilename()}.json`;
                    mimeType = 'application/json';
                    break;
                
                default:
                    throw new Error('ä¸æ”¯æŒçš„å¯¼å‡ºæ ¼å¼');
            }

            this.downloadFile(content, filename, mimeType);
            console.log(`âœ… å†™ä½œä½œå“å·²å¯¼å‡ºä¸º ${format.toUpperCase()} æ ¼å¼`);
            return true;

        } catch (error) {
            console.error('å¯¼å‡ºå†™ä½œä½œå“å¤±è´¥:', error);
            return false;
        }
    }

    /**
     * æ ¼å¼åŒ–å•ç¯‡å†™ä½œä¸ºæ–‡æœ¬
     */
    formatSingleWritingAsText(writing) {
        const lines = [];
        
        lines.push('='.repeat(50));
        lines.push(writing.topic?.title || 'å†™ä½œä½œå“');
        lines.push('='.repeat(50));
        lines.push(`å†™ä½œæ—¶é—´: ${new Date(writing.date).toLocaleString('zh-CN')}`);
        lines.push(`å†™ä½œç±»å‹: ${this.getTypeDisplayName(writing.topic?.type || 'unknown')}`);
        lines.push(`éš¾åº¦ç­‰çº§: ${writing.topic?.difficulty || 'æœªçŸ¥'}`);
        lines.push(`å­—æ•°ç»Ÿè®¡: ${writing.wordCount || 0}å­—`);
        lines.push(`ç”¨æ—¶: ${Math.round((writing.timeSpent || 0) / 1000 / 60)}åˆ†é’Ÿ`);
        lines.push(`æ€»åˆ†: ${writing.score?.total || writing.score?.overall || 0}åˆ†`);
        lines.push('');
        
        if (writing.topic?.prompt) {
            lines.push('ğŸ“ é¢˜ç›®è¦æ±‚');
            lines.push('-'.repeat(30));
            lines.push(writing.topic.prompt);
            lines.push('');
        }
        
        lines.push('âœï¸ å†™ä½œå†…å®¹');
        lines.push('-'.repeat(30));
        lines.push(writing.content || 'æ— å†…å®¹');
        lines.push('');
        
        if (writing.score?.breakdown) {
            lines.push('ğŸ“Š è¯„åˆ†è¯¦æƒ…');
            lines.push('-'.repeat(30));
            lines.push(`å†…å®¹è´¨é‡: ${writing.score.breakdown.content || 0}åˆ†`);
            lines.push(`ç»“æ„ç»„ç»‡: ${writing.score.breakdown.organization || 0}åˆ†`);
            lines.push(`è¯­è¨€è¿ç”¨: ${writing.score.breakdown.language || 0}åˆ†`);
            lines.push(`è¯­æ³•æœºåˆ¶: ${writing.score.breakdown.mechanics || 0}åˆ†`);
            lines.push('');
        }
        
        if (writing.feedback) {
            lines.push('ğŸ’¬ è¯„ä»·åé¦ˆ');
            lines.push('-'.repeat(30));
            lines.push(writing.feedback.overall || 'æ— åé¦ˆ');
            lines.push('');
        }
        
        return lines.join('\n');
    }

    /**
     * æ ¼å¼åŒ–å•ç¯‡å†™ä½œä¸ºMarkdown
     */
    formatSingleWritingAsMarkdown(writing) {
        const lines = [];
        
        lines.push(`# ${writing.topic?.title || 'å†™ä½œä½œå“'}`);
        lines.push('');
        lines.push('## åŸºæœ¬ä¿¡æ¯');
        lines.push('');
        lines.push(`- **å†™ä½œæ—¶é—´**: ${new Date(writing.date).toLocaleString('zh-CN')}`);
        lines.push(`- **å†™ä½œç±»å‹**: ${this.getTypeDisplayName(writing.topic?.type || 'unknown')}`);
        lines.push(`- **éš¾åº¦ç­‰çº§**: ${writing.topic?.difficulty || 'æœªçŸ¥'}`);
        lines.push(`- **å­—æ•°ç»Ÿè®¡**: ${writing.wordCount || 0}å­—`);
        lines.push(`- **ç”¨æ—¶**: ${Math.round((writing.timeSpent || 0) / 1000 / 60)}åˆ†é’Ÿ`);
        lines.push(`- **æ€»åˆ†**: ${writing.score?.total || writing.score?.overall || 0}åˆ†`);
        lines.push('');
        
        if (writing.topic?.prompt) {
            lines.push('## é¢˜ç›®è¦æ±‚');
            lines.push('');
            lines.push(writing.topic.prompt);
            lines.push('');
        }
        
        lines.push('## å†™ä½œå†…å®¹');
        lines.push('');
        lines.push(writing.content || 'æ— å†…å®¹');
        lines.push('');
        
        if (writing.score?.breakdown) {
            lines.push('## è¯„åˆ†è¯¦æƒ…');
            lines.push('');
            lines.push(`- **å†…å®¹è´¨é‡**: ${writing.score.breakdown.content || 0}åˆ†`);
            lines.push(`- **ç»“æ„ç»„ç»‡**: ${writing.score.breakdown.organization || 0}åˆ†`);
            lines.push(`- **è¯­è¨€è¿ç”¨**: ${writing.score.breakdown.language || 0}åˆ†`);
            lines.push(`- **è¯­æ³•æœºåˆ¶**: ${writing.score.breakdown.mechanics || 0}åˆ†`);
            lines.push('');
        }
        
        if (writing.feedback) {
            lines.push('## è¯„ä»·åé¦ˆ');
            lines.push('');
            lines.push(writing.feedback.overall || 'æ— åé¦ˆ');
            lines.push('');
        }
        
        return lines.join('\n');
    }

    /**
     * è®¡ç®—å†™ä½œè¿å‡»å¤©æ•°
     */
    calculateWritingStreak() {
        const recentWritings = this.writingProgress.recentWritings || [];
        if (recentWritings.length === 0) return 0;

        let streak = 0;
        const today = new Date();
        
        for (let i = 0; i < 30; i++) { // æ£€æŸ¥æœ€è¿‘30å¤©
            const checkDate = new Date(today.getTime() - i * 24 * 60 * 60 * 1000);
            const dateStr = checkDate.toDateString();
            
            const hasWriting = recentWritings.some(w => 
                new Date(w.timestamp).toDateString() === dateStr
            );
            
            if (hasWriting) {
                streak++;
            } else if (i > 0) { // å¦‚æœä¸æ˜¯ä»Šå¤©ä¸”æ²¡æœ‰å†™ä½œè®°å½•ï¼Œåˆ™ä¸­æ–­è¿å‡»
                break;
            }
        }
        
        return streak;
    }

    /**
     * é‡ç½®å†™ä½œè¿›åº¦æ•°æ®
     */
    resetProgress() {
        this.writingProgress = {
            totalWritings: 0,
            totalWords: 0,
            averageScore: 0,
            totalTime: 0,
            typeStats: {
                essay: { completed: 0, averageScore: 0, totalWords: 0 },
                letter: { completed: 0, averageScore: 0, totalWords: 0 },
                report: { completed: 0, averageScore: 0, totalWords: 0 },
                email: { completed: 0, averageScore: 0, totalWords: 0 }
            },
            recentWritings: []
        };
        
        localStorage.removeItem('writingProgress');
        console.log('âœ… å†™ä½œç»ƒä¹ è¿›åº¦å·²é‡ç½®');
        return true;
    }
}

// ç¡®ä¿åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('writing')) {
        window.writingManager = new WritingManager();
        console.log('âœ… å†™ä½œç»ƒä¹ ç®¡ç†å™¨å·²å…¨å±€åˆå§‹åŒ–');
    }
});
